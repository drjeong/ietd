const MARGINAL_TIMESTAMP=24*60*60*1e3;let chartLoading=2;let syncing=false;function isObject(obj){return obj&&typeof obj==="object"}function objectIsEmpty(obj){if(obj==undefined)return false;return Object.keys(obj).length===0&&obj.constructor===Object}function HichartZooming(begintime,endtime){const chart=Highcharts.charts.find(c=>c&&c.series&&c.series.some(series=>series.name&&(series.name.includes("HPCP")||series.name.includes("Precipitation"))));if(!chart){console.warn("Precipitation chart not found");return}if(begintime==null&&endtime==null){chart.xAxis[0].setExtremes(null,null)}else{chart.xAxis[0].setExtremes(begintime-MARGINAL_TIMESTAMP,endtime+MARGINAL_TIMESTAMP)}}function syncZoom(chartClassName,e){syncing=true;$(Highcharts.charts).each(function(i,chart){if(chart!=undefined){if(!chart.container.classList.contains(chartClassName)){let min=e.min===null?e.dataMin:e.min;let max=e.min===null?e.dataMax:e.max;if(!isObject(chart.resetZoomButton)){chart.showResetZoom()}chart.xAxis[0].setExtremes(min,max)}}});syncing=false}function removeAllHighCharts(){if(Highcharts.charts.length==0)return;$(Highcharts.charts).each(function(i,chart){if(chart!==undefined){chart.destroy();chart=undefined}});Highcharts.charts.splice(0,Highcharts.charts.length)}function formatDateTime(date){const dateString=date.toISOString();const dateParts=dateString.split("T");const dateTime=dateParts[1].split(".")[0];const dateTimeParts=dateTime.split(":");const formatted=dateParts[0]+" "+dateTimeParts[0]+":"+dateTimeParts[1];return formatted}function getDatePeriod(series,tdate){let fdate=null;for(let i=0;i<series.length;i++){if(series[i].category===tdate){break}fdate=series[i].category}const toDate=formatDateTime(new Date(tdate));const fromDate=formatDateTime(new Date(fdate));return fromDate+" ~ "+toDate}function createChart(chartDivId,title,titlealign,subtitle,tooltiptext,label,data,globalmax=null){if(document.getElementById("d3-style-tooltip")){document.getElementById("d3-style-tooltip").remove()}const tooltipDiv=document.createElement("div");tooltipDiv.id="d3-style-tooltip";tooltipDiv.style.cssText=`
    position: absolute;
    opacity: 0;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    border-radius: 3px;
    padding: 8px;
    font-size: 12px;
    font-family: sans-serif;
    pointer-events: none;
    transition: opacity 0.3s;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    z-index: 1000;
`;document.body.appendChild(tooltipDiv);(function(H){H.addEvent(H.Axis,"afterInit",function(){const logarithmic=this.logarithmic;if(logarithmic&&this.options.custom.allowNegativeLog){this.positiveValuesOnly=false;logarithmic.log2lin=num=>{const isNegative=num<0;let adjustedNum=Math.abs(num);if(adjustedNum<2){adjustedNum+=(2-adjustedNum)/2}const result=Math.log(adjustedNum)/Math.LN2;return isNegative?-result:result};logarithmic.lin2log=num=>{const isNegative=num<0;let result=Math.pow(2,Math.abs(num));if(result<2){result=2*(result-1)/(2-1)}return isNegative?-result:result}}})})(Highcharts);const chart=Highcharts.chart(chartDivId,{chart:{className:chartDivId,zoomType:"x",animation:true,panning:true,panKey:"shift",events:{load:function(event){chartLoading--;if(chartLoading===0)$("body").removeClass("loading");if(globalmax!=null){this.yAxis[0].setExtremes(0,globalmax)}else{let max=0;const chart=this;chart.series.forEach(series=>{series.points.forEach(point=>{max=point.y>max?point.y:max})});this.yAxis[0].setExtremes(0,max)}}},resetZoomButton:{theme:{style:{display:"block"}}}},title:{text:title,align:titlealign,y:0,floating:true,useHTML:true,style:{fontSize:"12px",cursor:"pointer"}},subtitle:{text:subtitle===""?"":subtitle},xAxis:{type:"datetime",events:{setExtremes:function(event){if(!syncing){if(g_ZoomingEnabled===false){const chart=this.chart;if(chart.zoomDebounceTimer){clearTimeout(chart.zoomDebounceTimer);chart.zoomDebounceTimer=null}showFullPageSpinner();processZoomAction(chart,event)}(async()=>{try{await syncZoom(chartDivId,event)}catch(error){console.error("Error syncing charts:",error);hideFullPageSpinner()}})()}}}},yAxis:{type:"logarithmic",custom:{allowNegativeLog:true},min:0,title:{text:"HPCP (inch)"}},legend:{enabled:false},plotOptions:{area:{fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,Highcharts.getOptions().colors[0]],[1,Highcharts.color(Highcharts.getOptions().colors[0]).setOpacity(0).get("rgba")]]},marker:{radius:2},lineWidth:1,states:{hover:{lineWidth:1}},threshold:null}},tooltip:{formatter:function(tooltip){if(this.y===0){return false}const seriesData=this.series.data;const datePeriod=getDatePeriod(seriesData,this.x);const header=`<span style="color: blue;">${datePeriod}</span><br/>`;return header+tooltip.bodyFormatter(this.points).join("")},xDateFormat:"%Y-%m-%d  %H:%M:%S",shared:true,backgroundColor:"rgba(255, 255, 255, 1)",shadow:false,borderRadius:8,borderWidth:1,borderColor:"black"},series:[{type:"area",name:label,data:data}],credits:{enabled:false},zooming:{mouseWheel:true}});setTimeout(()=>{const titleElement=chart.container.querySelector(".highcharts-title");if(titleElement){titleElement.addEventListener("mouseover",function(e){const tooltip=document.getElementById("d3-style-tooltip");tooltip.innerHTML=`
				<div style="border-bottom: 1px solid rgba(255,255,255,0.3); margin-bottom: 5px; padding-bottom: 5px">
					<strong>${title}</strong>
				</div>
				${tooltiptext}
			`;const tooltipWidth=tooltip.offsetWidth;const tooltipHeight=tooltip.offsetHeight;let left=e.clientX+window.scrollX+10;let top=e.clientY+window.scrollY-tooltipHeight-10;if(left+tooltipWidth>window.innerWidth){left=e.clientX+window.scrollX-tooltipWidth-10}if(top<window.scrollY){top=e.clientY+window.scrollY+10}tooltip.style.left=left+"px";tooltip.style.top=top+"px";tooltip.style.opacity="1"});titleElement.addEventListener("mouseout",function(){const tooltip=document.getElementById("d3-style-tooltip");tooltip.style.opacity="0"});titleElement.addEventListener("mousemove",function(e){const tooltip=document.getElementById("d3-style-tooltip");const tooltipWidth=tooltip.offsetWidth;const tooltipHeight=tooltip.offsetHeight;let left=e.clientX+window.scrollX+10;let top=e.clientY+window.scrollY-tooltipHeight-10;if(left+tooltipWidth>window.innerWidth){left=e.clientX+window.scrollX-tooltipWidth-10}if(top<window.scrollY){top=e.clientY+window.scrollY+10}tooltip.style.left=left+"px";tooltip.style.top=top+"px"})}},100);const initialMin=data[0][0];const initialMax=data[data.length-1][0];chart.container.addEventListener("click",function(e){if(e.target.textContent==="Reset zoom"){showFullPageSpinner();(async()=>{try{await new Promise(resolve=>{setTimeout(()=>{HichartZooming(null,null);resolve()},0)});await new Promise(resolve=>{setTimeout(()=>{Zoom_based_UpdateCharts(initialMin,initialMax);resolve()},0)})}catch(error){console.error("Error during reset zoom:",error)}finally{hideFullPageSpinner()}})()}})}