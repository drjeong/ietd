"use strict";import U from"../Core/Utilities.js";const{addEvent,pick}=U;var FocusBorderComposition;(function(FocusBorderComposition){const svgElementBorderUpdateTriggers=["x","y","transform","width","height","r","d","stroke-width"];function compose(ChartClass,SVGElementClass){const chartProto=ChartClass.prototype,svgElementProto=SVGElementClass.prototype;if(!chartProto.renderFocusBorder){chartProto.renderFocusBorder=chartRenderFocusBorder;chartProto.setFocusToElement=chartSetFocusToElement}if(!svgElementProto.addFocusBorder){svgElementProto.addFocusBorder=svgElementAddFocusBorder;svgElementProto.removeFocusBorder=svgElementRemoveFocusBorder}}FocusBorderComposition.compose=compose;function chartRenderFocusBorder(){const focusElement=this.focusElement,focusBorderOptions=this.options.accessibility.keyboardNavigation.focusBorder;if(focusElement){focusElement.removeFocusBorder();if(focusBorderOptions.enabled){focusElement.addFocusBorder(focusBorderOptions.margin,{stroke:focusBorderOptions.style.color,strokeWidth:focusBorderOptions.style.lineWidth,r:focusBorderOptions.style.borderRadius})}}}function chartSetFocusToElement(svgElement,focusElement){const focusBorderOptions=this.options.accessibility.keyboardNavigation.focusBorder,browserFocusElement=focusElement||svgElement.element;if(browserFocusElement&&browserFocusElement.focus){if(!(browserFocusElement.hcEvents&&browserFocusElement.hcEvents.focusin)){addEvent(browserFocusElement,"focusin",function(){})}browserFocusElement.focus();if(focusBorderOptions.hideBrowserFocusOutline){browserFocusElement.style.outline="none"}}if(this.focusElement){this.focusElement.removeFocusBorder()}this.focusElement=svgElement;this.renderFocusBorder()}function svgElementAddDestroyFocusBorderHook(el){if(el.focusBorderDestroyHook){return}const origDestroy=el.destroy;el.destroy=function(){if(el.focusBorder&&el.focusBorder.destroy){el.focusBorder.destroy()}return origDestroy.apply(el,arguments)};el.focusBorderDestroyHook=origDestroy}function svgElementAddFocusBorder(margin,attribs){if(this.focusBorder){this.removeFocusBorder()}const bb=this.getBBox(),pad=pick(margin,3),parent=this.parentGroup,scaleX=this.scaleX||parent&&parent.scaleX,scaleY=this.scaleY||parent&&parent.scaleY,oneDefined=scaleX?!scaleY:scaleY,scaleBoth=oneDefined?Math.abs(scaleX||scaleY||1):(Math.abs(scaleX||1)+Math.abs(scaleY||1))/2,lineHeight=this.renderer.fontMetrics(this).h;bb.x+=this.translateX?this.translateX:0;bb.y+=this.translateY?this.translateY:0;let borderPosX=bb.x-pad,borderPosY=bb.y-pad,borderWidth=bb.width+2*pad,borderHeight=bb.height+2*pad;function getTextAnchorCorrection(text){let posXCorrection=0,posYCorrection=0;if(text.attr("text-anchor")==="middle"){posXCorrection=posYCorrection=.5}else if(!text.rotation){posYCorrection=.75}else{posXCorrection=.25}return{x:posXCorrection,y:posYCorrection}}const isLabel=!!this.text;if(this.element.nodeName==="text"||isLabel){const isRotated=!!this.rotation;const correction=!isLabel?getTextAnchorCorrection(this):{x:isRotated?1:0,y:0};const attrX=+this.attr("x");const attrY=+this.attr("y");if(!isNaN(attrX)){borderPosX=attrX-bb.width*correction.x-pad}if(!isNaN(attrY)){const dim=this.attr("text-anchor")==="start"?lineHeight:bb.height;borderPosY=attrY-dim*correction.y-pad}if(isLabel&&isRotated){const temp=borderWidth;borderWidth=borderHeight;borderHeight=temp;if(!isNaN(attrX)){borderPosX=attrX-bb.height*correction.x-pad}if(!isNaN(attrY)){borderPosY=attrY-bb.width*correction.y-pad}}}this.focusBorder=this.renderer.rect(borderPosX,borderPosY,borderWidth,borderHeight,parseInt((attribs&&attribs.r||0).toString(),10)/scaleBoth).addClass("highcharts-focus-border").attr({zIndex:99}).add(parent);if(!this.renderer.styledMode){this.focusBorder.attr({stroke:attribs&&attribs.stroke,"stroke-width":(attribs&&attribs.strokeWidth||0)/scaleBoth})}avgElementAddUpdateFocusBorderHooks(this,margin,attribs);svgElementAddDestroyFocusBorderHook(this)}function avgElementAddUpdateFocusBorderHooks(el,...updateParams){if(el.focusBorderUpdateHooks){return}el.focusBorderUpdateHooks={};svgElementBorderUpdateTriggers.forEach(trigger=>{const setterKey=trigger+"Setter";const origSetter=el[setterKey]||el._defaultSetter;el.focusBorderUpdateHooks[setterKey]=origSetter;el[setterKey]=function(){const ret=origSetter.apply(el,arguments);el.addFocusBorder.apply(el,updateParams);return ret}})}function svgElementRemoveDestroyFocusBorderHook(el){if(!el.focusBorderDestroyHook){return}el.destroy=el.focusBorderDestroyHook;delete el.focusBorderDestroyHook}function svgElementRemoveFocusBorder(){svgElementRemoveUpdateFocusBorderHooks(this);svgElementRemoveDestroyFocusBorderHook(this);if(this.focusBorder){this.focusBorder.destroy();delete this.focusBorder}}function svgElementRemoveUpdateFocusBorderHooks(el){if(!el.focusBorderUpdateHooks){return}Object.keys(el.focusBorderUpdateHooks).forEach(setterKey=>{const origSetter=el.focusBorderUpdateHooks[setterKey];if(origSetter===el._defaultSetter){delete el[setterKey]}else{el[setterKey]=origSetter}});delete el.focusBorderUpdateHooks}})(FocusBorderComposition||(FocusBorderComposition={}));export default FocusBorderComposition;