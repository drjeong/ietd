"use strict";import H from"../../Core/Globals.js";const{doc}=H;import HU from"./HTMLUtilities.js";const{stripHTMLTagsFromString:stripHTMLTags}=HU;import U from"../../Core/Utilities.js";const{defined,find,fireEvent}=U;function fireEventOnWrappedOrUnwrappedElement(el,eventObject){const type=eventObject.type;const hcEvents=el.hcEvents;if(!!doc.createEvent&&(el.dispatchEvent||el.fireEvent)){if(el.dispatchEvent){el.dispatchEvent(eventObject)}else{el.fireEvent(type,eventObject)}}else if(hcEvents&&hcEvents[type]){fireEvent(el,type,eventObject)}else if(el.element){fireEventOnWrappedOrUnwrappedElement(el.element,eventObject)}}function getChartTitle(chart){return stripHTMLTags(chart.options.title.text||chart.langFormat("accessibility.defaultChartTitle",{chart:chart}),chart.renderer.forExport)}function getAxisDescription(axis){return axis&&(axis.options.accessibility?.description||axis.axisTitle?.textStr||axis.options.id||axis.categories&&"categories"||axis.dateTime&&"Time"||"values")}function getAxisRangeDescription(axis){const axisOptions=axis.options||{};if(axisOptions.accessibility&&typeof axisOptions.accessibility.rangeDescription!=="undefined"){return axisOptions.accessibility.rangeDescription}if(axis.categories){return getCategoryAxisRangeDesc(axis)}if(axis.dateTime&&(axis.min===0||axis.dataMin===0)){return getAxisTimeLengthDesc(axis)}return getAxisFromToDescription(axis)}function getCategoryAxisRangeDesc(axis){const chart=axis.chart;if(axis.dataMax&&axis.dataMin){return chart.langFormat("accessibility.axis.rangeCategories",{chart:chart,axis:axis,numCategories:axis.dataMax-axis.dataMin+1})}return""}function getAxisTimeLengthDesc(axis){const chart=axis.chart,range={},min=axis.dataMin||axis.min||0,max=axis.dataMax||axis.max||0;let rangeUnit="Seconds";range.Seconds=(max-min)/1e3;range.Minutes=range.Seconds/60;range.Hours=range.Minutes/60;range.Days=range.Hours/24;["Minutes","Hours","Days"].forEach(function(unit){if(range[unit]>2){rangeUnit=unit}});const rangeValue=range[rangeUnit].toFixed(rangeUnit!=="Seconds"&&rangeUnit!=="Minutes"?1:0);return chart.langFormat("accessibility.axis.timeRange"+rangeUnit,{chart:chart,axis:axis,range:rangeValue.replace(".0","")})}function getAxisFromToDescription(axis){const chart=axis.chart,options=chart.options,dateRangeFormat=options&&options.accessibility&&options.accessibility.screenReaderSection.axisRangeDateFormat||"",extremes={min:axis.dataMin||axis.min||0,max:axis.dataMax||axis.max||0},format=function(key){return axis.dateTime?chart.time.dateFormat(dateRangeFormat,extremes[key]):extremes[key].toString()};return chart.langFormat("accessibility.axis.rangeFromTo",{chart:chart,axis:axis,rangeFrom:format("min"),rangeTo:format("max")})}function getSeriesFirstPointElement(series){if(series.points&&series.points.length){const firstPointWithGraphic=find(series.points,p=>!!p.graphic);return firstPointWithGraphic&&firstPointWithGraphic.graphic&&firstPointWithGraphic.graphic.element}}function getSeriesA11yElement(series){const firstPointEl=getSeriesFirstPointElement(series);return firstPointEl&&firstPointEl.parentNode||series.graph&&series.graph.element||series.group&&series.group.element}function unhideChartElementFromAT(chart,element){element.setAttribute("aria-hidden",false);if(element===chart.renderTo||!element.parentNode||element.parentNode===doc.body){return}Array.prototype.forEach.call(element.parentNode.childNodes,function(node){if(!node.hasAttribute("aria-hidden")){node.setAttribute("aria-hidden",true)}});unhideChartElementFromAT(chart,element.parentNode)}function hideSeriesFromAT(series){const seriesEl=getSeriesA11yElement(series);if(seriesEl){seriesEl.setAttribute("aria-hidden",true)}}function getSeriesFromName(chart,name){if(!name){return chart.series}return(chart.series||[]).filter(function(s){return s.name===name})}function getPointFromXY(series,x,y){let i=series.length,res;while(i--){res=find(series[i].points||[],function(p){return p.x===x&&p.y===y});if(res){return res}}}function getRelativePointAxisPosition(axis,point){if(!defined(axis.dataMin)||!defined(axis.dataMax)){return 0}const axisStart=axis.toPixels(axis.dataMin),axisEnd=axis.toPixels(axis.dataMax),positionProp=axis.coll==="xAxis"?"x":"y",pointPos=axis.toPixels(point[positionProp]||0);return(pointPos-axisStart)/(axisEnd-axisStart)}function scrollAxisToPoint(point){const xAxis=point.series.xAxis,yAxis=point.series.yAxis,axis=xAxis&&xAxis.scrollbar?xAxis:yAxis,scrollbar=axis&&axis.scrollbar;if(scrollbar&&defined(scrollbar.to)&&defined(scrollbar.from)){const range=scrollbar.to-scrollbar.from;const pos=getRelativePointAxisPosition(axis,point);scrollbar.updatePosition(pos-range/2,pos+range/2);fireEvent(scrollbar,"changed",{from:scrollbar.from,to:scrollbar.to,trigger:"scrollbar",DOMEvent:null})}}const ChartUtilities={fireEventOnWrappedOrUnwrappedElement:fireEventOnWrappedOrUnwrappedElement,getChartTitle:getChartTitle,getAxisDescription:getAxisDescription,getAxisRangeDescription:getAxisRangeDescription,getPointFromXY:getPointFromXY,getSeriesFirstPointElement:getSeriesFirstPointElement,getSeriesFromName:getSeriesFromName,getSeriesA11yElement:getSeriesA11yElement,unhideChartElementFromAT:unhideChartElementFromAT,hideSeriesFromAT:hideSeriesFromAT,scrollAxisToPoint:scrollAxisToPoint};export default ChartUtilities;