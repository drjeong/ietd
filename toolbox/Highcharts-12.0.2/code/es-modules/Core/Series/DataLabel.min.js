"use strict";import A from"../Animation/AnimationUtilities.js";const{getDeferredAnimation}=A;import F from"../Templating.js";const{format}=F;import U from"../Utilities.js";const{defined,extend,fireEvent,getAlignFactor,isArray,isString,merge,objectEach,pick,pInt,splat}=U;var DataLabel;(function(DataLabel){function hasDataLabels(){return mergedDataLabelOptions(this).some(o=>o?.enabled)}function alignDataLabel(point,dataLabel,options,alignTo,isNew){const series=this,{chart,enabledDataSorting}=this,inverted=this.isCartesian&&chart.inverted,plotX=point.plotX,plotY=point.plotY,rotation=options.rotation||0,isInsidePlot=defined(plotX)&&defined(plotY)&&chart.isInsidePlot(plotX,Math.round(plotY),{inverted:inverted,paneCoordinates:true,series:series}),setStartPos=alignOptions=>{if(enabledDataSorting&&series.xAxis&&!justify){series.setDataLabelStartPos(point,dataLabel,isNew,isInsidePlot,alignOptions)}},justify=rotation===0?pick(options.overflow,enabledDataSorting?"none":"justify")==="justify":false;let visible=this.visible&&point.visible!==false&&defined(plotX)&&(point.series.forceDL||enabledDataSorting&&!justify||isInsidePlot||pick(options.inside,!!this.options.stacking)&&alignTo&&chart.isInsidePlot(plotX,inverted?alignTo.x+1:alignTo.y+alignTo.height-1,{inverted:inverted,paneCoordinates:true,series:series}));const pos=point.pos();if(visible&&pos){const bBox=dataLabel.getBBox(),unrotatedbBox=dataLabel.getBBox(void 0,0);alignTo=extend({x:pos[0],y:Math.round(pos[1]),width:0,height:0},alignTo||{});if(options.alignTo==="plotEdges"&&series.isCartesian){alignTo[inverted?"x":"y"]=0;alignTo[inverted?"width":"height"]=this.yAxis?.len||0}extend(options,{width:bBox.width,height:bBox.height});setStartPos(alignTo);dataLabel.align(merge(options,{width:unrotatedbBox.width,height:unrotatedbBox.height}),false,alignTo,false);dataLabel.alignAttr.x+=getAlignFactor(options.align)*(unrotatedbBox.width-bBox.width);dataLabel.alignAttr.y+=getAlignFactor(options.verticalAlign)*(unrotatedbBox.height-bBox.height);dataLabel[dataLabel.placed?"animate":"attr"]({x:dataLabel.alignAttr.x+(bBox.width-unrotatedbBox.width)/2,y:dataLabel.alignAttr.y+(bBox.height-unrotatedbBox.height)/2,rotationOriginX:(dataLabel.width||0)/2,rotationOriginY:(dataLabel.height||0)/2});if(justify&&alignTo.height>=0){this.justifyDataLabel(dataLabel,options,dataLabel.alignAttr,bBox,alignTo,isNew)}else if(pick(options.crop,true)){const{x,y}=dataLabel.alignAttr,correction=1;visible=chart.isInsidePlot(x,y,{paneCoordinates:true,series:series})&&chart.isInsidePlot(x+bBox.width-correction,y+bBox.height-correction,{paneCoordinates:true,series:series})}if(options.shape&&!rotation){dataLabel[isNew?"attr":"animate"]({anchorX:pos[0],anchorY:pos[1]})}}if(isNew&&enabledDataSorting){dataLabel.placed=false}if(!visible&&(!enabledDataSorting||justify)){dataLabel.hide();dataLabel.placed=false}else{dataLabel.show();dataLabel.placed=true}}function applyFilter(point,options){const filter=options.filter;if(filter){const op=filter.operator,prop=point[filter.property],val=filter.value;if(op===">"&&prop>val||op==="<"&&prop<val||op===">="&&prop>=val||op==="<="&&prop<=val||op==="=="&&prop==val||op==="==="&&prop===val||op==="!="&&prop!=val||op==="!=="&&prop!==val){return true}return false}return true}function compose(SeriesClass){const seriesProto=SeriesClass.prototype;if(!seriesProto.initDataLabels){seriesProto.initDataLabels=initDataLabels;seriesProto.initDataLabelsGroup=initDataLabelsGroup;seriesProto.alignDataLabel=alignDataLabel;seriesProto.drawDataLabels=drawDataLabels;seriesProto.justifyDataLabel=justifyDataLabel;seriesProto.setDataLabelStartPos=setDataLabelStartPos;seriesProto.hasDataLabels=hasDataLabels}}DataLabel.compose=compose;function initDataLabelsGroup(){return this.plotGroup("dataLabelsGroup","data-labels",this.hasRendered?"inherit":"hidden",this.options.dataLabels.zIndex||6)}function initDataLabels(animationConfig){const series=this,hasRendered=series.hasRendered||0;const dataLabelsGroup=this.initDataLabelsGroup().attr({opacity:+hasRendered});if(!hasRendered&&dataLabelsGroup){if(series.visible){dataLabelsGroup.show()}if(series.options.animation){dataLabelsGroup.animate({opacity:1},animationConfig)}else{dataLabelsGroup.attr({opacity:1})}}return dataLabelsGroup}function drawDataLabels(points){points=points||this.points;const series=this,chart=series.chart,seriesOptions=series.options,renderer=chart.renderer,{backgroundColor,plotBackgroundColor}=chart.options.chart,contrastColor=renderer.getContrast(isString(plotBackgroundColor)&&plotBackgroundColor||isString(backgroundColor)&&backgroundColor||"#000000"),seriesDlOptions=mergedDataLabelOptions(series);let pointOptions,dataLabelsGroup;const{animation,defer}=seriesDlOptions[0],animationConfig=defer?getDeferredAnimation(chart,animation,series):{defer:0,duration:0};fireEvent(this,"drawDataLabels");if(series.hasDataLabels?.()){dataLabelsGroup=this.initDataLabels(animationConfig);points.forEach(point=>{const dataLabels=point.dataLabels||[];pointOptions=splat(mergeArrays(seriesDlOptions,point.dlOptions||point.options?.dataLabels));pointOptions.forEach((labelOptions,i)=>{const labelEnabled=labelOptions.enabled&&(point.visible||point.dataLabelOnHidden)&&(!point.isNull||point.dataLabelOnNull)&&applyFilter(point,labelOptions),{backgroundColor,borderColor,distance,style={}}=labelOptions;let formatString,labelText,rotation,attr={},dataLabel=dataLabels[i],isNew=!dataLabel,labelBgColor;if(labelEnabled){formatString=pick(labelOptions[point.formatPrefix+"Format"],labelOptions.format);labelText=defined(formatString)?format(formatString,point,chart):(labelOptions[point.formatPrefix+"Formatter"]||labelOptions.formatter).call(point,labelOptions);rotation=labelOptions.rotation;if(!chart.styledMode){style.color=pick(labelOptions.color,style.color,isString(series.color)?series.color:void 0,"#000000");if(style.color==="contrast"){if(backgroundColor!=="none"){labelBgColor=backgroundColor}point.contrastColor=renderer.getContrast(labelBgColor!=="auto"&&labelBgColor||(point.color||series.color));style.color=labelBgColor||!defined(distance)&&labelOptions.inside||pInt(distance||0)<0||seriesOptions.stacking?point.contrastColor:contrastColor}else{delete point.contrastColor}if(seriesOptions.cursor){style.cursor=seriesOptions.cursor}}attr={r:labelOptions.borderRadius||0,rotation:rotation,padding:labelOptions.padding,zIndex:1};if(!chart.styledMode){attr.fill=backgroundColor==="auto"?point.color:backgroundColor;attr.stroke=borderColor==="auto"?point.color:borderColor;attr["stroke-width"]=labelOptions.borderWidth}objectEach(attr,(val,name)=>{if(typeof val==="undefined"){delete attr[name]}})}if(dataLabel&&(!labelEnabled||!defined(labelText)||!!dataLabel.div!==!!labelOptions.useHTML||(!dataLabel.rotation||!labelOptions.rotation)&&dataLabel.rotation!==labelOptions.rotation)){dataLabel=void 0;isNew=true}if(labelEnabled&&defined(labelText)){if(!dataLabel){dataLabel=renderer.label(labelText,0,0,labelOptions.shape,void 0,void 0,labelOptions.useHTML,void 0,"data-label");dataLabel.addClass(" highcharts-data-label-color-"+point.colorIndex+" "+(labelOptions.className||"")+(labelOptions.useHTML?" highcharts-tracker":""))}else{attr.text=labelText}if(dataLabel){dataLabel.options=labelOptions;dataLabel.attr(attr);if(!chart.styledMode){dataLabel.css(style).shadow(labelOptions.shadow)}else if(style.width){dataLabel.css({width:style.width,textOverflow:style.textOverflow,whiteSpace:style.whiteSpace})}fireEvent(dataLabel,"beforeAddingDataLabel",{labelOptions:labelOptions,point:point});if(!dataLabel.added){dataLabel.add(dataLabelsGroup)}series.alignDataLabel(point,dataLabel,labelOptions,void 0,isNew);dataLabel.isActive=true;if(dataLabels[i]&&dataLabels[i]!==dataLabel){dataLabels[i].destroy()}dataLabels[i]=dataLabel}}});let j=dataLabels.length;while(j--){if(!dataLabels[j]||!dataLabels[j].isActive){dataLabels[j]?.destroy();dataLabels.splice(j,1)}else{dataLabels[j].isActive=false}}point.dataLabel=dataLabels[0];point.dataLabels=dataLabels})}fireEvent(this,"afterDrawDataLabels")}function justifyDataLabel(dataLabel,options,alignAttr,bBox,alignTo,isNew){const chart=this.chart,align=options.align,verticalAlign=options.verticalAlign,padding=dataLabel.box?0:dataLabel.padding||0,horizontalAxis=chart.inverted?this.yAxis:this.xAxis,horizontalAxisShift=horizontalAxis?horizontalAxis.left-chart.plotLeft:0,verticalAxis=chart.inverted?this.xAxis:this.yAxis,verticalAxisShift=verticalAxis?verticalAxis.top-chart.plotTop:0;let{x=0,y=0}=options,off,justified;off=(alignAttr.x||0)+padding+horizontalAxisShift;if(off<0){if(align==="right"&&x>=0){options.align="left";options.inside=true}else{x-=off}justified=true}off=(alignAttr.x||0)+bBox.width-padding+horizontalAxisShift;if(off>chart.plotWidth){if(align==="left"&&x<=0){options.align="right";options.inside=true}else{x+=chart.plotWidth-off}justified=true}off=alignAttr.y+padding+verticalAxisShift;if(off<0){if(verticalAlign==="bottom"&&y>=0){options.verticalAlign="top";options.inside=true}else{y-=off}justified=true}off=(alignAttr.y||0)+bBox.height-padding+verticalAxisShift;if(off>chart.plotHeight){if(verticalAlign==="top"&&y<=0){options.verticalAlign="bottom";options.inside=true}else{y+=chart.plotHeight-off}justified=true}if(justified){options.x=x;options.y=y;dataLabel.placed=!isNew;dataLabel.align(options,void 0,alignTo)}return justified}function mergeArrays(one,two){let res=[],i;if(isArray(one)&&!isArray(two)){res=one.map(function(el){return merge(el,two)})}else if(isArray(two)&&!isArray(one)){res=two.map(function(el){return merge(one,el)})}else if(!isArray(one)&&!isArray(two)){res=merge(one,two)}else if(isArray(one)&&isArray(two)){i=Math.max(one.length,two.length);while(i--){res[i]=merge(one[i],two[i])}}return res}function mergedDataLabelOptions(series){const plotOptions=series.chart.options.plotOptions;return splat(mergeArrays(mergeArrays(plotOptions?.series?.dataLabels,plotOptions?.[series.type]?.dataLabels),series.options.dataLabels))}function setDataLabelStartPos(point,dataLabel,isNew,isInside,alignOptions){const chart=this.chart,inverted=chart.inverted,xAxis=this.xAxis,reversed=xAxis.reversed,labelCenter=((inverted?dataLabel.height:dataLabel.width)||0)/2,pointWidth=point.pointWidth,halfWidth=pointWidth?pointWidth/2:0;dataLabel.startXPos=inverted?alignOptions.x:reversed?-labelCenter-halfWidth:xAxis.width-labelCenter+halfWidth;dataLabel.startYPos=inverted?reversed?this.yAxis.height-labelCenter+halfWidth:-labelCenter-halfWidth:alignOptions.y;if(!isInside){dataLabel.attr({opacity:1}).animate({opacity:0},void 0,dataLabel.hide)}else if(dataLabel.visibility==="hidden"){dataLabel.show();dataLabel.attr({opacity:0}).animate({opacity:1})}if(!chart.hasRendered){return}if(isNew){dataLabel.attr({x:dataLabel.startXPos,y:dataLabel.startYPos})}dataLabel.placed=true}})(DataLabel||(DataLabel={}));export default DataLabel;"";