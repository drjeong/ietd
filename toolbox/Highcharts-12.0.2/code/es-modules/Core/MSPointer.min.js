"use strict";import H from"./Globals.js";const{charts,composed,doc,noop,win}=H;import Pointer from"./Pointer.js";import U from"./Utilities.js";const{addEvent,attr,css,defined,objectEach,pick,pushUnique,removeEvent}=U;const touches={};const hasPointerEvent=!!win.PointerEvent;function getWebkitTouches(){const fake=[];fake.item=function(i){return this[i]};objectEach(touches,function(touch){fake.push({pageX:touch.pageX,pageY:touch.pageY,target:touch.target})});return fake}function translateMSPointer(e,method,wktype,func){const pointer=charts[Pointer.hoverChartIndex??-1]?.pointer;if(pointer&&(e.pointerType==="touch"||e.pointerType===e.MSPOINTER_TYPE_TOUCH)){func(e);pointer[method]({type:wktype,target:e.currentTarget,preventDefault:noop,touches:getWebkitTouches()})}}class MSPointer extends Pointer{static isRequired(){return!!(!win.TouchEvent&&(win.PointerEvent||win.MSPointerEvent))}batchMSEvents(fn){fn(this.chart.container,hasPointerEvent?"pointerdown":"MSPointerDown",this.onContainerPointerDown);fn(this.chart.container,hasPointerEvent?"pointermove":"MSPointerMove",this.onContainerPointerMove);fn(doc,hasPointerEvent?"pointerup":"MSPointerUp",this.onDocumentPointerUp)}destroy(){this.batchMSEvents(removeEvent);super.destroy()}constructor(chart,options){super(chart,options);if(this.hasZoom){css(chart.container,{"-ms-touch-action":"none","touch-action":"none"})}}inClass(element,className){let elem=element,elemClassName;while(elem){elemClassName=attr(elem,"class");if(elemClassName){if(elemClassName.indexOf(className)!==-1){return true}if(elemClassName.indexOf("highcharts-container")!==-1){return false}}elem=elem.parentNode;if(elem&&(elem===document.documentElement||defined(elem.nodeType)&&elem.nodeType===document.nodeType)){elem=null}}}onContainerPointerDown(e){translateMSPointer(e,"onContainerTouchStart","touchstart",function(e){touches[e.pointerId]={pageX:e.pageX,pageY:e.pageY,target:e.currentTarget}})}onContainerPointerMove(e){translateMSPointer(e,"onContainerTouchMove","touchmove",function(e){touches[e.pointerId]={pageX:e.pageX,pageY:e.pageY};if(!touches[e.pointerId].target){touches[e.pointerId].target=e.currentTarget}})}onDocumentPointerUp(e){translateMSPointer(e,"onDocumentTouchEnd","touchend",function(e){delete touches[e.pointerId]})}setDOMEvents(){const tooltip=this.chart.tooltip;super.setDOMEvents();if(this.hasZoom||pick(tooltip&&tooltip.options.followTouchMove,true)){this.batchMSEvents(addEvent)}}}(function(MSPointer){function compose(ChartClass){if(pushUnique(composed,"Core.MSPointer")){addEvent(ChartClass,"beforeRender",function(){this.pointer=new MSPointer(this,this.options)})}}MSPointer.compose=compose})(MSPointer||(MSPointer={}));export default MSPointer;