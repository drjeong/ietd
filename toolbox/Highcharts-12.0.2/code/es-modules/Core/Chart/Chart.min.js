"use strict";import A from"../Animation/AnimationUtilities.js";const{animate,animObject,setAnimation}=A;import Axis from"../Axis/Axis.js";import D from"../Defaults.js";const{defaultOptions}=D;import Templating from"../Templating.js";const{numberFormat}=Templating;import Foundation from"../Foundation.js";const{registerEventOptions}=Foundation;import H from"../Globals.js";const{charts,doc,marginNames,svg,win}=H;import RendererRegistry from"../Renderer/RendererRegistry.js";import Series from"../Series/Series.js";import SeriesRegistry from"../Series/SeriesRegistry.js";const{seriesTypes}=SeriesRegistry;import SVGRenderer from"../Renderer/SVG/SVGRenderer.js";import Time from"../Time.js";import U from"../Utilities.js";import AST from"../Renderer/HTML/AST.js";import Tick from"../Axis/Tick.js";const{addEvent,attr,createElement,css,defined,diffObjects,discardElement,erase,error,extend,find,fireEvent,getAlignFactor,getStyle,isArray,isNumber,isObject,isString,merge,objectEach,pick,pInt,relativeLength,removeEvent,splat,syncTimeout,uniqueKey}=U;class Chart{static chart(a,b,c){return new Chart(a,b,c)}constructor(a,b,c){this.sharedClips={};const args=[...arguments];if(isString(a)||a.nodeName){this.renderTo=args.shift()}this.init(args[0],args[1])}setZoomOptions(){const chart=this,options=chart.options.chart,zooming=options.zooming;chart.zooming={...zooming,type:pick(options.zoomType,zooming.type),key:pick(options.zoomKey,zooming.key),pinchType:pick(options.pinchType,zooming.pinchType),singleTouch:pick(options.zoomBySingleTouch,zooming.singleTouch,false),resetButton:merge(zooming.resetButton,options.resetZoomButton)}}init(userOptions,callback){fireEvent(this,"init",{args:arguments},function(){const options=merge(defaultOptions,userOptions),optionsChart=options.chart,renderTo=this.renderTo||optionsChart.renderTo;this.userOptions=extend({},userOptions);if(!(this.renderTo=isString(renderTo)?doc.getElementById(renderTo):renderTo)){error(13,true,this)}this.margin=[];this.spacing=[];this.labelCollectors=[];this.callback=callback;this.isResizing=0;this.options=options;this.axes=[];this.series=[];this.locale=options.lang.locale??this.renderTo.closest("[lang]")?.lang;this.time=new Time(extend(options.time||{},{locale:this.locale}));options.time=this.time.options;this.numberFormatter=(optionsChart.numberFormatter||numberFormat).bind(this);this.styledMode=optionsChart.styledMode;this.hasCartesianSeries=optionsChart.showAxes;const chart=this;chart.index=charts.length;charts.push(chart);H.chartCount++;registerEventOptions(this,optionsChart);chart.xAxis=[];chart.yAxis=[];chart.pointCount=chart.colorCounter=chart.symbolCounter=0;this.setZoomOptions();fireEvent(chart,"afterInit");chart.firstRender()})}initSeries(options){const chart=this,optionsChart=chart.options.chart,type=options.type||optionsChart.type,SeriesClass=seriesTypes[type];if(!SeriesClass){error(17,true,chart,{missingModuleFor:type})}const series=new SeriesClass;if(typeof series.init==="function"){series.init(chart,options)}return series}setSortedData(){this.getSeriesOrderByLinks().forEach(function(series){if(!series.points&&!series.data&&series.enabledDataSorting){series.setData(series.options.data,false)}})}getSeriesOrderByLinks(){return this.series.concat().sort(function(a,b){if(a.linkedSeries.length||b.linkedSeries.length){return b.linkedSeries.length-a.linkedSeries.length}return 0})}orderItems(coll,fromIndex=0){const collection=this[coll],optionsArray=this.options[coll]=splat(this.options[coll]).slice(),userOptionsArray=this.userOptions[coll]=this.userOptions[coll]?splat(this.userOptions[coll]).slice():[];if(this.hasRendered){optionsArray.splice(fromIndex);userOptionsArray.splice(fromIndex)}if(collection){for(let i=fromIndex,iEnd=collection.length;i<iEnd;++i){const item=collection[i];if(item){item.index=i;if(item instanceof Series){item.name=item.getName()}if(!item.options.isInternal){optionsArray[i]=item.options;userOptionsArray[i]=item.userOptions}}}}}isInsidePlot(plotX,plotY,options={}){const{inverted,plotBox,plotLeft,plotTop,scrollablePlotBox}=this,{scrollLeft=0,scrollTop=0}=options.visiblePlotOnly&&this.scrollablePlotArea?.scrollingContainer||{},series=options.series,box=options.visiblePlotOnly&&scrollablePlotBox||plotBox,x=options.inverted?plotY:plotX,y=options.inverted?plotX:plotY,e={x:x,y:y,isInsidePlot:true,options:options};if(!options.ignoreX){const xAxis=series&&(inverted&&!this.polar?series.yAxis:series.xAxis)||{pos:plotLeft,len:Infinity};const chartX=options.paneCoordinates?xAxis.pos+x:plotLeft+x;if(!(chartX>=Math.max(scrollLeft+plotLeft,xAxis.pos)&&chartX<=Math.min(scrollLeft+plotLeft+box.width,xAxis.pos+xAxis.len))){e.isInsidePlot=false}}if(!options.ignoreY&&e.isInsidePlot){const yAxis=!inverted&&options.axis&&!options.axis.isXAxis&&options.axis||series&&(inverted?series.xAxis:series.yAxis)||{pos:plotTop,len:Infinity};const chartY=options.paneCoordinates?yAxis.pos+y:plotTop+y;if(!(chartY>=Math.max(scrollTop+plotTop,yAxis.pos)&&chartY<=Math.min(scrollTop+plotTop+box.height,yAxis.pos+yAxis.len))){e.isInsidePlot=false}}fireEvent(this,"afterIsInsidePlot",e);return e.isInsidePlot}redraw(animation){fireEvent(this,"beforeRedraw");const chart=this,axes=chart.hasCartesianSeries?chart.axes:chart.colorAxis||[],series=chart.series,pointer=chart.pointer,legend=chart.legend,legendUserOptions=chart.userOptions.legend,renderer=chart.renderer,isHiddenChart=renderer.isHidden(),afterRedraw=[];let hasDirtyStacks,hasStackedSeries,i,isDirtyBox=chart.isDirtyBox,redrawLegend=chart.isDirtyLegend,serie;renderer.rootFontSize=renderer.boxWrapper.getStyle("font-size");if(chart.setResponsive){chart.setResponsive(false)}setAnimation(chart.hasRendered?animation:false,chart);if(isHiddenChart){chart.temporaryDisplay()}chart.layOutTitles(false);i=series.length;while(i--){serie=series[i];if(serie.options.stacking||serie.options.centerInCategory){hasStackedSeries=true;if(serie.isDirty){hasDirtyStacks=true;break}}}if(hasDirtyStacks){i=series.length;while(i--){serie=series[i];if(serie.options.stacking){serie.isDirty=true}}}series.forEach(function(serie){if(serie.isDirty){if(serie.options.legendType==="point"){if(typeof serie.updateTotals==="function"){serie.updateTotals()}redrawLegend=true}else if(legendUserOptions&&(!!legendUserOptions.labelFormatter||legendUserOptions.labelFormat)){redrawLegend=true}}if(serie.isDirtyData){fireEvent(serie,"updatedData")}});if(redrawLegend&&legend&&legend.options.enabled){legend.render();chart.isDirtyLegend=false}if(hasStackedSeries){chart.getStacks()}axes.forEach(function(axis){axis.updateNames();axis.setScale()});chart.getMargins();axes.forEach(function(axis){if(axis.isDirty){isDirtyBox=true}});axes.forEach(function(axis){const key=axis.min+","+axis.max;if(axis.extKey!==key){axis.extKey=key;afterRedraw.push(function(){fireEvent(axis,"afterSetExtremes",extend(axis.eventArgs,axis.getExtremes()));delete axis.eventArgs})}if(isDirtyBox||hasStackedSeries){axis.redraw()}});if(isDirtyBox){chart.drawChartBox()}fireEvent(chart,"predraw");series.forEach(function(serie){if((isDirtyBox||serie.isDirty)&&serie.visible){serie.redraw()}serie.isDirtyData=false});if(pointer){pointer.reset(true)}renderer.draw();fireEvent(chart,"redraw");fireEvent(chart,"render");if(isHiddenChart){chart.temporaryDisplay(true)}afterRedraw.forEach(function(callback){callback.call()})}get(id){const series=this.series;function itemById(item){return item.id===id||item.options&&item.options.id===id}let ret=find(this.axes,itemById)||find(this.series,itemById);for(let i=0;!ret&&i<series.length;i++){ret=find(series[i].points||[],itemById)}return ret}createAxes(){const options=this.userOptions;fireEvent(this,"createAxes");for(const coll of["xAxis","yAxis"]){const arr=options[coll]=splat(options[coll]||{});for(const axisOptions of arr){new Axis(this,axisOptions,coll)}}fireEvent(this,"afterCreateAxes")}getSelectedPoints(){return this.series.reduce((acc,series)=>{series.getPointsCollection().forEach(point=>{if(pick(point.selectedStaging,point.selected)){acc.push(point)}});return acc},[])}getSelectedSeries(){return this.series.filter(s=>s.selected)}setTitle(titleOptions,subtitleOptions,redraw){this.applyDescription("title",titleOptions);this.applyDescription("subtitle",subtitleOptions);this.applyDescription("caption",void 0);this.layOutTitles(redraw)}applyDescription(key,explicitOptions){const chart=this;const options=this.options[key]=merge(this.options[key],explicitOptions);let elem=this[key];if(elem&&explicitOptions){this[key]=elem=elem.destroy()}if(options&&!elem){elem=this.renderer.text(options.text,0,0,options.useHTML).attr({align:options.align,class:"highcharts-"+key,zIndex:options.zIndex||4}).css({textOverflow:"ellipsis",whiteSpace:"nowrap"}).add();elem.update=function(updateOptions,redraw){chart.applyDescription(key,updateOptions);chart.layOutTitles(redraw)};if(!this.styledMode){elem.css(extend(key==="title"?{fontSize:this.options.isStock?"1em":"1.2em"}:{},options.style))}elem.textPxLength=elem.getBBox().width;elem.css({whiteSpace:options.style?.whiteSpace});this[key]=elem}}layOutTitles(redraw=true){const titleOffset=[0,0,0],{options,renderer,spacingBox}=this;["title","subtitle","caption"].forEach(key=>{const desc=this[key],descOptions=this.options[key],alignTo=merge(spacingBox),textPxLength=desc?.textPxLength||0;if(desc&&descOptions){fireEvent(this,"layOutTitle",{alignTo:alignTo,key:key,textPxLength:textPxLength});const fontMetrics=renderer.fontMetrics(desc),baseline=fontMetrics.b,lineHeight=fontMetrics.h,verticalAlign=descOptions.verticalAlign||"top",topAligned=verticalAlign==="top",minScale=topAligned&&descOptions.minScale||1,offset=key==="title"?topAligned?-3:0:topAligned?titleOffset[0]+2:0,uncappedScale=Math.min(alignTo.width/textPxLength,1),scale=Math.max(minScale,uncappedScale),alignAttr=merge({y:verticalAlign==="bottom"?baseline:offset+baseline},{align:key==="title"?uncappedScale<minScale?"left":"center":this.title?.alignValue},descOptions),width=descOptions.width||(uncappedScale>minScale?this.chartWidth:alignTo.width)/scale;if(desc.alignValue!==alignAttr.align){desc.placed=false}const height=Math.round(desc.css({width:`${width}px`}).getBBox(descOptions.useHTML).height);alignAttr.height=height;desc.align(alignAttr,false,alignTo).attr({align:alignAttr.align,scaleX:scale,scaleY:scale,"transform-origin":`${alignTo.x+textPxLength*scale*getAlignFactor(alignAttr.align)} ${lineHeight}`});if(!descOptions.floating){const offset=height*(height<lineHeight*1.2?1:scale);if(verticalAlign==="top"){titleOffset[0]=Math.ceil(titleOffset[0]+offset)}else if(verticalAlign==="bottom"){titleOffset[2]=Math.ceil(titleOffset[2]+offset)}}}},this);if(titleOffset[0]&&(options.title?.verticalAlign||"top")==="top"){titleOffset[0]+=options.title?.margin||0}if(titleOffset[2]&&options.caption?.verticalAlign==="bottom"){titleOffset[2]+=options.caption?.margin||0}const requiresDirtyBox=!this.titleOffset||this.titleOffset.join(",")!==titleOffset.join(",");this.titleOffset=titleOffset;fireEvent(this,"afterLayOutTitles");if(!this.isDirtyBox&&requiresDirtyBox){this.isDirtyBox=this.isDirtyLegend=requiresDirtyBox;if(this.hasRendered&&redraw&&this.isDirtyBox){this.redraw()}}}getContainerBox(){const nonContainers=[].map.call(this.renderTo.children,child=>{if(child!==this.container){const display=child.style.display;child.style.display="none";return[child,display]}}),box={width:getStyle(this.renderTo,"width",true)||0,height:getStyle(this.renderTo,"height",true)||0};nonContainers.filter(Boolean).forEach(([div,display])=>{div.style.display=display});return box}getChartSize(){const chart=this,optionsChart=chart.options.chart,widthOption=optionsChart.width,heightOption=optionsChart.height,containerBox=chart.getContainerBox(),enableDefaultHeight=containerBox.height<=1||!chart.renderTo.parentElement?.style.height&&chart.renderTo.style.height==="100%";chart.chartWidth=Math.max(0,widthOption||containerBox.width||600);chart.chartHeight=Math.max(0,relativeLength(heightOption,chart.chartWidth)||(enableDefaultHeight?400:containerBox.height));chart.containerBox=containerBox}temporaryDisplay(revert){let node=this.renderTo,tempStyle;if(!revert){while(node&&node.style){if(!doc.body.contains(node)&&!node.parentNode){node.hcOrigDetached=true;doc.body.appendChild(node)}if(getStyle(node,"display",false)==="none"||node.hcOricDetached){node.hcOrigStyle={display:node.style.display,height:node.style.height,overflow:node.style.overflow};tempStyle={display:"block",overflow:"hidden"};if(node!==this.renderTo){tempStyle.height=0}css(node,tempStyle);if(!node.offsetWidth){node.style.setProperty("display","block","important")}}node=node.parentNode;if(node===doc.body){break}}}else{while(node&&node.style){if(node.hcOrigStyle){css(node,node.hcOrigStyle);delete node.hcOrigStyle}if(node.hcOrigDetached){doc.body.removeChild(node);node.hcOrigDetached=false}node=node.parentNode}}}setClassName(className){this.container.className="highcharts-container "+(className||"")}getContainer(){const chart=this,options=chart.options,optionsChart=options.chart,indexAttrName="data-highcharts-chart",containerId=uniqueKey(),renderTo=chart.renderTo;let containerStyle;const oldChartIndex=pInt(attr(renderTo,indexAttrName));if(isNumber(oldChartIndex)&&charts[oldChartIndex]&&charts[oldChartIndex].hasRendered){charts[oldChartIndex].destroy()}attr(renderTo,indexAttrName,chart.index);renderTo.innerHTML=AST.emptyHTML;if(!optionsChart.skipClone&&!renderTo.offsetWidth){chart.temporaryDisplay()}chart.getChartSize();const chartHeight=chart.chartHeight;let chartWidth=chart.chartWidth;css(renderTo,{overflow:"hidden"});if(!chart.styledMode){containerStyle=extend({position:"relative",overflow:"hidden",width:chartWidth+"px",height:chartHeight+"px",textAlign:"left",lineHeight:"normal",zIndex:0,"-webkit-tap-highlight-color":"rgba(0,0,0,0)",userSelect:"none","touch-action":"manipulation",outline:"none",padding:"0px"},optionsChart.style||{})}const container=createElement("div",{id:containerId},containerStyle,renderTo);chart.container=container;chart.getChartSize();if(chartWidth!==chart.chartWidth){chartWidth=chart.chartWidth;if(!chart.styledMode){css(container,{width:pick(optionsChart.style?.width,chartWidth+"px")})}}chart.containerBox=chart.getContainerBox();chart._cursor=container.style.cursor;const Renderer=optionsChart.renderer||!svg?RendererRegistry.getRendererType(optionsChart.renderer):SVGRenderer;chart.renderer=new Renderer(container,chartWidth,chartHeight,void 0,optionsChart.forExport,options.exporting&&options.exporting.allowHTML,chart.styledMode);setAnimation(void 0,chart);chart.setClassName(optionsChart.className);if(!chart.styledMode){chart.renderer.setStyle(optionsChart.style)}else{for(const key in options.defs){this.renderer.definition(options.defs[key])}}chart.renderer.chartIndex=chart.index;fireEvent(this,"afterGetContainer")}getMargins(skipAxes){const{spacing,margin,titleOffset}=this;this.resetMargins();if(titleOffset[0]&&!defined(margin[0])){this.plotTop=Math.max(this.plotTop,titleOffset[0]+spacing[0])}if(titleOffset[2]&&!defined(margin[2])){this.marginBottom=Math.max(this.marginBottom,titleOffset[2]+spacing[2])}if(this.legend&&this.legend.display){this.legend.adjustMargins(margin,spacing)}fireEvent(this,"getMargins");if(!skipAxes){this.getAxisMargins()}}getAxisMargins(){const chart=this,axisOffset=chart.axisOffset=[0,0,0,0],colorAxis=chart.colorAxis,margin=chart.margin,getOffset=function(axes){axes.forEach(function(axis){if(axis.visible){axis.getOffset()}})};if(chart.hasCartesianSeries){getOffset(chart.axes)}else if(colorAxis&&colorAxis.length){getOffset(colorAxis)}marginNames.forEach(function(m,side){if(!defined(margin[side])){chart[m]+=axisOffset[side]}});chart.setChartSize()}getOptions(){return diffObjects(this.userOptions,defaultOptions)}reflow(e){const chart=this,oldBox=chart.containerBox,containerBox=chart.getContainerBox();delete chart.pointer?.chartPosition;if(!chart.isPrinting&&!chart.isResizing&&oldBox&&containerBox.width){if(containerBox.width!==oldBox.width||containerBox.height!==oldBox.height){U.clearTimeout(chart.reflowTimeout);chart.reflowTimeout=syncTimeout(function(){if(chart.container){chart.setSize(void 0,void 0,false)}},e?100:0)}chart.containerBox=containerBox}}setReflow(){const chart=this;const runReflow=e=>{if(chart.options?.chart.reflow&&chart.hasLoaded){chart.reflow(e)}};if(typeof ResizeObserver==="function"){new ResizeObserver(runReflow).observe(chart.renderTo)}else{const unbind=addEvent(win,"resize",runReflow);addEvent(this,"destroy",unbind)}}setSize(width,height,animation){const chart=this,renderer=chart.renderer;chart.isResizing+=1;setAnimation(animation,chart);const globalAnimation=renderer.globalAnimation;chart.oldChartHeight=chart.chartHeight;chart.oldChartWidth=chart.chartWidth;if(typeof width!=="undefined"){chart.options.chart.width=width}if(typeof height!=="undefined"){chart.options.chart.height=height}chart.getChartSize();const{chartWidth,chartHeight,scrollablePixelsX=0,scrollablePixelsY=0}=chart;if(chart.isDirtyBox||chartWidth!==chart.oldChartWidth||chartHeight!==chart.oldChartHeight){if(!chart.styledMode){(globalAnimation?animate:css)(chart.container,{width:`${chartWidth+scrollablePixelsX}px`,height:`${chartHeight+scrollablePixelsY}px`},globalAnimation)}chart.setChartSize(true);renderer.setSize(chartWidth,chartHeight,globalAnimation);chart.axes.forEach(function(axis){axis.isDirty=true;axis.setScale()});chart.isDirtyLegend=true;chart.isDirtyBox=true;chart.layOutTitles();chart.getMargins();chart.redraw(globalAnimation);chart.oldChartHeight=void 0;fireEvent(chart,"resize");setTimeout(()=>{if(chart){fireEvent(chart,"endResize")}},animObject(globalAnimation).duration)}chart.isResizing-=1}setChartSize(skipAxes){const chart=this,{chartHeight,chartWidth,inverted,spacing,renderer}=chart,clipOffset=chart.clipOffset,clipRoundFunc=Math[inverted?"floor":"round"];let plotLeft,plotTop,plotWidth,plotHeight;chart.plotLeft=plotLeft=Math.round(chart.plotLeft);chart.plotTop=plotTop=Math.round(chart.plotTop);chart.plotWidth=plotWidth=Math.max(0,Math.round(chartWidth-plotLeft-chart.marginRight));chart.plotHeight=plotHeight=Math.max(0,Math.round(chartHeight-plotTop-chart.marginBottom));chart.plotSizeX=inverted?plotHeight:plotWidth;chart.plotSizeY=inverted?plotWidth:plotHeight;chart.spacingBox=renderer.spacingBox={x:spacing[3],y:spacing[0],width:chartWidth-spacing[3]-spacing[1],height:chartHeight-spacing[0]-spacing[2]};chart.plotBox=renderer.plotBox={x:plotLeft,y:plotTop,width:plotWidth,height:plotHeight};if(clipOffset){chart.clipBox={x:clipRoundFunc(clipOffset[3]),y:clipRoundFunc(clipOffset[0]),width:clipRoundFunc(chart.plotSizeX-clipOffset[1]-clipOffset[3]),height:clipRoundFunc(chart.plotSizeY-clipOffset[0]-clipOffset[2])}}if(!skipAxes){chart.axes.forEach(function(axis){axis.setAxisSize();axis.setAxisTranslation()});renderer.alignElements()}fireEvent(chart,"afterSetChartSize",{skipAxes:skipAxes})}resetMargins(){fireEvent(this,"resetMargins");const chart=this,chartOptions=chart.options.chart,plotBorderWidth=chartOptions.plotBorderWidth||0,halfWidth=plotBorderWidth/2;["margin","spacing"].forEach(function splashArrays(target){const value=chartOptions[target],values=isObject(value)?value:[value,value,value,value];["Top","Right","Bottom","Left"].forEach(function(sideName,side){chart[target][side]=pick(chartOptions[target+sideName],values[side])})});marginNames.forEach(function(m,side){chart[m]=pick(chart.margin[side],chart.spacing[side])});chart.axisOffset=[0,0,0,0];chart.clipOffset=[halfWidth,halfWidth,halfWidth,halfWidth];chart.plotBorderWidth=plotBorderWidth}drawChartBox(){const chart=this,optionsChart=chart.options.chart,renderer=chart.renderer,chartWidth=chart.chartWidth,chartHeight=chart.chartHeight,styledMode=chart.styledMode,plotBGImage=chart.plotBGImage,chartBackgroundColor=optionsChart.backgroundColor,plotBackgroundColor=optionsChart.plotBackgroundColor,plotBackgroundImage=optionsChart.plotBackgroundImage,plotLeft=chart.plotLeft,plotTop=chart.plotTop,plotWidth=chart.plotWidth,plotHeight=chart.plotHeight,plotBox=chart.plotBox,clipRect=chart.clipRect,clipBox=chart.clipBox;let chartBackground=chart.chartBackground,plotBackground=chart.plotBackground,plotBorder=chart.plotBorder,chartBorderWidth,mgn,bgAttr,verb="animate";if(!chartBackground){chart.chartBackground=chartBackground=renderer.rect().addClass("highcharts-background").add();verb="attr"}if(!styledMode){chartBorderWidth=optionsChart.borderWidth||0;mgn=chartBorderWidth+(optionsChart.shadow?8:0);bgAttr={fill:chartBackgroundColor||"none"};if(chartBorderWidth||chartBackground["stroke-width"]){bgAttr.stroke=optionsChart.borderColor;bgAttr["stroke-width"]=chartBorderWidth}chartBackground.attr(bgAttr).shadow(optionsChart.shadow)}else{chartBorderWidth=mgn=chartBackground.strokeWidth()}chartBackground[verb]({x:mgn/2,y:mgn/2,width:chartWidth-mgn-chartBorderWidth%2,height:chartHeight-mgn-chartBorderWidth%2,r:optionsChart.borderRadius});verb="animate";if(!plotBackground){verb="attr";chart.plotBackground=plotBackground=renderer.rect().addClass("highcharts-plot-background").add()}plotBackground[verb](plotBox);if(!styledMode){plotBackground.attr({fill:plotBackgroundColor||"none"}).shadow(optionsChart.plotShadow);if(plotBackgroundImage){if(!plotBGImage){chart.plotBGImage=renderer.image(plotBackgroundImage,plotLeft,plotTop,plotWidth,plotHeight).add()}else{if(plotBackgroundImage!==plotBGImage.attr("href")){plotBGImage.attr("href",plotBackgroundImage)}plotBGImage.animate(plotBox)}}}if(!clipRect){chart.clipRect=renderer.clipRect(clipBox)}else{clipRect.animate({width:clipBox.width,height:clipBox.height})}verb="animate";if(!plotBorder){verb="attr";chart.plotBorder=plotBorder=renderer.rect().addClass("highcharts-plot-border").attr({zIndex:1}).add()}if(!styledMode){plotBorder.attr({stroke:optionsChart.plotBorderColor,"stroke-width":optionsChart.plotBorderWidth||0,fill:"none"})}plotBorder[verb](plotBorder.crisp({x:plotLeft,y:plotTop,width:plotWidth,height:plotHeight},-plotBorder.strokeWidth()));chart.isDirtyBox=false;fireEvent(this,"afterDrawChartBox")}propFromSeries(){const chart=this,optionsChart=chart.options.chart,seriesOptions=chart.options.series;let i,klass,value;["inverted","angular","polar"].forEach(function(key){klass=seriesTypes[optionsChart.type];value=optionsChart[key]||klass&&klass.prototype[key];i=seriesOptions&&seriesOptions.length;while(!value&&i--){klass=seriesTypes[seriesOptions[i].type];if(klass&&klass.prototype[key]){value=true}}chart[key]=value})}linkSeries(isUpdating){const chart=this,chartSeries=chart.series;chartSeries.forEach(function(series){series.linkedSeries.length=0});chartSeries.forEach(function(series){const{linkedTo}=series.options;if(isString(linkedTo)){let linkedParent;if(linkedTo===":previous"){linkedParent=chart.series[series.index-1]}else{linkedParent=chart.get(linkedTo)}if(linkedParent&&linkedParent.linkedParent!==series){linkedParent.linkedSeries.push(series);series.linkedParent=linkedParent;if(linkedParent.enabledDataSorting){series.setDataSortingOptions()}series.visible=pick(series.options.visible,linkedParent.options.visible,series.visible)}}});fireEvent(this,"afterLinkSeries",{isUpdating:isUpdating})}renderSeries(){this.series.forEach(function(serie){serie.translate();serie.render()})}render(){const chart=this,axes=chart.axes,colorAxis=chart.colorAxis,renderer=chart.renderer,axisLayoutRuns=chart.options.chart.axisLayoutRuns||2,renderAxes=axes=>{axes.forEach(axis=>{if(axis.visible){axis.render()}})};let expectedSpace=0,redoHorizontal=true,redoVertical,run=0;chart.setTitle();fireEvent(chart,"beforeMargins");chart.getStacks?.();chart.getMargins(true);chart.setChartSize();for(const axis of axes){const{options}=axis,{labels}=options;if(chart.hasCartesianSeries&&axis.horiz&&axis.visible&&labels.enabled&&axis.series.length&&axis.coll!=="colorAxis"&&!chart.polar){expectedSpace=options.tickLength;axis.createGroups();const mockTick=new Tick(axis,0,"",true),label=mockTick.createLabel("x",labels);mockTick.destroy();if(label&&pick(labels.reserveSpace,!isNumber(options.crossing))){expectedSpace=label.getBBox().height+labels.distance+Math.max(options.offset||0,0)}if(expectedSpace){label?.destroy();break}}}chart.plotHeight=Math.max(chart.plotHeight-expectedSpace,0);while((redoHorizontal||redoVertical||axisLayoutRuns>1)&&run<axisLayoutRuns){const tempWidth=chart.plotWidth,tempHeight=chart.plotHeight;for(const axis of axes){if(run===0){axis.setScale()}else if(axis.horiz&&redoHorizontal||!axis.horiz&&redoVertical){axis.setTickInterval(true)}}if(run===0){chart.getAxisMargins()}else{chart.getMargins()}redoHorizontal=tempWidth/chart.plotWidth>(run?1:1.1);redoVertical=tempHeight/chart.plotHeight>(run?1:1.05);run++}chart.drawChartBox();if(chart.hasCartesianSeries){renderAxes(axes)}else if(colorAxis&&colorAxis.length){renderAxes(colorAxis)}if(!chart.seriesGroup){chart.seriesGroup=renderer.g("series-group").attr({zIndex:3}).shadow(chart.options.chart.seriesGroupShadow).add()}chart.renderSeries();chart.addCredits();if(chart.setResponsive){chart.setResponsive()}chart.hasRendered=true}addCredits(credits){const chart=this,creds=merge(true,this.options.credits,credits);if(creds.enabled&&!this.credits){this.credits=this.renderer.text(creds.text+(this.mapCredits||""),0,0).addClass("highcharts-credits").on("click",function(){if(creds.href){win.location.href=creds.href}}).attr({align:creds.position.align,zIndex:8});if(!chart.styledMode){this.credits.css(creds.style)}this.credits.add().align(creds.position);this.credits.update=function(options){chart.credits=chart.credits.destroy();chart.addCredits(options)}}}destroy(){const chart=this,axes=chart.axes,series=chart.series,container=chart.container,parentNode=container&&container.parentNode;let i;fireEvent(chart,"destroy");if(chart.renderer.forExport){erase(charts,chart)}else{charts[chart.index]=void 0}H.chartCount--;chart.renderTo.removeAttribute("data-highcharts-chart");removeEvent(chart);i=axes.length;while(i--){axes[i]=axes[i].destroy()}if(this.scroller&&this.scroller.destroy){this.scroller.destroy()}i=series.length;while(i--){series[i]=series[i].destroy()}["title","subtitle","chartBackground","plotBackground","plotBGImage","plotBorder","seriesGroup","clipRect","credits","pointer","rangeSelector","legend","resetZoomButton","tooltip","renderer"].forEach(function(name){const prop=chart[name];if(prop&&prop.destroy){chart[name]=prop.destroy()}});if(container){container.innerHTML=AST.emptyHTML;removeEvent(container);if(parentNode){discardElement(container)}}objectEach(chart,function(val,key){delete chart[key]})}firstRender(){const chart=this,options=chart.options;chart.getContainer();chart.resetMargins();chart.setChartSize();chart.propFromSeries();chart.createAxes();const series=isArray(options.series)?options.series:[];options.series=[];series.forEach(function(serieOptions){chart.initSeries(serieOptions)});chart.linkSeries();chart.setSortedData();fireEvent(chart,"beforeRender");chart.render();chart.pointer?.getChartPosition();if(!chart.renderer.imgCount&&!chart.hasLoaded){chart.onload()}chart.temporaryDisplay(true)}onload(){this.callbacks.concat([this.callback]).forEach(function(fn){if(fn&&typeof this.index!=="undefined"){fn.apply(this,[this])}},this);fireEvent(this,"load");fireEvent(this,"render");if(defined(this.index)){this.setReflow()}this.warnIfA11yModuleNotLoaded();this.hasLoaded=true}warnIfA11yModuleNotLoaded(){const{options,title}=this;if(options&&!this.accessibility){this.renderer.boxWrapper.attr({role:"img","aria-label":(title&&title.element.textContent||"").replace(/</g,"&lt;")});if(!(options.accessibility&&options.accessibility.enabled===false)){error("Highcharts warning: Consider including the "+'"accessibility.js" module to make your chart more '+"usable for people with disabilities. Set the "+'"accessibility.enabled" option to false to remove this '+"warning. See https://www.highcharts.com/docs/accessibility/accessibility-module.",false,this)}}}addSeries(options,redraw,animation){const chart=this;let series;if(options){redraw=pick(redraw,true);fireEvent(chart,"addSeries",{options:options},function(){series=chart.initSeries(options);chart.isDirtyLegend=true;chart.linkSeries();if(series.enabledDataSorting){series.setData(options.data,false)}fireEvent(chart,"afterAddSeries",{series:series});if(redraw){chart.redraw(animation)}})}return series}addAxis(options,isX,redraw,animation){return this.createAxis(isX?"xAxis":"yAxis",{axis:options,redraw:redraw,animation:animation})}addColorAxis(options,redraw,animation){return this.createAxis("colorAxis",{axis:options,redraw:redraw,animation:animation})}createAxis(coll,options){const axis=new Axis(this,options.axis,coll);if(pick(options.redraw,true)){this.redraw(options.animation)}return axis}showLoading(str){const chart=this,options=chart.options,loadingOptions=options.loading,setLoadingSize=function(){if(loadingDiv){css(loadingDiv,{left:chart.plotLeft+"px",top:chart.plotTop+"px",width:chart.plotWidth+"px",height:chart.plotHeight+"px"})}};let loadingDiv=chart.loadingDiv,loadingSpan=chart.loadingSpan;if(!loadingDiv){chart.loadingDiv=loadingDiv=createElement("div",{className:"highcharts-loading highcharts-loading-hidden"},null,chart.container)}if(!loadingSpan){chart.loadingSpan=loadingSpan=createElement("span",{className:"highcharts-loading-inner"},null,loadingDiv);addEvent(chart,"redraw",setLoadingSize)}loadingDiv.className="highcharts-loading";AST.setElementHTML(loadingSpan,pick(str,options.lang.loading,""));if(!chart.styledMode){css(loadingDiv,extend(loadingOptions.style,{zIndex:10}));css(loadingSpan,loadingOptions.labelStyle);if(!chart.loadingShown){css(loadingDiv,{opacity:0,display:""});animate(loadingDiv,{opacity:loadingOptions.style.opacity||.5},{duration:loadingOptions.showDuration||0})}}chart.loadingShown=true;setLoadingSize()}hideLoading(){const options=this.options,loadingDiv=this.loadingDiv;if(loadingDiv){loadingDiv.className="highcharts-loading highcharts-loading-hidden";if(!this.styledMode){animate(loadingDiv,{opacity:0},{duration:options.loading.hideDuration||100,complete:function(){css(loadingDiv,{display:"none"})}})}}this.loadingShown=false}update(options,redraw,oneToOne,animation){const chart=this,adders={credits:"addCredits",title:"setTitle",subtitle:"setSubtitle",caption:"setCaption"},isResponsiveOptions=options.isResponsiveOptions,itemsForRemoval=[];let updateAllAxes,updateAllSeries,runSetSize;fireEvent(chart,"update",{options:options});if(!isResponsiveOptions){chart.setResponsive(false,true)}options=diffObjects(options,chart.options);chart.userOptions=merge(chart.userOptions,options);const optionsChart=options.chart;if(optionsChart){merge(true,chart.options.chart,optionsChart);this.setZoomOptions();if("className"in optionsChart){chart.setClassName(optionsChart.className)}if("inverted"in optionsChart||"polar"in optionsChart||"type"in optionsChart){chart.propFromSeries();updateAllAxes=true}if("alignTicks"in optionsChart){updateAllAxes=true}if("events"in optionsChart){registerEventOptions(this,optionsChart)}objectEach(optionsChart,function(val,key){if(chart.propsRequireUpdateSeries.indexOf("chart."+key)!==-1){updateAllSeries=true}if(chart.propsRequireDirtyBox.indexOf(key)!==-1){chart.isDirtyBox=true}if(chart.propsRequireReflow.indexOf(key)!==-1){chart.isDirtyBox=true;if(!isResponsiveOptions){runSetSize=true}}});if(!chart.styledMode&&optionsChart.style){chart.renderer.setStyle(chart.options.chart.style||{})}}if(!chart.styledMode&&options.colors){this.options.colors=options.colors}objectEach(options,function(val,key){if(chart[key]&&typeof chart[key].update==="function"){chart[key].update(val,false)}else if(typeof chart[adders[key]]==="function"){chart[adders[key]](val)}else if(key!=="colors"&&chart.collectionsWithUpdate.indexOf(key)===-1){merge(true,chart.options[key],options[key])}if(key!=="chart"&&chart.propsRequireUpdateSeries.indexOf(key)!==-1){updateAllSeries=true}});this.collectionsWithUpdate.forEach(function(coll){if(options[coll]){splat(options[coll]).forEach(function(newOptions,i){const hasId=defined(newOptions.id);let item;if(hasId){item=chart.get(newOptions.id)}if(!item&&chart[coll]){item=chart[coll][pick(newOptions.index,i)];if(item&&(hasId&&defined(item.options.id)||item.options.isInternal)){item=void 0}}if(item&&item.coll===coll){item.update(newOptions,false);if(oneToOne){item.touched=true}}if(!item&&oneToOne&&chart.collectionsWithInit[coll]){chart.collectionsWithInit[coll][0].apply(chart,[newOptions].concat(chart.collectionsWithInit[coll][1]||[]).concat([false])).touched=true}});if(oneToOne){chart[coll].forEach(function(item){if(!item.touched&&!item.options.isInternal){itemsForRemoval.push(item)}else{delete item.touched}})}}});itemsForRemoval.forEach(function(item){if(item.chart&&item.remove){item.remove(false)}});if(updateAllAxes){chart.axes.forEach(function(axis){axis.update({},false)})}if(updateAllSeries){chart.getSeriesOrderByLinks().forEach(function(series){if(series.chart){series.update({},false)}},this)}const newWidth=optionsChart&&optionsChart.width;const newHeight=optionsChart&&(isString(optionsChart.height)?relativeLength(optionsChart.height,newWidth||chart.chartWidth):optionsChart.height);if(runSetSize||isNumber(newWidth)&&newWidth!==chart.chartWidth||isNumber(newHeight)&&newHeight!==chart.chartHeight){chart.setSize(newWidth,newHeight,animation)}else if(pick(redraw,true)){chart.redraw(animation)}fireEvent(chart,"afterUpdate",{options:options,redraw:redraw,animation:animation})}setSubtitle(options,redraw){this.applyDescription("subtitle",options);this.layOutTitles(redraw)}setCaption(options,redraw){this.applyDescription("caption",options);this.layOutTitles(redraw)}showResetZoom(){const chart=this,lang=defaultOptions.lang,btnOptions=chart.zooming.resetButton,theme=btnOptions.theme,alignTo=btnOptions.relativeTo==="chart"||btnOptions.relativeTo==="spacingBox"?null:"plotBox";function zoomOut(){chart.zoomOut()}fireEvent(this,"beforeShowResetZoom",null,function(){chart.resetZoomButton=chart.renderer.button(lang.resetZoom,null,null,zoomOut,theme).attr({align:btnOptions.position.align,title:lang.resetZoomTitle}).addClass("highcharts-reset-zoom").add().align(btnOptions.position,false,alignTo)});fireEvent(this,"afterShowResetZoom")}zoomOut(){fireEvent(this,"selection",{resetSelection:true},()=>this.transform({reset:true,trigger:"zoom"}))}pan(event,panning){const chart=this,panningOptions=typeof panning==="object"?panning:{enabled:panning,type:"x"},type=panningOptions.type,axes=type&&chart[{x:"xAxis",xy:"axes",y:"yAxis"}[type]].filter(axis=>axis.options.panningEnabled&&!axis.options.isInternal),chartOptions=chart.options.chart;if(chartOptions?.panning){chartOptions.panning=panningOptions}fireEvent(this,"pan",{originalEvent:event},()=>{chart.transform({axes:axes,event:event,to:{x:event.chartX-(chart.mouseDownX||0),y:event.chartY-(chart.mouseDownY||0)},trigger:"pan"});css(chart.container,{cursor:"move"})})}transform(params){const{axes=this.axes,event,from={},reset,selection,to={},trigger}=params,{inverted,time}=this;let hasZoomed=false,displayButton,isAnyAxisPanning;this.hoverPoints?.forEach(point=>point.setState());for(const axis of axes){const{horiz,len,minPointOffset=0,options,reversed}=axis,wh=horiz?"width":"height",xy=horiz?"x":"y",toLength=pick(to[wh],axis.len),fromLength=pick(from[wh],axis.len),scale=Math.abs(toLength)<10?1:toLength/fromLength,fromCenter=(from[xy]||0)+fromLength/2-axis.pos,toCenter=(to[xy]??axis.pos)+toLength/2-axis.pos,move=fromCenter-toCenter/scale,pointRangeDirection=reversed&&!inverted||!reversed&&inverted?-1:1,minPx=move;if(!reset&&(fromCenter<0||fromCenter>axis.len)){continue}let newMin=axis.toValue(minPx,true)+(selection||axis.isOrdinal?0:minPointOffset*pointRangeDirection),newMax=axis.toValue(minPx+len/scale,true)-(selection||axis.isOrdinal?0:minPointOffset*pointRangeDirection||0),allExtremes=axis.allExtremes;if(newMin>newMax){[newMin,newMax]=[newMax,newMin]}if(scale===1&&!reset&&axis.coll==="yAxis"&&!allExtremes){for(const series of axis.series){const seriesExtremes=series.getExtremes(series.getProcessedData(true).modified.getColumn("y")||[],true);allExtremes??(allExtremes={dataMin:Number.MAX_VALUE,dataMax:-Number.MAX_VALUE});if(isNumber(seriesExtremes.dataMin)&&isNumber(seriesExtremes.dataMax)){allExtremes.dataMin=Math.min(seriesExtremes.dataMin,allExtremes.dataMin);allExtremes.dataMax=Math.max(seriesExtremes.dataMax,allExtremes.dataMax)}}axis.allExtremes=allExtremes}const{dataMin,dataMax,min,max}=extend(axis.getExtremes(),allExtremes||{}),optionsMin=time.parse(options.min),optionsMax=time.parse(options.max),safeDataMin=dataMin??optionsMin,safeDataMax=dataMax??optionsMax,range=newMax-newMin,padRange=axis.categories?0:Math.min(range,safeDataMax-safeDataMin),paddedMin=safeDataMin-padRange*(defined(optionsMin)?0:options.minPadding),paddedMax=safeDataMax+padRange*(defined(optionsMax)?0:options.maxPadding),allowZoomOutside=axis.allowZoomOutside||scale===1||trigger!=="zoom"&&scale>1,floor=Math.min(optionsMin??paddedMin,paddedMin,allowZoomOutside?min:paddedMin),ceiling=Math.max(optionsMax??paddedMax,paddedMax,allowZoomOutside?max:paddedMax);if(!axis.isOrdinal||axis.options.overscroll||scale!==1||reset){if(newMin<floor){newMin=floor;if(scale>=1){newMax=newMin+range}}if(newMax>ceiling){newMax=ceiling;if(scale>=1){newMin=newMax-range}}if(reset||axis.series.length&&(newMin!==min||newMax!==max)&&newMin>=floor&&newMax<=ceiling){if(selection){selection[axis.coll].push({axis:axis,min:newMin,max:newMax})}else{axis.isPanning=trigger!=="zoom";if(axis.isPanning){isAnyAxisPanning=true}axis.setExtremes(reset?void 0:newMin,reset?void 0:newMax,false,false,{move:move,trigger:trigger,scale:scale});if(!reset&&(newMin>floor||newMax<ceiling)&&trigger!=="mousewheel"){displayButton=true}}hasZoomed=true}if(event){this[horiz?"mouseDownX":"mouseDownY"]=event[horiz?"chartX":"chartY"]}}}if(hasZoomed){if(selection){fireEvent(this,"selection",selection,()=>{delete params.selection;params.trigger="zoom";this.transform(params)})}else{if(displayButton&&!isAnyAxisPanning&&!this.resetZoomButton){this.showResetZoom()}else if(!displayButton&&this.resetZoomButton){this.resetZoomButton=this.resetZoomButton.destroy()}this.redraw(trigger==="zoom"&&(this.options.chart.animation??this.pointCount<100))}}return hasZoomed}}extend(Chart.prototype,{callbacks:[],collectionsWithInit:{xAxis:[Chart.prototype.addAxis,[true]],yAxis:[Chart.prototype.addAxis,[false]],series:[Chart.prototype.addSeries]},collectionsWithUpdate:["xAxis","yAxis","series"],propsRequireDirtyBox:["backgroundColor","borderColor","borderWidth","borderRadius","plotBackgroundColor","plotBackgroundImage","plotBorderColor","plotBorderWidth","plotShadow","shadow"],propsRequireReflow:["margin","marginTop","marginRight","marginBottom","marginLeft","spacing","spacingTop","spacingRight","spacingBottom","spacingLeft"],propsRequireUpdateSeries:["chart.inverted","chart.polar","chart.ignoreHiddenSeries","chart.type","colors","plotOptions","time","tooltip"]});export default Chart;"";