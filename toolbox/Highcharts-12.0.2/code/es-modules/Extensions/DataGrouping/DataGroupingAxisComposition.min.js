"use strict";import DataGroupingDefaults from"./DataGroupingDefaults.js";import U from"../../Core/Utilities.js";const{addEvent,extend,merge,pick}=U;let AxisConstructor;function applyGrouping(e){const axis=this,series=axis.series;series.forEach(function(series){series.groupPixelWidth=void 0});series.forEach(function(series){series.groupPixelWidth=axis.getGroupPixelWidth&&axis.getGroupPixelWidth();if(series.groupPixelWidth){series.hasProcessed=true}series.applyGrouping(!!e.hasExtremesChanged)})}function compose(AxisClass){AxisConstructor=AxisClass;const axisProto=AxisClass.prototype;if(!axisProto.applyGrouping){addEvent(AxisClass,"afterSetScale",onAfterSetScale);addEvent(AxisClass,"postProcessData",applyGrouping);extend(axisProto,{applyGrouping:applyGrouping,getGroupPixelWidth:getGroupPixelWidth,setDataGrouping:setDataGrouping})}}function getGroupPixelWidth(){const series=this.series;let i=series.length,groupPixelWidth=0,doGrouping=false,dataLength,dgOptions;while(i--){dgOptions=series[i].options.dataGrouping;if(dgOptions){groupPixelWidth=Math.max(groupPixelWidth,pick(dgOptions.groupPixelWidth,DataGroupingDefaults.common.groupPixelWidth));dataLength=(series[i].dataTable.modified||series[i].dataTable).rowCount;if(series[i].groupPixelWidth||dataLength>this.chart.plotSizeX/groupPixelWidth||dataLength&&dgOptions.forced){doGrouping=true}}}return doGrouping?groupPixelWidth:0}function onAfterSetScale(){this.series.forEach(function(series){series.hasProcessed=false})}function setDataGrouping(dataGrouping,redraw){const axis=this;let i;redraw=pick(redraw,true);if(!dataGrouping){dataGrouping={forced:false,units:null}}if(this instanceof AxisConstructor){i=this.series.length;while(i--){this.series[i].update({dataGrouping:dataGrouping},false)}}else{this.chart.options.series.forEach(function(seriesOptions){seriesOptions.dataGrouping=typeof dataGrouping==="boolean"?dataGrouping:merge(dataGrouping,seriesOptions.dataGrouping)})}if(axis.ordinal){axis.ordinal.slope=void 0}if(redraw){this.chart.redraw()}}const DataGroupingAxisComposition={compose:compose};export default DataGroupingAxisComposition;