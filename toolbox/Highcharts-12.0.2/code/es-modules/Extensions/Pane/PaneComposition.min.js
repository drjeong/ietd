import U from"../../Core/Utilities.js";const{addEvent,correctFloat,defined,pick}=U;function chartGetHoverPane(eventArgs){const chart=this;let hoverPane;if(eventArgs){chart.pane.forEach(pane=>{const x=eventArgs.chartX-chart.plotLeft,y=eventArgs.chartY-chart.plotTop;if(isInsidePane(x,y,pane.center)){hoverPane=pane}})}return hoverPane}function compose(ChartClass,PointerClass){const chartProto=ChartClass.prototype;if(!chartProto.getHoverPane){chartProto.collectionsWithUpdate.push("pane");chartProto.getHoverPane=chartGetHoverPane;addEvent(ChartClass,"afterIsInsidePlot",onChartAfterIsInsiderPlot);addEvent(PointerClass,"afterGetHoverData",onPointerAfterGetHoverData);addEvent(PointerClass,"beforeGetHoverData",onPointerBeforeGetHoverData)}}function isInsidePane(x,y,center,startAngle,endAngle){let insideSlice=true;const cx=center[0],cy=center[1];const distance=Math.sqrt(Math.pow(x-cx,2)+Math.pow(y-cy,2));if(defined(startAngle)&&defined(endAngle)){const angle=Math.atan2(correctFloat(y-cy,8),correctFloat(x-cx,8));if(endAngle!==startAngle){if(startAngle>endAngle){insideSlice=angle>=startAngle&&angle<=Math.PI||angle<=endAngle&&angle>=-Math.PI}else{insideSlice=angle>=startAngle&&angle<=correctFloat(endAngle,8)}}}return distance<=Math.ceil(center[2]/2)&&insideSlice}function onChartAfterIsInsiderPlot(e){const chart=this;if(chart.polar){if(e.options.inverted){[e.x,e.y]=[e.y,e.x]}e.isInsidePlot=chart.pane.some(pane=>isInsidePane(e.x,e.y,pane.center,pane.axis&&pane.axis.normalizedStartAngleRad,pane.axis&&pane.axis.normalizedEndAngleRad))}}function onPointerAfterGetHoverData(eventArgs){const chart=this.chart;if(eventArgs.hoverPoint&&eventArgs.hoverPoint.plotX&&eventArgs.hoverPoint.plotY&&chart.hoverPane&&!isInsidePane(eventArgs.hoverPoint.plotX,eventArgs.hoverPoint.plotY,chart.hoverPane.center)){eventArgs.hoverPoint=void 0}}function onPointerBeforeGetHoverData(eventArgs){const chart=this.chart;if(chart.polar){chart.hoverPane=chart.getHoverPane(eventArgs);eventArgs.filter=function(s){return s.visible&&!(!eventArgs.shared&&s.directTouch)&&pick(s.options.enableMouseTracking,true)&&(!chart.hoverPane||s.xAxis.pane===chart.hoverPane)}}else{chart.hoverPane=void 0}}const PaneComposition={compose:compose};export default PaneComposition;