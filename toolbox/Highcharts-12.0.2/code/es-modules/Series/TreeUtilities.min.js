"use strict";import Color from"../Core/Color/Color.js";import U from"../Core/Utilities.js";const{extend,isArray,isNumber,isObject,merge,pick,relativeLength}=U;function getColor(node,options){const index=options.index,mapOptionsToLevel=options.mapOptionsToLevel,parentColor=options.parentColor,parentColorIndex=options.parentColorIndex,series=options.series,colors=options.colors,siblings=options.siblings,points=series.points,chartOptionsChart=series.chart.options.chart;let getColorByPoint,point,level,colorByPoint,colorIndexByPoint,color,colorIndex;const variateColor=color=>{const colorVariation=level&&level.colorVariation;if(colorVariation&&colorVariation.key==="brightness"&&index&&siblings){return Color.parse(color).brighten(colorVariation.to*(index/siblings)).get()}return color};if(node){point=points[node.i];level=mapOptionsToLevel[node.level]||{};getColorByPoint=point&&level.colorByPoint;if(getColorByPoint){colorIndexByPoint=point.index%(colors?colors.length:chartOptionsChart.colorCount);colorByPoint=colors&&colors[colorIndexByPoint]}if(!series.chart.styledMode){color=pick(point&&point.options.color,level&&level.color,colorByPoint,parentColor&&variateColor(parentColor),series.color)}colorIndex=pick(point&&point.options.colorIndex,level&&level.colorIndex,colorIndexByPoint,parentColorIndex,options.colorIndex)}return{color:color,colorIndex:colorIndex}}function getLevelOptions(params){const result={};let defaults,converted,i,from,to,levels;if(isObject(params)){from=isNumber(params.from)?params.from:1;levels=params.levels;converted={};defaults=isObject(params.defaults)?params.defaults:{};if(isArray(levels)){converted=levels.reduce((obj,item)=>{let level,levelIsConstant,options;if(isObject(item)&&isNumber(item.level)){options=merge({},item);levelIsConstant=pick(options.levelIsConstant,defaults.levelIsConstant);delete options.levelIsConstant;delete options.level;level=item.level+(levelIsConstant?0:from-1);if(isObject(obj[level])){merge(true,obj[level],options)}else{obj[level]=options}}return obj},{})}to=isNumber(params.to)?params.to:1;for(i=0;i<=to;i++){result[i]=merge({},defaults,isObject(converted[i])?converted[i]:{})}}return result}function setTreeValues(tree,options){const before=options.before,idRoot=options.idRoot,mapIdToNode=options.mapIdToNode,nodeRoot=mapIdToNode[idRoot],levelIsConstant=options.levelIsConstant!==false,points=options.points,point=points[tree.i],optionsPoint=point&&point.options||{},children=[];let childrenTotal=0;tree.levelDynamic=tree.level-(levelIsConstant?0:nodeRoot.level);tree.name=pick(point&&point.name,"");tree.visible=idRoot===tree.id||options.visible===true;if(typeof before==="function"){tree=before(tree,options)}tree.children.forEach((child,i)=>{const newOptions=extend({},options);extend(newOptions,{index:i,siblings:tree.children.length,visible:tree.visible});child=setTreeValues(child,newOptions);children.push(child);if(child.visible){childrenTotal+=child.val}});const value=pick(optionsPoint.value,childrenTotal);tree.visible=value>=0&&(childrenTotal>0||tree.visible);tree.children=children;tree.childrenTotal=childrenTotal;tree.isLeaf=tree.visible&&!childrenTotal;tree.val=value;return tree}function updateRootId(series){let rootId,options;if(isObject(series)){options=isObject(series.options)?series.options:{};rootId=pick(series.rootNode,options.rootId,"");if(isObject(series.userOptions)){series.userOptions.rootId=rootId}series.rootNode=rootId}return rootId}function getNodeWidth(series,columnCount){const{chart,options}=series,{nodeDistance=0,nodeWidth=0}=options,{plotSizeX=1}=chart;if(nodeWidth==="auto"){if(typeof nodeDistance==="string"&&/%$/.test(nodeDistance)){const fraction=parseFloat(nodeDistance)/100,total=columnCount+fraction*(columnCount-1);return plotSizeX/total}const nDistance=Number(nodeDistance);return(plotSizeX+nDistance)/(columnCount||1)-nDistance}return relativeLength(nodeWidth,plotSizeX)}const TreeUtilities={getColor:getColor,getLevelOptions:getLevelOptions,getNodeWidth:getNodeWidth,setTreeValues:setTreeValues,updateRootId:updateRootId};export default TreeUtilities;