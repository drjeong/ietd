"use strict";import H from"../../Core/Globals.js";import STU from"./StockToolsUtilities.js";var addFlagFromForm=STU.addFlagFromForm,attractToPoint=STU.attractToPoint,isNotNavigatorYAxis=STU.isNotNavigatorYAxis,isPriceIndicatorEnabled=STU.isPriceIndicatorEnabled,manageIndicators=STU.manageIndicators,updateHeight=STU.updateHeight,updateNthPoint=STU.updateNthPoint,updateRectSize=STU.updateRectSize;import U from"../../Core/Utilities.js";var fireEvent=U.fireEvent,merge=U.merge;var StockToolsBindings={segment:{className:"highcharts-segment",start:function(e){var _a=this.getCoords(e),coordsX=_a[0],coordsY=_a[1];if(!coordsX||!coordsY){return}var navigation=this.chart.options.navigation,options=merge({langKey:"segment",type:"crookedLine",typeOptions:{xAxis:coordsX.axis.index,yAxis:coordsY.axis.index,points:[{x:coordsX.value,y:coordsY.value},{x:coordsX.value,y:coordsY.value}]}},navigation.annotationsOptions,navigation.bindings.segment.annotationsOptions);return this.chart.addAnnotation(options)},steps:[updateNthPoint(1)]},arrowSegment:{className:"highcharts-arrow-segment",start:function(e){var _a=this.getCoords(e),coordsX=_a[0],coordsY=_a[1];if(!coordsX||!coordsY){return}var navigation=this.chart.options.navigation,options=merge({langKey:"arrowSegment",type:"crookedLine",typeOptions:{line:{markerEnd:"arrow"},xAxis:coordsX.axis.index,yAxis:coordsY.axis.index,points:[{x:coordsX.value,y:coordsY.value},{x:coordsX.value,y:coordsY.value}]}},navigation.annotationsOptions,navigation.bindings.arrowSegment.annotationsOptions);return this.chart.addAnnotation(options)},steps:[updateNthPoint(1)]},ray:{className:"highcharts-ray",start:function(e){var _a=this.getCoords(e),coordsX=_a[0],coordsY=_a[1];if(!coordsX||!coordsY){return}var navigation=this.chart.options.navigation,options=merge({langKey:"ray",type:"infinityLine",typeOptions:{type:"ray",xAxis:coordsX.axis.index,yAxis:coordsY.axis.index,points:[{x:coordsX.value,y:coordsY.value},{x:coordsX.value,y:coordsY.value}]}},navigation.annotationsOptions,navigation.bindings.ray.annotationsOptions);return this.chart.addAnnotation(options)},steps:[updateNthPoint(1)]},arrowRay:{className:"highcharts-arrow-ray",start:function(e){var _a=this.getCoords(e),coordsX=_a[0],coordsY=_a[1];if(!coordsX||!coordsY){return}var navigation=this.chart.options.navigation,options=merge({langKey:"arrowRay",type:"infinityLine",typeOptions:{type:"ray",line:{markerEnd:"arrow"},xAxis:coordsX.axis.index,yAxis:coordsY.axis.index,points:[{x:coordsX.value,y:coordsY.value},{x:coordsX.value,y:coordsY.value}]}},navigation.annotationsOptions,navigation.bindings.arrowRay.annotationsOptions);return this.chart.addAnnotation(options)},steps:[updateNthPoint(1)]},infinityLine:{className:"highcharts-infinity-line",start:function(e){var _a=this.getCoords(e),coordsX=_a[0],coordsY=_a[1];if(!coordsX||!coordsY){return}var navigation=this.chart.options.navigation,options=merge({langKey:"infinityLine",type:"infinityLine",typeOptions:{type:"line",xAxis:coordsX.axis.index,yAxis:coordsY.axis.index,points:[{x:coordsX.value,y:coordsY.value},{x:coordsX.value,y:coordsY.value}]}},navigation.annotationsOptions,navigation.bindings.infinityLine.annotationsOptions);return this.chart.addAnnotation(options)},steps:[updateNthPoint(1)]},arrowInfinityLine:{className:"highcharts-arrow-infinity-line",start:function(e){var _a=this.getCoords(e),coordsX=_a[0],coordsY=_a[1];if(!coordsX||!coordsY){return}var navigation=this.chart.options.navigation,options=merge({langKey:"arrowInfinityLine",type:"infinityLine",typeOptions:{type:"line",line:{markerEnd:"arrow"},xAxis:coordsX.axis.index,yAxis:coordsY.axis.index,points:[{x:coordsX.value,y:coordsY.value},{x:coordsX.value,y:coordsY.value}]}},navigation.annotationsOptions,navigation.bindings.arrowInfinityLine.annotationsOptions);return this.chart.addAnnotation(options)},steps:[updateNthPoint(1)]},horizontalLine:{className:"highcharts-horizontal-line",start:function(e){var _a=this.getCoords(e),coordsX=_a[0],coordsY=_a[1];if(!coordsX||!coordsY){return}var navigation=this.chart.options.navigation,options=merge({langKey:"horizontalLine",type:"infinityLine",draggable:"y",typeOptions:{type:"horizontalLine",xAxis:coordsX.axis.index,yAxis:coordsY.axis.index,points:[{x:coordsX.value,y:coordsY.value}]}},navigation.annotationsOptions,navigation.bindings.horizontalLine.annotationsOptions);this.chart.addAnnotation(options)}},verticalLine:{className:"highcharts-vertical-line",start:function(e){var _a=this.getCoords(e),coordsX=_a[0],coordsY=_a[1];if(!coordsX||!coordsY){return}var navigation=this.chart.options.navigation,options=merge({langKey:"verticalLine",type:"infinityLine",draggable:"x",typeOptions:{type:"verticalLine",xAxis:coordsX.axis.index,yAxis:coordsY.axis.index,points:[{x:coordsX.value,y:coordsY.value}]}},navigation.annotationsOptions,navigation.bindings.verticalLine.annotationsOptions);this.chart.addAnnotation(options)}},crooked3:{className:"highcharts-crooked3",start:function(e){var _a=this.getCoords(e),coordsX=_a[0],coordsY=_a[1];if(!coordsX||!coordsY){return}var x=coordsX.value,y=coordsY.value,navigation=this.chart.options.navigation,options=merge({langKey:"crooked3",type:"crookedLine",typeOptions:{xAxis:coordsX.axis.index,yAxis:coordsY.axis.index,points:[{x:x,y:y},{x:x,y:y},{x:x,y:y}]}},navigation.annotationsOptions,navigation.bindings.crooked3.annotationsOptions);return this.chart.addAnnotation(options)},steps:[updateNthPoint(1),updateNthPoint(2)]},crooked5:{className:"highcharts-crooked5",start:function(e){var _a=this.getCoords(e),coordsX=_a[0],coordsY=_a[1];if(!coordsX||!coordsY){return}var x=coordsX.value,y=coordsY.value,navigation=this.chart.options.navigation,options=merge({langKey:"crooked5",type:"crookedLine",typeOptions:{xAxis:coordsX.axis.index,yAxis:coordsY.axis.index,points:[{x:x,y:y},{x:x,y:y},{x:x,y:y},{x:x,y:y},{x:x,y:y}]}},navigation.annotationsOptions,navigation.bindings.crooked5.annotationsOptions);return this.chart.addAnnotation(options)},steps:[updateNthPoint(1),updateNthPoint(2),updateNthPoint(3),updateNthPoint(4)]},elliott3:{className:"highcharts-elliott3",start:function(e){var _a=this.getCoords(e),coordsX=_a[0],coordsY=_a[1];if(!coordsX||!coordsY){return}var x=coordsX.value,y=coordsY.value,navigation=this.chart.options.navigation,options=merge({langKey:"elliott3",type:"elliottWave",typeOptions:{xAxis:coordsX.axis.index,yAxis:coordsY.axis.index,points:[{x:x,y:y},{x:x,y:y},{x:x,y:y},{x:x,y:y}]},labelOptions:{style:{color:"#666666"}}},navigation.annotationsOptions,navigation.bindings.elliott3.annotationsOptions);return this.chart.addAnnotation(options)},steps:[updateNthPoint(1),updateNthPoint(2),updateNthPoint(3)]},elliott5:{className:"highcharts-elliott5",start:function(e){var _a=this.getCoords(e),coordsX=_a[0],coordsY=_a[1];if(!coordsX||!coordsY){return}var x=coordsX.value,y=coordsY.value,navigation=this.chart.options.navigation,options=merge({langKey:"elliott5",type:"elliottWave",typeOptions:{xAxis:coordsX.axis.index,yAxis:coordsY.axis.index,points:[{x:x,y:y},{x:x,y:y},{x:x,y:y},{x:x,y:y},{x:x,y:y},{x:x,y:y}]},labelOptions:{style:{color:"#666666"}}},navigation.annotationsOptions,navigation.bindings.elliott5.annotationsOptions);return this.chart.addAnnotation(options)},steps:[updateNthPoint(1),updateNthPoint(2),updateNthPoint(3),updateNthPoint(4),updateNthPoint(5)]},measureX:{className:"highcharts-measure-x",start:function(e){var _a=this.getCoords(e),coordsX=_a[0],coordsY=_a[1];if(!coordsX||!coordsY){return}var x=coordsX.value,y=coordsY.value,navigation=this.chart.options.navigation,options=merge({langKey:"measure",type:"measure",typeOptions:{selectType:"x",xAxis:coordsX.axis.index,yAxis:coordsY.axis.index,point:{x:x,y:y},crosshairX:{strokeWidth:1,stroke:"#000000"},crosshairY:{enabled:false,strokeWidth:0,stroke:"#000000"},background:{width:0,height:0,strokeWidth:0,stroke:"#ffffff"}},labelOptions:{style:{color:"#666666"}}},navigation.annotationsOptions,navigation.bindings.measureX.annotationsOptions);return this.chart.addAnnotation(options)},steps:[updateRectSize]},measureY:{className:"highcharts-measure-y",start:function(e){var _a=this.getCoords(e),coordsX=_a[0],coordsY=_a[1];if(!coordsX||!coordsY){return}var x=coordsX.value,y=coordsY.value,navigation=this.chart.options.navigation,options=merge({langKey:"measure",type:"measure",typeOptions:{selectType:"y",xAxis:coordsX.axis.index,yAxis:coordsY.axis.index,point:{x:x,y:y},crosshairX:{enabled:false,strokeWidth:0,stroke:"#000000"},crosshairY:{strokeWidth:1,stroke:"#000000"},background:{width:0,height:0,strokeWidth:0,stroke:"#ffffff"}},labelOptions:{style:{color:"#666666"}}},navigation.annotationsOptions,navigation.bindings.measureY.annotationsOptions);return this.chart.addAnnotation(options)},steps:[updateRectSize]},measureXY:{className:"highcharts-measure-xy",start:function(e){var _a=this.getCoords(e),coordsX=_a[0],coordsY=_a[1];if(!coordsX||!coordsY){return}var x=coordsX.value,y=coordsY.value,navigation=this.chart.options.navigation,options=merge({langKey:"measure",type:"measure",typeOptions:{selectType:"xy",xAxis:coordsX.axis.index,yAxis:coordsY.axis.index,point:{x:x,y:y},background:{width:0,height:0,strokeWidth:0,stroke:"#ffffff"},crosshairX:{strokeWidth:1,stroke:"#000000"},crosshairY:{strokeWidth:1,stroke:"#000000"}},labelOptions:{style:{color:"#666666"}}},navigation.annotationsOptions,navigation.bindings.measureXY.annotationsOptions);return this.chart.addAnnotation(options)},steps:[updateRectSize]},fibonacci:{className:"highcharts-fibonacci",start:function(e){var _a=this.getCoords(e),coordsX=_a[0],coordsY=_a[1];if(!coordsX||!coordsY){return}var x=coordsX.value,y=coordsY.value,navigation=this.chart.options.navigation,options=merge({langKey:"fibonacci",type:"fibonacci",typeOptions:{xAxis:coordsX.axis.index,yAxis:coordsY.axis.index,points:[{x:x,y:y},{x:x,y:y}]},labelOptions:{style:{color:"#666666"}}},navigation.annotationsOptions,navigation.bindings.fibonacci.annotationsOptions);return this.chart.addAnnotation(options)},steps:[updateNthPoint(1),updateHeight]},parallelChannel:{className:"highcharts-parallel-channel",start:function(e){var _a=this.getCoords(e),coordsX=_a[0],coordsY=_a[1];if(!coordsX||!coordsY){return}var x=coordsX.value,y=coordsY.value,navigation=this.chart.options.navigation,options=merge({langKey:"parallelChannel",type:"tunnel",typeOptions:{xAxis:coordsX.axis.index,yAxis:coordsY.axis.index,points:[{x:x,y:y},{x:x,y:y}]}},navigation.annotationsOptions,navigation.bindings.parallelChannel.annotationsOptions);return this.chart.addAnnotation(options)},steps:[updateNthPoint(1),updateHeight]},pitchfork:{className:"highcharts-pitchfork",start:function(e){var _a=this.getCoords(e),coordsX=_a[0],coordsY=_a[1];if(!coordsX||!coordsY){return}var x=coordsX.value,y=coordsY.value,navigation=this.chart.options.navigation,options=merge({langKey:"pitchfork",type:"pitchfork",typeOptions:{xAxis:coordsX.axis.index,yAxis:coordsY.axis.index,points:[{x:coordsX.value,y:coordsY.value,controlPoint:{style:{fill:"#f21313"}}},{x:x,y:y},{x:x,y:y}],innerBackground:{fill:"rgba(100, 170, 255, 0.8)"}},shapeOptions:{strokeWidth:2}},navigation.annotationsOptions,navigation.bindings.pitchfork.annotationsOptions);return this.chart.addAnnotation(options)},steps:[updateNthPoint(1),updateNthPoint(2)]},verticalCounter:{className:"highcharts-vertical-counter",start:function(e){var closestPoint=attractToPoint(e,this.chart);if(!closestPoint){return}this.verticalCounter=this.verticalCounter||0;var navigation=this.chart.options.navigation,options=merge({langKey:"verticalCounter",type:"verticalLine",typeOptions:{point:{x:closestPoint.x,y:closestPoint.y,xAxis:closestPoint.xAxis,yAxis:closestPoint.yAxis},label:{offset:closestPoint.below?40:-40,text:this.verticalCounter.toString()}},labelOptions:{style:{color:"#666666",fontSize:"0.7em"}},shapeOptions:{stroke:"rgba(0, 0, 0, 0.75)",strokeWidth:1}},navigation.annotationsOptions,navigation.bindings.verticalCounter.annotationsOptions),annotation=this.chart.addAnnotation(options);this.verticalCounter++;annotation.options.events.click.call(annotation,{})}},timeCycles:{className:"highcharts-time-cycles",start:function(e){var closestPoint=attractToPoint(e,this.chart);if(!closestPoint){return}var navigation=this.chart.options.navigation,options=merge({langKey:"timeCycles",type:"timeCycles",typeOptions:{xAxis:closestPoint.xAxis,yAxis:closestPoint.yAxis,points:[{x:closestPoint.x},{x:closestPoint.x}],line:{stroke:"rgba(0, 0, 0, 0.75)",fill:"transparent",strokeWidth:2}}},navigation.annotationsOptions,navigation.bindings.timeCycles.annotationsOptions),annotation=this.chart.addAnnotation(options);annotation.options.events.click.call(annotation,{});return annotation},steps:[updateNthPoint(1)]},verticalLabel:{className:"highcharts-vertical-label",start:function(e){var closestPoint=attractToPoint(e,this.chart);if(!closestPoint){return}var navigation=this.chart.options.navigation,options=merge({langKey:"verticalLabel",type:"verticalLine",typeOptions:{point:{x:closestPoint.x,y:closestPoint.y,xAxis:closestPoint.xAxis,yAxis:closestPoint.yAxis},label:{offset:closestPoint.below?40:-40}},labelOptions:{style:{color:"#666666",fontSize:"0.7em"}},shapeOptions:{stroke:"rgba(0, 0, 0, 0.75)",strokeWidth:1}},navigation.annotationsOptions,navigation.bindings.verticalLabel.annotationsOptions),annotation=this.chart.addAnnotation(options);annotation.options.events.click.call(annotation,{})}},verticalArrow:{className:"highcharts-vertical-arrow",start:function(e){var closestPoint=attractToPoint(e,this.chart);if(!closestPoint){return}var navigation=this.chart.options.navigation,options=merge({langKey:"verticalArrow",type:"verticalLine",typeOptions:{point:{x:closestPoint.x,y:closestPoint.y,xAxis:closestPoint.xAxis,yAxis:closestPoint.yAxis},label:{offset:closestPoint.below?40:-40,format:" "},connector:{fill:"none",stroke:closestPoint.below?"#f21313":"#06b535"}},shapeOptions:{stroke:"rgba(0, 0, 0, 0.75)",strokeWidth:1}},navigation.annotationsOptions,navigation.bindings.verticalArrow.annotationsOptions),annotation=this.chart.addAnnotation(options);annotation.options.events.click.call(annotation,{})}},fibonacciTimeZones:{className:"highcharts-fibonacci-time-zones",start:function(e){var _a=this.getCoords(e),coordsX=_a[0],coordsY=_a[1];if(!coordsX||!coordsY){return}var navigation=this.chart.options.navigation,options=merge({type:"fibonacciTimeZones",langKey:"fibonacciTimeZones",typeOptions:{xAxis:coordsX.axis.index,yAxis:coordsY.axis.index,points:[{x:coordsX.value}]}},navigation.annotationsOptions,navigation.bindings.fibonacciTimeZones.annotationsOptions);return this.chart.addAnnotation(options)},steps:[function(e,annotation){var mockPointOpts=annotation.options.typeOptions.points,x=mockPointOpts&&mockPointOpts[0].x,_a=this.getCoords(e),coordsX=_a[0],coordsY=_a[1];if(coordsX&&coordsY){annotation.update({typeOptions:{xAxis:coordsX.axis.index,yAxis:coordsY.axis.index,points:[{x:x},{x:coordsX.value}]}})}}]},flagCirclepin:{className:"highcharts-flag-circlepin",start:addFlagFromForm("circlepin")},flagDiamondpin:{className:"highcharts-flag-diamondpin",start:addFlagFromForm("flag")},flagSquarepin:{className:"highcharts-flag-squarepin",start:addFlagFromForm("squarepin")},flagSimplepin:{className:"highcharts-flag-simplepin",start:addFlagFromForm("nopin")},zoomX:{className:"highcharts-zoom-x",init:function(button){this.chart.update({chart:{zooming:{type:"x"}}});fireEvent(this,"deselectButton",{button:button})}},zoomY:{className:"highcharts-zoom-y",init:function(button){this.chart.update({chart:{zooming:{type:"y"}}});fireEvent(this,"deselectButton",{button:button})}},zoomXY:{className:"highcharts-zoom-xy",init:function(button){this.chart.update({chart:{zooming:{type:"xy"}}});fireEvent(this,"deselectButton",{button:button})}},seriesTypeLine:{className:"highcharts-series-type-line",init:function(button){this.chart.series[0].update({type:"line",useOhlcData:true});fireEvent(this,"deselectButton",{button:button})}},seriesTypeOhlc:{className:"highcharts-series-type-ohlc",init:function(button){this.chart.series[0].update({type:"ohlc"});fireEvent(this,"deselectButton",{button:button})}},seriesTypeCandlestick:{className:"highcharts-series-type-candlestick",init:function(button){this.chart.series[0].update({type:"candlestick"});fireEvent(this,"deselectButton",{button:button})}},seriesTypeHeikinAshi:{className:"highcharts-series-type-heikinashi",init:function(button){this.chart.series[0].update({type:"heikinashi"});fireEvent(this,"deselectButton",{button:button})}},seriesTypeHLC:{className:"highcharts-series-type-hlc",init:function(button){this.chart.series[0].update({type:"hlc",useOhlcData:true});fireEvent(this,"deselectButton",{button:button})}},seriesTypeHollowCandlestick:{className:"highcharts-series-type-hollowcandlestick",init:function(button){this.chart.series[0].update({type:"hollowcandlestick"});fireEvent(this,"deselectButton",{button:button})}},fullScreen:{className:"highcharts-full-screen",noDataState:"normal",init:function(button){if(this.chart.fullscreen){this.chart.fullscreen.toggle()}fireEvent(this,"deselectButton",{button:button})}},currentPriceIndicator:{className:"highcharts-current-price-indicator",init:function(button){var chart=this.chart,series=chart.series,gui=chart.stockTools,priceIndicatorEnabled=isPriceIndicatorEnabled(chart.series);if(gui&&gui.guiEnabled){series.forEach(function(series){series.update({lastPrice:{enabled:!priceIndicatorEnabled},lastVisiblePrice:{enabled:!priceIndicatorEnabled,label:{enabled:true}}},false)});chart.redraw()}fireEvent(this,"deselectButton",{button:button})}},indicators:{className:"highcharts-indicators",init:function(){var navigation=this;fireEvent(navigation,"showPopup",{formType:"indicators",options:{},onSubmit:function(data){manageIndicators.call(navigation,data)}})}},toggleAnnotations:{className:"highcharts-toggle-annotations",init:function(button){var chart=this.chart,gui=chart.stockTools,iconsURL=gui.getIconsURL();this.toggledAnnotations=!this.toggledAnnotations;(chart.annotations||[]).forEach(function(annotation){annotation.setVisibility(!this.toggledAnnotations)},this);if(gui&&gui.guiEnabled){if(this.toggledAnnotations){button.firstChild.style["background-image"]='url("'+iconsURL+'annotations-hidden.svg")'}else{button.firstChild.style["background-image"]='url("'+iconsURL+'annotations-visible.svg")'}}fireEvent(this,"deselectButton",{button:button})}},saveChart:{className:"highcharts-save-chart",noDataState:"normal",init:function(button){var navigation=this,chart=navigation.chart,annotations=[],indicators=[],flags=[],yAxes=[];chart.annotations.forEach(function(annotation,index){annotations[index]=annotation.userOptions});chart.series.forEach(function(series){if(series.is("sma")){indicators.push(series.userOptions)}else if(series.type==="flags"){flags.push(series.userOptions)}});chart.yAxis.forEach(function(yAxis){if(isNotNavigatorYAxis(yAxis)){yAxes.push(yAxis.options)}});H.win.localStorage.setItem("highcharts-chart",JSON.stringify({annotations:annotations,indicators:indicators,flags:flags,yAxes:yAxes}));fireEvent(this,"deselectButton",{button:button})}}};export default StockToolsBindings;