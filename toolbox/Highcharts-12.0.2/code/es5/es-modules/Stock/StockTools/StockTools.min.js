"use strict";import D from"../../Core/Defaults.js";var setOptions=D.setOptions;import NBU from"../../Extensions/Annotations/NavigationBindingsUtilities.js";var getAssignedAxis=NBU.getAssignedAxis;import StockToolsBindings from"./StockToolsBindings.js";import StockToolsDefaults from"./StockToolsDefaults.js";import STU from"./StockToolsUtilities.js";var isNotNavigatorYAxis=STU.isNotNavigatorYAxis,isPriceIndicatorEnabled=STU.isPriceIndicatorEnabled;import U from"../../Core/Utilities.js";var correctFloat=U.correctFloat,defined=U.defined,isNumber=U.isNumber,pick=U.pick;function compose(NavigationBindingsClass){var _a;var navigationProto=NavigationBindingsClass.prototype;if(!((_a=navigationProto.utils)===null||_a===void 0?void 0:_a.manageIndicators)){navigationProto.getYAxisPositions=navigationGetYAxisPositions;navigationProto.getYAxisResizers=navigationGetYAxisResizers;navigationProto.recalculateYAxisPositions=navigationRecalculateYAxisPositions;navigationProto.resizeYAxes=navigationResizeYAxes;navigationProto.utils=navigationProto.utils||{};navigationProto.utils.indicatorsWithAxes=STU.indicatorsWithAxes;navigationProto.utils.indicatorsWithVolume=STU.indicatorsWithVolume;navigationProto.utils.getAssignedAxis=getAssignedAxis;navigationProto.utils.isPriceIndicatorEnabled=isPriceIndicatorEnabled;navigationProto.utils.manageIndicators=STU.manageIndicators;setOptions(StockToolsDefaults);setOptions({navigation:{bindings:StockToolsBindings}})}}function navigationGetYAxisPositions(yAxes,plotHeight,defaultHeight,removedYAxisProps){var allAxesHeight=0,previousAxisHeight,removedHeight,removedTop;function isPercentage(prop){return defined(prop)&&!isNumber(prop)&&prop.match("%")}if(removedYAxisProps){removedTop=correctFloat(parseFloat(removedYAxisProps.top)/100);removedHeight=correctFloat(parseFloat(removedYAxisProps.height)/100)}var positions=yAxes.map(function(yAxis,index){var height=correctFloat(isPercentage(yAxis.options.height)?parseFloat(yAxis.options.height)/100:yAxis.height/plotHeight),top=correctFloat(isPercentage(yAxis.options.top)?parseFloat(yAxis.options.top)/100:(yAxis.top-yAxis.chart.plotTop)/plotHeight);if(!removedHeight){if(!isNumber(height)){height=yAxes[index-1].series.every(function(s){return s.is("sma")})?previousAxisHeight:defaultHeight/100}if(!isNumber(top)){top=allAxesHeight}previousAxisHeight=height;allAxesHeight=correctFloat(Math.max(allAxesHeight,(top||0)+(height||0)))}else{if(top>removedTop){top-=removedHeight}allAxesHeight=Math.max(allAxesHeight,(top||0)+(height||0))}return{height:height*100,top:top*100}});return{positions:positions,allAxesHeight:allAxesHeight}}function navigationGetYAxisResizers(yAxes){var resizers=[];yAxes.forEach(function(_yAxis,index){var nextYAxis=yAxes[index+1];if(nextYAxis){resizers[index]={enabled:true,controlledAxis:{next:[pick(nextYAxis.options.id,nextYAxis.index)]}}}else{resizers[index]={enabled:false}}});return resizers}function navigationRecalculateYAxisPositions(positions,changedSpace,modifyHeight,adder){positions.forEach(function(position,index){var prevPosition=positions[index-1];position.top=!prevPosition?0:correctFloat(prevPosition.height+prevPosition.top);if(modifyHeight){position.height=correctFloat(position.height+adder*changedSpace)}});return positions}function navigationResizeYAxes(removedYAxisProps){var defaultHeight=20;var chart=this.chart,yAxes=chart.yAxis.filter(isNotNavigatorYAxis),plotHeight=chart.plotHeight,_a=this.getYAxisPositions(yAxes,plotHeight,defaultHeight,removedYAxisProps),positions=_a.positions,allAxesHeight=_a.allAxesHeight,resizers=this.getYAxisResizers(yAxes);if(!removedYAxisProps&&allAxesHeight<=correctFloat(.8+defaultHeight/100)){positions[positions.length-1]={height:defaultHeight,top:correctFloat(allAxesHeight*100-defaultHeight)}}else{positions.forEach(function(position){position.height=position.height/(allAxesHeight*100)*100;position.top=position.top/(allAxesHeight*100)*100})}positions.forEach(function(position,index){yAxes[index].update({height:position.height+"%",top:position.top+"%",resize:resizers[index],offset:0},false)})}var StockTools={compose:compose};export default StockTools;