"use strict";import U from"../../Core/Utilities.js";import AST from"../../Core/Renderer/HTML/AST.js";import StockToolsUtilities from"./StockToolsUtilities.js";var addEvent=U.addEvent,createElement=U.createElement,css=U.css,defined=U.defined,fireEvent=U.fireEvent,getStyle=U.getStyle,isArray=U.isArray,merge=U.merge,pick=U.pick;var shallowArraysEqual=StockToolsUtilities.shallowArraysEqual;var Toolbar=function(){function Toolbar(options,langOptions,chart){this.width=0;this.isDirty=false;this.chart=chart;this.options=options;this.lang=langOptions;this.iconsURL=this.getIconsURL();this.guiEnabled=options.enabled;this.visible=pick(options.visible,true);this.guiClassName=options.className;this.toolbarClassName=options.toolbarClassName;this.eventsToUnbind=[];if(this.guiEnabled){this.createContainer();this.createButtons();this.showHideNavigation()}fireEvent(this,"afterInit")}Toolbar.prototype.createButtons=function(){var _this=this;var lang=this.lang,guiOptions=this.options,toolbar=this.toolbar,buttons=guiOptions.buttons,defs=guiOptions.definitions,allButtons=toolbar.childNodes;this.buttonList=buttons;buttons.forEach(function(btnName){var button=_this.addButton(toolbar,defs,btnName,lang);_this.eventsToUnbind.push(addEvent(button.buttonWrapper,"click",function(){return _this.eraseActiveButtons(allButtons,button.buttonWrapper)}));if(isArray(defs[btnName].items)){_this.addSubmenu(button,defs[btnName])}})};Toolbar.prototype.addSubmenu=function(parentBtn,button){var _this=this;var submenuArrow=parentBtn.submenuArrow,buttonWrapper=parentBtn.buttonWrapper,buttonWidth=getStyle(buttonWrapper,"width"),wrapper=this.wrapper,menuWrapper=this.listWrapper,allButtons=this.toolbar.childNodes,submenuWrapper=this.submenu=createElement("ul",{className:"highcharts-submenu-wrapper"},void 0,buttonWrapper);this.addSubmenuItems(buttonWrapper,button);this.eventsToUnbind.push(addEvent(submenuArrow,"click",function(e){e.stopPropagation();_this.eraseActiveButtons(allButtons,buttonWrapper);if(buttonWrapper.className.indexOf("highcharts-current")>=0){menuWrapper.style.width=menuWrapper.startWidth+"px";buttonWrapper.classList.remove("highcharts-current");submenuWrapper.style.display="none"}else{submenuWrapper.style.display="block";var topMargin=submenuWrapper.offsetHeight-buttonWrapper.offsetHeight-3;if(!(submenuWrapper.offsetHeight+buttonWrapper.offsetTop>wrapper.offsetHeight&&buttonWrapper.offsetTop>topMargin)){topMargin=0}css(submenuWrapper,{top:-topMargin+"px",left:buttonWidth+3+"px"});buttonWrapper.className+=" highcharts-current";menuWrapper.startWidth=wrapper.offsetWidth;menuWrapper.style.width=menuWrapper.startWidth+getStyle(menuWrapper,"padding-left")+submenuWrapper.offsetWidth+3+"px"}}))};Toolbar.prototype.addSubmenuItems=function(buttonWrapper,button){var _this=this;var _self=this,submenuWrapper=this.submenu,lang=this.lang,menuWrapper=this.listWrapper,items=button.items;var submenuBtn;items.forEach(function(btnName){submenuBtn=_this.addButton(submenuWrapper,button,btnName,lang);_this.eventsToUnbind.push(addEvent(submenuBtn.mainButton,"click",function(){_self.switchSymbol(this,buttonWrapper,true);menuWrapper.style.width=menuWrapper.startWidth+"px";submenuWrapper.style.display="none"}))});var firstSubmenuItem=submenuWrapper.querySelectorAll("li > .highcharts-menu-item-btn")[0];this.switchSymbol(firstSubmenuItem,false)};Toolbar.prototype.eraseActiveButtons=function(buttons,currentButton,submenuItems){[].forEach.call(buttons,function(btn){if(btn!==currentButton){btn.classList.remove("highcharts-current");btn.classList.remove("highcharts-active");submenuItems=btn.querySelectorAll(".highcharts-submenu-wrapper");if(submenuItems.length>0){submenuItems[0].style.display="none"}}})};Toolbar.prototype.addButton=function(target,options,btnName,lang){if(lang===void 0){lang={}}var btnOptions=options[btnName],items=btnOptions.items,classMapping=Toolbar.prototype.classMapping,userClassName=btnOptions.className||"";var buttonWrapper=createElement("li",{className:pick(classMapping[btnName],"")+" "+userClassName,title:lang[btnName]||btnName},void 0,target);var elementType=btnOptions.elementType||"button";var mainButton=createElement(elementType,{className:"highcharts-menu-item-btn"},void 0,buttonWrapper);if(items&&items.length){var submenuArrow=createElement("button",{className:"highcharts-submenu-item-arrow "+"highcharts-arrow-right"},void 0,buttonWrapper);submenuArrow.style.backgroundImage="url("+this.iconsURL+"arrow-bottom.svg)";return{buttonWrapper:buttonWrapper,mainButton:mainButton,submenuArrow:submenuArrow}}mainButton.style.backgroundImage="url("+this.iconsURL+btnOptions.symbol+")";return{buttonWrapper:buttonWrapper,mainButton:mainButton}};Toolbar.prototype.addNavigation=function(){var wrapper=this.wrapper;this.arrowWrapper=createElement("div",{className:"highcharts-arrow-wrapper"});this.arrowUp=createElement("div",{className:"highcharts-arrow-up"},void 0,this.arrowWrapper);this.arrowUp.style.backgroundImage="url("+this.iconsURL+"arrow-right.svg)";this.arrowDown=createElement("div",{className:"highcharts-arrow-down"},void 0,this.arrowWrapper);this.arrowDown.style.backgroundImage="url("+this.iconsURL+"arrow-right.svg)";wrapper.insertBefore(this.arrowWrapper,wrapper.childNodes[0]);this.scrollButtons()};Toolbar.prototype.scrollButtons=function(){var wrapper=this.wrapper,toolbar=this.toolbar,step=.1*wrapper.offsetHeight;var targetY=0;this.eventsToUnbind.push(addEvent(this.arrowUp,"click",function(){if(targetY>0){targetY-=step;toolbar.style.marginTop=-targetY+"px"}}));this.eventsToUnbind.push(addEvent(this.arrowDown,"click",function(){if(wrapper.offsetHeight+targetY<=toolbar.offsetHeight+step){targetY+=step;toolbar.style.marginTop=-targetY+"px"}}))};Toolbar.prototype.createContainer=function(){var _this=this;var chart=this.chart,guiOptions=this.options,container=chart.container,navigation=chart.options.navigation,bindingsClassName=navigation===null||navigation===void 0?void 0:navigation.bindingsClassName,self=this;var listWrapper,toolbar;var wrapper=this.wrapper=createElement("div",{className:"highcharts-stocktools-wrapper "+guiOptions.className+" "+bindingsClassName});container.appendChild(wrapper);this.showHideBtn=createElement("div",{className:"highcharts-toggle-toolbar highcharts-arrow-left"},void 0,wrapper);this.eventsToUnbind.push(addEvent(this.showHideBtn,"click",function(){_this.update({gui:{visible:!self.visible}})}));["mousedown","mousemove","click","touchstart"].forEach(function(eventType){addEvent(wrapper,eventType,function(e){return e.stopPropagation()})});addEvent(wrapper,"mouseover",function(e){var _a;return(_a=chart.pointer)===null||_a===void 0?void 0:_a.onContainerMouseLeave(e)});this.toolbar=toolbar=createElement("ul",{className:"highcharts-stocktools-toolbar "+guiOptions.toolbarClassName});this.listWrapper=listWrapper=createElement("div",{className:"highcharts-menu-wrapper"});wrapper.insertBefore(listWrapper,wrapper.childNodes[0]);listWrapper.insertBefore(toolbar,listWrapper.childNodes[0]);this.showHideToolbar();this.addNavigation()};Toolbar.prototype.showHideNavigation=function(){if(this.visible&&this.toolbar.offsetHeight>this.wrapper.offsetHeight-50){this.arrowWrapper.style.display="block"}else{this.toolbar.style.marginTop="0px";this.arrowWrapper.style.display="none"}};Toolbar.prototype.showHideToolbar=function(){var wrapper=this.wrapper,toolbar=this.listWrapper,submenu=this.submenu,showHideBtn=this.showHideBtn;var visible=this.visible;showHideBtn.style.backgroundImage="url("+this.iconsURL+"arrow-right.svg)";if(!visible){if(submenu){submenu.style.display="none"}showHideBtn.style.left="0px";visible=this.visible=false;toolbar.classList.add("highcharts-hide");showHideBtn.classList.add("highcharts-arrow-right");wrapper.style.height=showHideBtn.offsetHeight+"px"}else{wrapper.style.height="100%";toolbar.classList.remove("highcharts-hide");showHideBtn.classList.remove("highcharts-arrow-right");showHideBtn.style.top=getStyle(toolbar,"padding-top")+"px";showHideBtn.style.left=wrapper.offsetWidth+getStyle(toolbar,"padding-left")+"px"}};Toolbar.prototype.switchSymbol=function(button,redraw){var buttonWrapper=button.parentNode,buttonWrapperClass=buttonWrapper.className,mainNavButton=buttonWrapper.parentNode.parentNode;if(buttonWrapperClass.indexOf("highcharts-disabled-btn")>-1){return}mainNavButton.className="";if(buttonWrapperClass){mainNavButton.classList.add(buttonWrapperClass.trim())}mainNavButton.querySelectorAll(".highcharts-menu-item-btn")[0].style.backgroundImage=button.style.backgroundImage;if(redraw){this.toggleButtonActiveClass(mainNavButton)}};Toolbar.prototype.toggleButtonActiveClass=function(button){var classList=button.classList;if(classList.contains("highcharts-active")){classList.remove("highcharts-active")}else{classList.add("highcharts-active")}};Toolbar.prototype.unselectAllButtons=function(button){var activeBtns=button.parentNode.querySelectorAll(".highcharts-active");[].forEach.call(activeBtns,function(activeBtn){if(activeBtn!==button){activeBtn.classList.remove("highcharts-active")}})};Toolbar.prototype.update=function(options,redraw){this.isDirty=!!options.gui.definitions;merge(true,this.chart.options.stockTools,options);merge(true,this.options,options.gui);this.visible=pick(this.options.visible&&this.options.enabled,true);if(this.chart.navigationBindings){this.chart.navigationBindings.update()}this.chart.isDirtyBox=true;if(pick(redraw,true)){this.chart.redraw()}};Toolbar.prototype.destroy=function(){var stockToolsDiv=this.wrapper,parent=stockToolsDiv&&stockToolsDiv.parentNode;this.eventsToUnbind.forEach(function(unbinder){return unbinder()});if(parent){parent.removeChild(stockToolsDiv)}};Toolbar.prototype.redraw=function(){if(this.options.enabled!==this.guiEnabled){this.handleGuiEnabledChange()}else{if(!this.guiEnabled){return}this.updateClassNames();this.updateButtons();this.updateVisibility();this.showHideNavigation();this.showHideToolbar()}};Toolbar.prototype.handleGuiEnabledChange=function(){if(this.options.enabled===false){this.destroy();this.visible=false}if(this.options.enabled===true){this.createContainer();this.createButtons()}this.guiEnabled=this.options.enabled};Toolbar.prototype.updateClassNames=function(){if(this.options.className!==this.guiClassName){if(this.guiClassName){this.wrapper.classList.remove(this.guiClassName)}if(this.options.className){this.wrapper.classList.add(this.options.className)}this.guiClassName=this.options.className}if(this.options.toolbarClassName!==this.toolbarClassName){if(this.toolbarClassName){this.toolbar.classList.remove(this.toolbarClassName)}if(this.options.toolbarClassName){this.toolbar.classList.add(this.options.toolbarClassName)}this.toolbarClassName=this.options.toolbarClassName}};Toolbar.prototype.updateButtons=function(){if(!shallowArraysEqual(this.options.buttons,this.buttonList)||this.isDirty){this.toolbar.innerHTML=AST.emptyHTML;this.createButtons()}};Toolbar.prototype.updateVisibility=function(){if(defined(this.options.visible)){this.visible=this.options.visible}};Toolbar.prototype.getIconsURL=function(){return this.chart.options.navigation.iconsURL||this.options.iconsURL||"https://code.highcharts.com/@product.version@/gfx/stock-icons/"};return Toolbar}();Toolbar.prototype.classMapping={circle:"highcharts-circle-annotation",ellipse:"highcharts-ellipse-annotation",rectangle:"highcharts-rectangle-annotation",label:"highcharts-label-annotation",segment:"highcharts-segment",arrowSegment:"highcharts-arrow-segment",ray:"highcharts-ray",arrowRay:"highcharts-arrow-ray",line:"highcharts-infinity-line",arrowInfinityLine:"highcharts-arrow-infinity-line",verticalLine:"highcharts-vertical-line",horizontalLine:"highcharts-horizontal-line",crooked3:"highcharts-crooked3",crooked5:"highcharts-crooked5",elliott3:"highcharts-elliott3",elliott5:"highcharts-elliott5",pitchfork:"highcharts-pitchfork",fibonacci:"highcharts-fibonacci",fibonacciTimeZones:"highcharts-fibonacci-time-zones",parallelChannel:"highcharts-parallel-channel",measureX:"highcharts-measure-x",measureY:"highcharts-measure-y",measureXY:"highcharts-measure-xy",timeCycles:"highcharts-time-cycles",verticalCounter:"highcharts-vertical-counter",verticalLabel:"highcharts-vertical-label",verticalArrow:"highcharts-vertical-arrow",currentPriceIndicator:"highcharts-current-price-indicator",indicators:"highcharts-indicators",flagCirclepin:"highcharts-flag-circlepin",flagDiamondpin:"highcharts-flag-diamondpin",flagSquarepin:"highcharts-flag-squarepin",flagSimplepin:"highcharts-flag-simplepin",zoomX:"highcharts-zoom-x",zoomY:"highcharts-zoom-y",zoomXY:"highcharts-zoom-xy",typeLine:"highcharts-series-type-line",typeOHLC:"highcharts-series-type-ohlc",typeHLC:"highcharts-series-type-hlc",typeCandlestick:"highcharts-series-type-candlestick",typeHollowCandlestick:"highcharts-series-type-hollowcandlestick",typeHeikinAshi:"highcharts-series-type-heikinashi",fullScreen:"highcharts-full-screen",toggleAnnotations:"highcharts-toggle-annotations",saveChart:"highcharts-save-chart",separator:"highcharts-separator"};export default Toolbar;