"use strict";var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};import Axis from"../../Core/Axis/Axis.js";import ChartNavigatorComposition from"./ChartNavigatorComposition.js";import D from"../../Core/Defaults.js";var defaultOptions=D.defaultOptions;import H from"../../Core/Globals.js";var isTouchDevice=H.isTouchDevice;import NavigatorAxisAdditions from"../../Core/Axis/NavigatorAxisComposition.js";import NavigatorComposition from"./NavigatorComposition.js";import Scrollbar from"../Scrollbar/Scrollbar.js";import SVGRenderer from"../../Core/Renderer/SVG/SVGRenderer.js";var symbols=SVGRenderer.prototype.symbols;import U from"../../Core/Utilities.js";var addEvent=U.addEvent,clamp=U.clamp,correctFloat=U.correctFloat,defined=U.defined,destroyObjectProperties=U.destroyObjectProperties,erase=U.erase,extend=U.extend,find=U.find,fireEvent=U.fireEvent,isArray=U.isArray,isNumber=U.isNumber,merge=U.merge,pick=U.pick,removeEvent=U.removeEvent,splat=U.splat;function numExt(extreme){var args=[];for(var _i=1;_i<arguments.length;_i++){args[_i-1]=arguments[_i]}var numbers=[].filter.call(args,isNumber);if(numbers.length){return Math[extreme].apply(0,numbers)}}var Navigator=function(){function Navigator(chart){this.isDirty=false;this.scrollbarHeight=0;this.init(chart)}Navigator.compose=function(ChartClass,AxisClass,SeriesClass){ChartNavigatorComposition.compose(ChartClass,Navigator);NavigatorComposition.compose(ChartClass,AxisClass,SeriesClass)};Navigator.prototype.drawHandle=function(x,index,inverted,verb){var navigator=this,height=navigator.navigatorOptions.handles.height;navigator.handles[index][verb](inverted?{translateX:Math.round(navigator.left+navigator.height/2),translateY:Math.round(navigator.top+parseInt(x,10)+.5-height)}:{translateX:Math.round(navigator.left+parseInt(x,10)),translateY:Math.round(navigator.top+navigator.height/2-height/2-1)})};Navigator.prototype.drawOutline=function(zoomedMin,zoomedMax,inverted,verb){var navigator=this,maskInside=navigator.navigatorOptions.maskInside,outlineWidth=navigator.outline.strokeWidth(),halfOutline=outlineWidth/2,outlineCorrection=outlineWidth%2/2,scrollButtonSize=navigator.scrollButtonSize,navigatorSize=navigator.size,navigatorTop=navigator.top,height=navigator.height,lineTop=navigatorTop-halfOutline,lineBtm=navigatorTop+height;var left=navigator.left,verticalMin,path;if(inverted){verticalMin=navigatorTop+zoomedMax+outlineCorrection;zoomedMax=navigatorTop+zoomedMin+outlineCorrection;path=[["M",left+height,navigatorTop-scrollButtonSize-outlineCorrection],["L",left+height,verticalMin],["L",left,verticalMin],["M",left,zoomedMax],["L",left+height,zoomedMax],["L",left+height,navigatorTop+navigatorSize+scrollButtonSize]];if(maskInside){path.push(["M",left+height,verticalMin-halfOutline],["L",left+height,zoomedMax+halfOutline])}}else{left-=scrollButtonSize;zoomedMin+=left+scrollButtonSize-outlineCorrection;zoomedMax+=left+scrollButtonSize-outlineCorrection;path=[["M",left,lineTop],["L",zoomedMin,lineTop],["L",zoomedMin,lineBtm],["M",zoomedMax,lineBtm],["L",zoomedMax,lineTop],["L",left+navigatorSize+scrollButtonSize*2,lineTop]];if(maskInside){path.push(["M",zoomedMin-halfOutline,lineTop],["L",zoomedMax+halfOutline,lineTop])}}navigator.outline[verb]({d:path})};Navigator.prototype.drawMasks=function(zoomedMin,zoomedMax,inverted,verb){var navigator=this,left=navigator.left,top=navigator.top,navigatorHeight=navigator.height;var height,width,x,y;if(inverted){x=[left,left,left];y=[top,top+zoomedMin,top+zoomedMax];width=[navigatorHeight,navigatorHeight,navigatorHeight];height=[zoomedMin,zoomedMax-zoomedMin,navigator.size-zoomedMax]}else{x=[left,left+zoomedMin,left+zoomedMax];y=[top,top,top];width=[zoomedMin,zoomedMax-zoomedMin,navigator.size-zoomedMax];height=[navigatorHeight,navigatorHeight,navigatorHeight]}navigator.shades.forEach(function(shade,i){shade[verb]({x:x[i],y:y[i],width:width[i],height:height[i]})})};Navigator.prototype.renderElements=function(){var _a,_b;var navigator=this,navigatorOptions=navigator.navigatorOptions,maskInside=navigatorOptions.maskInside,chart=navigator.chart,inverted=chart.inverted,renderer=chart.renderer,mouseCursor={cursor:inverted?"ns-resize":"ew-resize"},navigatorGroup=(_a=navigator.navigatorGroup)!==null&&_a!==void 0?_a:navigator.navigatorGroup=renderer.g("navigator").attr({zIndex:8,visibility:"hidden"}).add();[!maskInside,maskInside,!maskInside].forEach(function(hasMask,index){var _a;var shade=(_a=navigator.shades[index])!==null&&_a!==void 0?_a:navigator.shades[index]=renderer.rect().addClass("highcharts-navigator-mask"+(index===1?"-inside":"-outside")).add(navigatorGroup);if(!chart.styledMode){shade.attr({fill:hasMask?navigatorOptions.maskFill:"rgba(0,0,0,0)"});if(index===1){shade.css(mouseCursor)}}});if(!navigator.outline){navigator.outline=renderer.path().addClass("highcharts-navigator-outline").add(navigatorGroup)}if(!chart.styledMode){navigator.outline.attr({"stroke-width":navigatorOptions.outlineWidth,stroke:navigatorOptions.outlineColor})}if((_b=navigatorOptions.handles)===null||_b===void 0?void 0:_b.enabled){var handlesOptions_1=navigatorOptions.handles,height_1=handlesOptions_1.height,width_1=handlesOptions_1.width;[0,1].forEach(function(index){var _a;var symbolName=handlesOptions_1.symbols[index];if(!navigator.handles[index]||navigator.handles[index].symbolUrl!==symbolName){(_a=navigator.handles[index])===null||_a===void 0?void 0:_a.destroy();navigator.handles[index]=renderer.symbol(symbolName,-width_1/2-1,0,width_1,height_1,handlesOptions_1);navigator.handles[index].attr({zIndex:7-index}).addClass("highcharts-navigator-handle "+"highcharts-navigator-handle-"+["left","right"][index]).add(navigatorGroup);navigator.addMouseEvents()}else if(!navigator.handles[index].isImg&&navigator.handles[index].symbolName!==symbolName){var symbolFn=symbols[symbolName],path=symbolFn.call(symbols,-width_1/2-1,0,width_1,height_1);navigator.handles[index].attr({d:path});navigator.handles[index].symbolName=symbolName}if(chart.inverted){navigator.handles[index].attr({rotation:90,rotationOriginX:Math.floor(-width_1/2),rotationOriginY:(height_1+width_1)/2})}if(!chart.styledMode){navigator.handles[index].attr({fill:handlesOptions_1.backgroundColor,stroke:handlesOptions_1.borderColor,"stroke-width":handlesOptions_1.lineWidth,width:handlesOptions_1.width,height:handlesOptions_1.height,x:-width_1/2-1,y:0}).css(mouseCursor)}})}};Navigator.prototype.update=function(options,redraw){var _a,_b;var _this=this;var _c,_d;if(redraw===void 0){redraw=false}var chart=this.chart,invertedUpdate=chart.options.chart.inverted!==((_c=chart.scrollbar)===null||_c===void 0?void 0:_c.options.vertical);merge(true,chart.options.navigator,options);this.navigatorOptions=chart.options.navigator||{};this.setOpposite();if(defined(options.enabled)||invertedUpdate){this.destroy();this.navigatorEnabled=options.enabled||this.navigatorEnabled;return this.init(chart)}if(this.navigatorEnabled){this.isDirty=true;if(options.adaptToUpdatedData===false){this.baseSeries.forEach(function(series){removeEvent(series,"updatedData",_this.updatedDataHandler)},this)}if(options.adaptToUpdatedData){this.baseSeries.forEach(function(series){series.eventsToUnbind.push(addEvent(series,"updatedData",_this.updatedDataHandler))},this)}if(options.series||options.baseSeries){this.setBaseSeries(void 0,false)}if(options.height||options.xAxis||options.yAxis){this.height=(_d=options.height)!==null&&_d!==void 0?_d:this.height;var offsets=this.getXAxisOffsets();this.xAxis.update(__assign(__assign({},options.xAxis),(_a={offsets:offsets},_a[chart.inverted?"width":"height"]=this.height,_a[chart.inverted?"height":"width"]=void 0,_a)),false);this.yAxis.update(__assign(__assign({},options.yAxis),(_b={},_b[chart.inverted?"width":"height"]=this.height,_b)),false)}}if(redraw){chart.redraw()}};Navigator.prototype.render=function(min,max,pxMin,pxMax){var navigator=this,chart=navigator.chart,xAxis=navigator.xAxis,pointRange=xAxis.pointRange||0,scrollbarXAxis=xAxis.navigatorAxis.fake?chart.xAxis[0]:xAxis,navigatorEnabled=navigator.navigatorEnabled,rendered=navigator.rendered,inverted=chart.inverted,minRange=chart.xAxis[0].minRange,maxRange=chart.xAxis[0].options.maxRange,scrollButtonSize=navigator.scrollButtonSize;var navigatorWidth,scrollbarLeft,scrollbarTop,scrollbarHeight=navigator.scrollbarHeight,navigatorSize,verb;if(this.hasDragged&&!defined(pxMin)){return}if(this.isDirty){this.renderElements()}min=correctFloat(min-pointRange/2);max=correctFloat(max+pointRange/2);if(!isNumber(min)||!isNumber(max)){if(rendered){pxMin=0;pxMax=pick(xAxis.width,scrollbarXAxis.width)}else{return}}navigator.left=pick(xAxis.left,chart.plotLeft+scrollButtonSize+(inverted?chart.plotWidth:0));var zoomedMax=navigator.size=navigatorSize=pick(xAxis.len,(inverted?chart.plotHeight:chart.plotWidth)-2*scrollButtonSize);if(inverted){navigatorWidth=scrollbarHeight}else{navigatorWidth=navigatorSize+2*scrollButtonSize}pxMin=pick(pxMin,xAxis.toPixels(min,true));pxMax=pick(pxMax,xAxis.toPixels(max,true));if(!isNumber(pxMin)||Math.abs(pxMin)===Infinity){pxMin=0;pxMax=navigatorWidth}var newMin=xAxis.toValue(pxMin,true),newMax=xAxis.toValue(pxMax,true),currentRange=Math.abs(correctFloat(newMax-newMin));if(currentRange<minRange){if(this.grabbedLeft){pxMin=xAxis.toPixels(newMax-minRange-pointRange,true)}else if(this.grabbedRight){pxMax=xAxis.toPixels(newMin+minRange+pointRange,true)}}else if(defined(maxRange)&&correctFloat(currentRange-pointRange)>maxRange){if(this.grabbedLeft){pxMin=xAxis.toPixels(newMax-maxRange-pointRange,true)}else if(this.grabbedRight){pxMax=xAxis.toPixels(newMin+maxRange+pointRange,true)}}navigator.zoomedMax=clamp(Math.max(pxMin,pxMax),0,zoomedMax);navigator.zoomedMin=clamp(navigator.fixedWidth?navigator.zoomedMax-navigator.fixedWidth:Math.min(pxMin,pxMax),0,zoomedMax);navigator.range=navigator.zoomedMax-navigator.zoomedMin;zoomedMax=Math.round(navigator.zoomedMax);var zoomedMin=Math.round(navigator.zoomedMin);if(navigatorEnabled){navigator.navigatorGroup.attr({visibility:"inherit"});verb=rendered&&!navigator.hasDragged?"animate":"attr";navigator.drawMasks(zoomedMin,zoomedMax,inverted,verb);navigator.drawOutline(zoomedMin,zoomedMax,inverted,verb);if(navigator.navigatorOptions.handles.enabled){navigator.drawHandle(zoomedMin,0,inverted,verb);navigator.drawHandle(zoomedMax,1,inverted,verb)}}if(navigator.scrollbar){if(inverted){scrollbarTop=navigator.top-scrollButtonSize;scrollbarLeft=navigator.left-scrollbarHeight+(navigatorEnabled||!scrollbarXAxis.opposite?0:(scrollbarXAxis.titleOffset||0)+scrollbarXAxis.axisTitleMargin);scrollbarHeight=navigatorSize+2*scrollButtonSize}else{scrollbarTop=navigator.top+(navigatorEnabled?navigator.height:-scrollbarHeight);scrollbarLeft=navigator.left-scrollButtonSize}navigator.scrollbar.position(scrollbarLeft,scrollbarTop,navigatorWidth,scrollbarHeight);navigator.scrollbar.setRange(navigator.zoomedMin/(navigatorSize||1),navigator.zoomedMax/(navigatorSize||1))}navigator.rendered=true;this.isDirty=false;fireEvent(this,"afterRender")};Navigator.prototype.addMouseEvents=function(){var navigator=this,chart=navigator.chart,container=chart.container;var eventsToUnbind=[],mouseMoveHandler,mouseUpHandler;navigator.mouseMoveHandler=mouseMoveHandler=function(e){navigator.onMouseMove(e)};navigator.mouseUpHandler=mouseUpHandler=function(e){navigator.onMouseUp(e)};eventsToUnbind=navigator.getPartsEvents("mousedown");eventsToUnbind.push(addEvent(chart.renderTo,"mousemove",mouseMoveHandler),addEvent(container.ownerDocument,"mouseup",mouseUpHandler),addEvent(chart.renderTo,"touchmove",mouseMoveHandler),addEvent(container.ownerDocument,"touchend",mouseUpHandler));eventsToUnbind.concat(navigator.getPartsEvents("touchstart"));navigator.eventsToUnbind=eventsToUnbind;if(navigator.series&&navigator.series[0]){eventsToUnbind.push(addEvent(navigator.series[0].xAxis,"foundExtremes",function(){chart.navigator.modifyNavigatorAxisExtremes()}))}};Navigator.prototype.getPartsEvents=function(eventName){var navigator=this,events=[];["shades","handles"].forEach(function(name){navigator[name].forEach(function(navigatorItem,index){events.push(addEvent(navigatorItem.element,eventName,function(e){navigator[name+"Mousedown"](e,index)}))})});return events};Navigator.prototype.shadesMousedown=function(e,index){var _a;e=((_a=this.chart.pointer)===null||_a===void 0?void 0:_a.normalize(e))||e;var navigator=this,chart=navigator.chart,xAxis=navigator.xAxis,zoomedMin=navigator.zoomedMin,navigatorSize=navigator.size,range=navigator.range;var navigatorPosition=navigator.left,chartX=e.chartX,fixedMax,fixedMin,ext,left;if(chart.inverted){chartX=e.chartY;navigatorPosition=navigator.top}if(index===1){navigator.grabbedCenter=chartX;navigator.fixedWidth=range;navigator.dragOffset=chartX-zoomedMin}else{left=chartX-navigatorPosition-range/2;if(index===0){left=Math.max(0,left)}else if(index===2&&left+range>=navigatorSize){left=navigatorSize-range;if(navigator.reversedExtremes){left-=range;fixedMin=navigator.getUnionExtremes().dataMin}else{fixedMax=navigator.getUnionExtremes().dataMax}}if(left!==zoomedMin){navigator.fixedWidth=range;ext=xAxis.navigatorAxis.toFixedRange(left,left+range,fixedMin,fixedMax);if(defined(ext.min)){fireEvent(this,"setRange",{min:Math.min(ext.min,ext.max),max:Math.max(ext.min,ext.max),redraw:true,eventArguments:{trigger:"navigator"}})}}}};Navigator.prototype.handlesMousedown=function(e,index){var _a;e=((_a=this.chart.pointer)===null||_a===void 0?void 0:_a.normalize(e))||e;var navigator=this,chart=navigator.chart,baseXAxis=chart.xAxis[0],reverse=navigator.reversedExtremes;if(index===0){navigator.grabbedLeft=true;navigator.otherHandlePos=navigator.zoomedMax;navigator.fixedExtreme=reverse?baseXAxis.min:baseXAxis.max}else{navigator.grabbedRight=true;navigator.otherHandlePos=navigator.zoomedMin;navigator.fixedExtreme=reverse?baseXAxis.max:baseXAxis.min}chart.setFixedRange(void 0)};Navigator.prototype.onMouseMove=function(e){var _a;var navigator=this,chart=navigator.chart,navigatorSize=navigator.navigatorSize,range=navigator.range,dragOffset=navigator.dragOffset,inverted=chart.inverted;var left=navigator.left,chartX;if(!e.touches||e.touches[0].pageX!==0){e=((_a=chart.pointer)===null||_a===void 0?void 0:_a.normalize(e))||e;chartX=e.chartX;if(inverted){left=navigator.top;chartX=e.chartY}if(navigator.grabbedLeft){navigator.hasDragged=true;navigator.render(0,0,chartX-left,navigator.otherHandlePos)}else if(navigator.grabbedRight){navigator.hasDragged=true;navigator.render(0,0,navigator.otherHandlePos,chartX-left)}else if(navigator.grabbedCenter){navigator.hasDragged=true;if(chartX<dragOffset){chartX=dragOffset}else if(chartX>navigatorSize+dragOffset-range){chartX=navigatorSize+dragOffset-range}navigator.render(0,0,chartX-dragOffset,chartX-dragOffset+range)}if(navigator.hasDragged&&navigator.scrollbar&&pick(navigator.scrollbar.options.liveRedraw,!isTouchDevice&&!this.chart.boosted)){e.DOMType=e.type;setTimeout(function(){navigator.onMouseUp(e)},0)}}};Navigator.prototype.onMouseUp=function(e){var navigator=this,chart=navigator.chart,xAxis=navigator.xAxis,scrollbar=navigator.scrollbar,DOMEvent=e.DOMEvent||e,inverted=chart.inverted,verb=navigator.rendered&&!navigator.hasDragged?"animate":"attr";var zoomedMax,zoomedMin,unionExtremes,fixedMin,fixedMax,ext;if(navigator.hasDragged&&(!scrollbar||!scrollbar.hasDragged)||e.trigger==="scrollbar"){unionExtremes=navigator.getUnionExtremes();if(navigator.zoomedMin===navigator.otherHandlePos){fixedMin=navigator.fixedExtreme}else if(navigator.zoomedMax===navigator.otherHandlePos){fixedMax=navigator.fixedExtreme}if(navigator.zoomedMax===navigator.size){fixedMax=navigator.reversedExtremes?unionExtremes.dataMin:unionExtremes.dataMax}if(navigator.zoomedMin===0){fixedMin=navigator.reversedExtremes?unionExtremes.dataMax:unionExtremes.dataMin}ext=xAxis.navigatorAxis.toFixedRange(navigator.zoomedMin,navigator.zoomedMax,fixedMin,fixedMax);if(defined(ext.min)){fireEvent(this,"setRange",{min:Math.min(ext.min,ext.max),max:Math.max(ext.min,ext.max),redraw:true,animation:navigator.hasDragged?false:null,eventArguments:{trigger:"navigator",triggerOp:"navigator-drag",DOMEvent:DOMEvent}})}}if(e.DOMType!=="mousemove"&&e.DOMType!=="touchmove"){navigator.grabbedLeft=navigator.grabbedRight=navigator.grabbedCenter=navigator.fixedWidth=navigator.fixedExtreme=navigator.otherHandlePos=navigator.hasDragged=navigator.dragOffset=null}if(navigator.navigatorEnabled&&isNumber(navigator.zoomedMin)&&isNumber(navigator.zoomedMax)){zoomedMin=Math.round(navigator.zoomedMin);zoomedMax=Math.round(navigator.zoomedMax);if(navigator.shades){navigator.drawMasks(zoomedMin,zoomedMax,inverted,verb)}if(navigator.outline){navigator.drawOutline(zoomedMin,zoomedMax,inverted,verb)}if(navigator.navigatorOptions.handles.enabled&&Object.keys(navigator.handles).length===navigator.handles.length){navigator.drawHandle(zoomedMin,0,inverted,verb);navigator.drawHandle(zoomedMax,1,inverted,verb)}}};Navigator.prototype.removeEvents=function(){if(this.eventsToUnbind){this.eventsToUnbind.forEach(function(unbind){unbind()});this.eventsToUnbind=void 0}this.removeBaseSeriesEvents()};Navigator.prototype.removeBaseSeriesEvents=function(){var baseSeries=this.baseSeries||[];if(this.navigatorEnabled&&baseSeries[0]){if(this.navigatorOptions.adaptToUpdatedData!==false){baseSeries.forEach(function(series){removeEvent(series,"updatedData",this.updatedDataHandler)},this)}if(baseSeries[0].xAxis){removeEvent(baseSeries[0].xAxis,"foundExtremes",this.modifyBaseAxisExtremes)}}};Navigator.prototype.getXAxisOffsets=function(){return this.chart.inverted?[this.scrollButtonSize,0,-this.scrollButtonSize,0]:[0,-this.scrollButtonSize,0,this.scrollButtonSize]};Navigator.prototype.init=function(chart){var _a;var chartOptions=chart.options,navigatorOptions=chartOptions.navigator||{},navigatorEnabled=navigatorOptions.enabled,scrollbarOptions=chartOptions.scrollbar||{},scrollbarEnabled=scrollbarOptions.enabled,height=navigatorEnabled&&navigatorOptions.height||0,scrollbarHeight=scrollbarEnabled&&scrollbarOptions.height||0,scrollButtonSize=scrollbarOptions.buttonsEnabled&&scrollbarHeight||0;this.handles=[];this.shades=[];this.chart=chart;this.setBaseSeries();this.height=height;this.scrollbarHeight=scrollbarHeight;this.scrollButtonSize=scrollButtonSize;this.scrollbarEnabled=scrollbarEnabled;this.navigatorEnabled=navigatorEnabled;this.navigatorOptions=navigatorOptions;this.scrollbarOptions=scrollbarOptions;this.setOpposite();var navigator=this,baseSeries=navigator.baseSeries,xAxisIndex=chart.xAxis.length,yAxisIndex=chart.yAxis.length,baseXaxis=baseSeries&&baseSeries[0]&&baseSeries[0].xAxis||chart.xAxis[0]||{options:{}};chart.isDirtyBox=true;if(navigator.navigatorEnabled){var offsets=this.getXAxisOffsets();navigator.xAxis=new Axis(chart,merge({breaks:baseXaxis.options.breaks,ordinal:baseXaxis.options.ordinal,overscroll:baseXaxis.options.overscroll},navigatorOptions.xAxis,{type:"datetime",yAxis:(_a=navigatorOptions.yAxis)===null||_a===void 0?void 0:_a.id,index:xAxisIndex,isInternal:true,offset:0,keepOrdinalPadding:true,startOnTick:false,endOnTick:false,minPadding:baseXaxis.options.ordinal?0:baseXaxis.options.minPadding,maxPadding:baseXaxis.options.ordinal?0:baseXaxis.options.maxPadding,zoomEnabled:false},chart.inverted?{offsets:offsets,width:height}:{offsets:offsets,height:height}),"xAxis");navigator.yAxis=new Axis(chart,merge(navigatorOptions.yAxis,{alignTicks:false,offset:0,index:yAxisIndex,isInternal:true,reversed:pick(navigatorOptions.yAxis&&navigatorOptions.yAxis.reversed,chart.yAxis[0]&&chart.yAxis[0].reversed,false),zoomEnabled:false},chart.inverted?{width:height}:{height:height}),"yAxis");if(baseSeries||navigatorOptions.series.data){navigator.updateNavigatorSeries(false)}else if(chart.series.length===0){navigator.unbindRedraw=addEvent(chart,"beforeRedraw",function(){if(chart.series.length>0&&!navigator.series){navigator.setBaseSeries();navigator.unbindRedraw()}})}navigator.reversedExtremes=chart.inverted&&!navigator.xAxis.reversed||!chart.inverted&&navigator.xAxis.reversed;navigator.renderElements();navigator.addMouseEvents()}else{navigator.xAxis={chart:chart,navigatorAxis:{fake:true},translate:function(value,reverse){var axis=chart.xAxis[0],ext=axis.getExtremes(),scrollTrackWidth=axis.len-2*scrollButtonSize,min=numExt("min",axis.options.min,ext.dataMin),valueRange=numExt("max",axis.options.max,ext.dataMax)-min;return reverse?value*valueRange/scrollTrackWidth+min:scrollTrackWidth*(value-min)/valueRange},toPixels:function(value){return this.translate(value)},toValue:function(value){return this.translate(value,true)}};navigator.xAxis.navigatorAxis.axis=navigator.xAxis;navigator.xAxis.navigatorAxis.toFixedRange=NavigatorAxisAdditions.prototype.toFixedRange.bind(navigator.xAxis.navigatorAxis)}if(chart.options.scrollbar.enabled){var options=merge(chart.options.scrollbar,{vertical:chart.inverted});if(!isNumber(options.margin)&&navigator.navigatorEnabled){options.margin=chart.inverted?-3:3}chart.scrollbar=navigator.scrollbar=new Scrollbar(chart.renderer,options,chart);addEvent(navigator.scrollbar,"changed",function(e){var range=navigator.size,to=range*this.to,from=range*this.from;navigator.hasDragged=navigator.scrollbar.hasDragged;navigator.render(0,0,from,to);if(this.shouldUpdateExtremes(e.DOMType)){setTimeout(function(){navigator.onMouseUp(e)})}})}navigator.addBaseSeriesEvents();navigator.addChartEvents()};Navigator.prototype.setOpposite=function(){var navigatorOptions=this.navigatorOptions,navigatorEnabled=this.navigatorEnabled,chart=this.chart;this.opposite=pick(navigatorOptions.opposite,Boolean(!navigatorEnabled&&chart.inverted))};Navigator.prototype.getUnionExtremes=function(returnFalseOnNoBaseSeries){var baseAxis=this.chart.xAxis[0],time=this.chart.time,navAxis=this.xAxis,navAxisOptions=navAxis.options,baseAxisOptions=baseAxis.options;var ret;if(!returnFalseOnNoBaseSeries||baseAxis.dataMin!==null){ret={dataMin:pick(time.parse(navAxisOptions===null||navAxisOptions===void 0?void 0:navAxisOptions.min),numExt("min",time.parse(baseAxisOptions.min),baseAxis.dataMin,navAxis.dataMin,navAxis.min)),dataMax:pick(time.parse(navAxisOptions===null||navAxisOptions===void 0?void 0:navAxisOptions.max),numExt("max",time.parse(baseAxisOptions.max),baseAxis.dataMax,navAxis.dataMax,navAxis.max))}}return ret};Navigator.prototype.setBaseSeries=function(baseSeriesOptions,redraw){var chart=this.chart,baseSeries=this.baseSeries=[];baseSeriesOptions=baseSeriesOptions||chart.options&&chart.options.navigator.baseSeries||(chart.series.length?find(chart.series,function(s){return!s.options.isInternal}).index:0);(chart.series||[]).forEach(function(series,i){if(!series.options.isInternal&&(series.options.showInNavigator||(i===baseSeriesOptions||series.options.id===baseSeriesOptions)&&series.options.showInNavigator!==false)){baseSeries.push(series)}});if(this.xAxis&&!this.xAxis.navigatorAxis.fake){this.updateNavigatorSeries(true,redraw)}};Navigator.prototype.updateNavigatorSeries=function(addEvents,redraw){var _a,_b;var navigator=this,chart=navigator.chart,baseSeries=navigator.baseSeries,navSeriesMixin={enableMouseTracking:false,index:null,linkedTo:null,group:"nav",padXAxis:false,xAxis:(_a=this.navigatorOptions.xAxis)===null||_a===void 0?void 0:_a.id,yAxis:(_b=this.navigatorOptions.yAxis)===null||_b===void 0?void 0:_b.id,showInLegend:false,stacking:void 0,isInternal:true,states:{inactive:{opacity:1}}},navigatorSeries=navigator.series=(navigator.series||[]).filter(function(navSeries){var base=navSeries.baseSeries;if(baseSeries.indexOf(base)<0){if(base){removeEvent(base,"updatedData",navigator.updatedDataHandler);delete base.navigatorSeries}if(navSeries.chart){navSeries.destroy()}return false}return true});var baseOptions,mergedNavSeriesOptions,chartNavigatorSeriesOptions=navigator.navigatorOptions.series,baseNavigatorOptions;if(baseSeries&&baseSeries.length){baseSeries.forEach(function(base){var _a;var linkedNavSeries=base.navigatorSeries,userNavOptions=extend({color:base.color,visible:base.visible},!isArray(chartNavigatorSeriesOptions)?chartNavigatorSeriesOptions:defaultOptions.navigator.series);if(linkedNavSeries&&navigator.navigatorOptions.adaptToUpdatedData===false){return}navSeriesMixin.name="Navigator "+baseSeries.length;baseOptions=base.options||{};baseNavigatorOptions=baseOptions.navigatorOptions||{};userNavOptions.dataLabels=splat(userNavOptions.dataLabels);mergedNavSeriesOptions=merge(baseOptions,navSeriesMixin,userNavOptions,baseNavigatorOptions);mergedNavSeriesOptions.pointRange=pick(userNavOptions.pointRange,baseNavigatorOptions.pointRange,defaultOptions.plotOptions[mergedNavSeriesOptions.type||"line"].pointRange);var navigatorSeriesData=baseNavigatorOptions.data||userNavOptions.data;navigator.hasNavigatorData=navigator.hasNavigatorData||!!navigatorSeriesData;mergedNavSeriesOptions.data=navigatorSeriesData||((_a=baseOptions.data)===null||_a===void 0?void 0:_a.slice(0));if(linkedNavSeries&&linkedNavSeries.options){linkedNavSeries.update(mergedNavSeriesOptions,redraw)}else{base.navigatorSeries=chart.initSeries(mergedNavSeriesOptions);chart.setSortedData();base.navigatorSeries.baseSeries=base;navigatorSeries.push(base.navigatorSeries)}})}if(chartNavigatorSeriesOptions.data&&!(baseSeries&&baseSeries.length)||isArray(chartNavigatorSeriesOptions)){navigator.hasNavigatorData=false;chartNavigatorSeriesOptions=splat(chartNavigatorSeriesOptions);chartNavigatorSeriesOptions.forEach(function(userSeriesOptions,i){navSeriesMixin.name="Navigator "+(navigatorSeries.length+1);mergedNavSeriesOptions=merge(defaultOptions.navigator.series,{color:chart.series[i]&&!chart.series[i].options.isInternal&&chart.series[i].color||chart.options.colors[i]||chart.options.colors[0]},navSeriesMixin,userSeriesOptions);mergedNavSeriesOptions.data=userSeriesOptions.data;if(mergedNavSeriesOptions.data){navigator.hasNavigatorData=true;navigatorSeries.push(chart.initSeries(mergedNavSeriesOptions))}})}if(addEvents){this.addBaseSeriesEvents()}};Navigator.prototype.addBaseSeriesEvents=function(){var _this=this;var navigator=this,baseSeries=navigator.baseSeries||[];if(baseSeries[0]&&baseSeries[0].xAxis){baseSeries[0].eventsToUnbind.push(addEvent(baseSeries[0].xAxis,"foundExtremes",this.modifyBaseAxisExtremes))}baseSeries.forEach(function(base){base.eventsToUnbind.push(addEvent(base,"show",function(){if(this.navigatorSeries){this.navigatorSeries.setVisible(true,false)}}));base.eventsToUnbind.push(addEvent(base,"hide",function(){if(this.navigatorSeries){this.navigatorSeries.setVisible(false,false)}}));if(_this.navigatorOptions.adaptToUpdatedData!==false){if(base.xAxis){base.eventsToUnbind.push(addEvent(base,"updatedData",_this.updatedDataHandler))}}base.eventsToUnbind.push(addEvent(base,"remove",function(){if(baseSeries){erase(baseSeries,base)}if(this.navigatorSeries&&navigator.series){erase(navigator.series,this.navigatorSeries);if(defined(this.navigatorSeries.options)){this.navigatorSeries.remove(false)}delete this.navigatorSeries}}))})};Navigator.prototype.getBaseSeriesMin=function(currentSeriesMin){return this.baseSeries.reduce(function(min,series){var _a;return Math.min(min,(_a=series.getColumn("x")[0])!==null&&_a!==void 0?_a:min)},currentSeriesMin)};Navigator.prototype.modifyNavigatorAxisExtremes=function(){var xAxis=this.xAxis;if(typeof xAxis.getExtremes!=="undefined"){var unionExtremes=this.getUnionExtremes(true);if(unionExtremes&&(unionExtremes.dataMin!==xAxis.min||unionExtremes.dataMax!==xAxis.max)){xAxis.min=unionExtremes.dataMin;xAxis.max=unionExtremes.dataMax}}};Navigator.prototype.modifyBaseAxisExtremes=function(){var _a;var baseXAxis=this,navigator=baseXAxis.chart.navigator,baseExtremes=baseXAxis.getExtremes(),baseMin=baseExtremes.min,baseMax=baseExtremes.max,baseDataMin=baseExtremes.dataMin,baseDataMax=baseExtremes.dataMax,range=baseMax-baseMin,stickToMin=navigator.stickToMin,stickToMax=navigator.stickToMax,overscroll=pick((_a=baseXAxis.ordinal)===null||_a===void 0?void 0:_a.convertOverscroll(baseXAxis.options.overscroll),0),navigatorSeries=navigator.series&&navigator.series[0],hasSetExtremes=!!baseXAxis.setExtremes,unmutable=baseXAxis.eventArgs&&baseXAxis.eventArgs.trigger==="rangeSelectorButton";var newMax,newMin;if(!unmutable){if(stickToMin){newMin=baseDataMin;newMax=newMin+range}if(stickToMax){newMax=baseDataMax+overscroll;if(!stickToMin){newMin=Math.max(baseDataMin,newMax-range,navigator.getBaseSeriesMin(navigatorSeries&&navigatorSeries.xData?navigatorSeries.xData[0]:-Number.MAX_VALUE))}}if(hasSetExtremes&&(stickToMin||stickToMax)){if(isNumber(newMin)){baseXAxis.min=baseXAxis.userMin=newMin;baseXAxis.max=baseXAxis.userMax=newMax}}}navigator.stickToMin=navigator.stickToMax=null};Navigator.prototype.updatedDataHandler=function(){var navigator=this.chart.navigator,baseSeries=this,navigatorSeries=this.navigatorSeries,shouldStickToMax=navigator.reversedExtremes?Math.round(navigator.zoomedMin)===0:Math.round(navigator.zoomedMax)>=Math.round(navigator.size);navigator.stickToMax=pick(this.chart.options.navigator&&this.chart.options.navigator.stickToMax,shouldStickToMax);navigator.stickToMin=navigator.shouldStickToMin(baseSeries,navigator);if(navigatorSeries&&!navigator.hasNavigatorData){navigatorSeries.options.pointStart=baseSeries.getColumn("x")[0];navigatorSeries.setData(baseSeries.options.data,false,null,false)}};Navigator.prototype.shouldStickToMin=function(baseSeries,navigator){var xDataMin=navigator.getBaseSeriesMin(baseSeries.getColumn("x")[0]),xAxis=baseSeries.xAxis,max=xAxis.max,min=xAxis.min,range=xAxis.options.range;var stickToMin=true;if(isNumber(max)&&isNumber(min)){if(range&&max-xDataMin>0){stickToMin=max-xDataMin<range}else{stickToMin=min<=xDataMin}}else{stickToMin=false}return stickToMin};Navigator.prototype.addChartEvents=function(){if(!this.eventsToUnbind){this.eventsToUnbind=[]}this.eventsToUnbind.push(addEvent(this.chart,"redraw",function(){var navigator=this.navigator,xAxis=navigator&&(navigator.baseSeries&&navigator.baseSeries[0]&&navigator.baseSeries[0].xAxis||this.xAxis[0]);if(xAxis){navigator.render(xAxis.min,xAxis.max)}}),addEvent(this.chart,"getMargins",function(){var chart=this,navigator=chart.navigator;var marginName=navigator.opposite?"plotTop":"marginBottom";if(chart.inverted){marginName=navigator.opposite?"marginRight":"plotLeft"}chart[marginName]=(chart[marginName]||0)+(navigator.navigatorEnabled||!chart.inverted?navigator.height+navigator.scrollbarHeight:0)+navigator.navigatorOptions.margin}),addEvent(Navigator,"setRange",function(e){this.chart.xAxis[0].setExtremes(e.min,e.max,e.redraw,e.animation,e.eventArguments)}))};Navigator.prototype.destroy=function(){var _this=this;this.removeEvents();if(this.xAxis){erase(this.chart.xAxis,this.xAxis);erase(this.chart.axes,this.xAxis)}if(this.yAxis){erase(this.chart.yAxis,this.yAxis);erase(this.chart.axes,this.yAxis)}(this.series||[]).forEach(function(s){if(s.destroy){s.destroy()}});["series","xAxis","yAxis","shades","outline","scrollbarTrack","scrollbarRifles","scrollbarGroup","scrollbar","navigatorGroup","rendered"].forEach(function(prop){if(_this[prop]&&_this[prop].destroy){_this[prop].destroy()}_this[prop]=null});[this.handles].forEach(function(coll){destroyObjectProperties(coll)});this.navigatorEnabled=false};return Navigator}();export default Navigator;