"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();import SeriesRegistry from"../../../Core/Series/SeriesRegistry.js";var SMAIndicator=SeriesRegistry.seriesTypes.sma;import U from"../../../Core/Utilities.js";var merge=U.merge;function toFixed(a,n){return parseFloat(a.toFixed(n))}function calculateDirection(previousDirection,low,high,PSAR){if(previousDirection===1&&low>PSAR||previousDirection===-1&&high>PSAR){return 1}return-1}function getAccelerationFactor(dir,pDir,eP,pEP,pAcc,inc,maxAcc,initAcc){if(dir===pDir){if(dir===1&&eP>pEP){return pAcc===maxAcc?maxAcc:toFixed(pAcc+inc,2)}if(dir===-1&&eP<pEP){return pAcc===maxAcc?maxAcc:toFixed(pAcc+inc,2)}return pAcc}return initAcc}function getExtremePoint(high,low,previousDirection,previousExtremePoint){if(previousDirection===1){return high>previousExtremePoint?high:previousExtremePoint}return low<previousExtremePoint?low:previousExtremePoint}function getEPMinusPSAR(EP,PSAR){return EP-PSAR}function getAccelerationFactorMultiply(accelerationFactor,EPMinusSAR){return accelerationFactor*EPMinusSAR}function getPSAR(pdir,sDir,PSAR,pACCMulti,sLow,pLow,pHigh,sHigh,pEP){if(pdir===sDir){if(pdir===1){return PSAR+pACCMulti<Math.min(sLow,pLow)?PSAR+pACCMulti:Math.min(sLow,pLow)}return PSAR+pACCMulti>Math.max(sHigh,pHigh)?PSAR+pACCMulti:Math.max(sHigh,pHigh)}return pEP}var PSARIndicator=function(_super){__extends(PSARIndicator,_super);function PSARIndicator(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.nameComponents=void 0;return _this}PSARIndicator.prototype.getValues=function(series,params){var xVal=series.xData,yVal=series.yData,maxAccelerationFactor=params.maxAccelerationFactor,increment=params.increment,initialAccelerationFactor=params.initialAccelerationFactor,decimals=params.decimals,index=params.index,PSARArr=[],xData=[],yData=[];var accelerationFactor=params.initialAccelerationFactor,direction,extremePoint=yVal[0][1],EPMinusPSAR,accelerationFactorMultiply,newDirection,previousDirection=1,prevLow,prevPrevLow,prevHigh,prevPrevHigh,PSAR=yVal[0][2],newExtremePoint,high,low,ind;if(index>=yVal.length){return}for(ind=0;ind<index;ind++){extremePoint=Math.max(yVal[ind][1],extremePoint);PSAR=Math.min(yVal[ind][2],toFixed(PSAR,decimals))}direction=yVal[ind][1]>PSAR?1:-1;EPMinusPSAR=getEPMinusPSAR(extremePoint,PSAR);accelerationFactor=params.initialAccelerationFactor;accelerationFactorMultiply=getAccelerationFactorMultiply(accelerationFactor,EPMinusPSAR);PSARArr.push([xVal[index],PSAR]);xData.push(xVal[index]);yData.push(toFixed(PSAR,decimals));for(ind=index+1;ind<yVal.length;ind++){prevLow=yVal[ind-1][2];prevPrevLow=yVal[ind-2][2];prevHigh=yVal[ind-1][1];prevPrevHigh=yVal[ind-2][1];high=yVal[ind][1];low=yVal[ind][2];if(prevPrevLow!==null&&prevPrevHigh!==null&&prevLow!==null&&prevHigh!==null&&high!==null&&low!==null){PSAR=getPSAR(direction,previousDirection,PSAR,accelerationFactorMultiply,prevPrevLow,prevLow,prevHigh,prevPrevHigh,extremePoint);newExtremePoint=getExtremePoint(high,low,direction,extremePoint);newDirection=calculateDirection(previousDirection,low,high,PSAR);accelerationFactor=getAccelerationFactor(newDirection,direction,newExtremePoint,extremePoint,accelerationFactor,increment,maxAccelerationFactor,initialAccelerationFactor);EPMinusPSAR=getEPMinusPSAR(newExtremePoint,PSAR);accelerationFactorMultiply=getAccelerationFactorMultiply(accelerationFactor,EPMinusPSAR);PSARArr.push([xVal[ind],toFixed(PSAR,decimals)]);xData.push(xVal[ind]);yData.push(toFixed(PSAR,decimals));previousDirection=direction;direction=newDirection;extremePoint=newExtremePoint}}return{values:PSARArr,xData:xData,yData:yData}};PSARIndicator.defaultOptions=merge(SMAIndicator.defaultOptions,{lineWidth:0,marker:{enabled:true},states:{hover:{lineWidthPlus:0}},params:{period:void 0,initialAccelerationFactor:.02,maxAccelerationFactor:.2,increment:.02,index:2,decimals:4}});return PSARIndicator}(SMAIndicator);SeriesRegistry.registerSeriesType("psar",PSARIndicator);export default PSARIndicator;"";