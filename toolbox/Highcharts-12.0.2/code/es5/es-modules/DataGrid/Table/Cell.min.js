"use strict";import AST from"../../Core/Renderer/HTML/AST.js";import Templating from"../../Core/Templating.js";var Cell=function(){function Cell(column,row){this.cellEvents=[];this.column=column;this.row=row;this.row.registerCell(this);this.htmlElement=this.init();this.htmlElement.setAttribute("tabindex","-1");this.initEvents()}Cell.prototype.init=function(){return document.createElement("td",{})};Cell.prototype.initEvents=function(){var _this=this;this.cellEvents.push(["blur",function(){return _this.onBlur()}]);this.cellEvents.push(["focus",function(){return _this.onFocus()}]);this.cellEvents.push(["click",function(e){_this.onClick(e)}]);this.cellEvents.push(["keydown",function(e){_this.onKeyDown(e)}]);this.cellEvents.forEach(function(pair){_this.htmlElement.addEventListener(pair[0],pair[1])})};Cell.prototype.onFocus=function(){var _a;var vp=this.row.viewport;var focusAnchor=(_a=vp.rowsVirtualizer.focusAnchorCell)===null||_a===void 0?void 0:_a.htmlElement;focusAnchor===null||focusAnchor===void 0?void 0:focusAnchor.setAttribute("tabindex","-1")};Cell.prototype.onBlur=function(){var _a;var vp=this.row.viewport;var focusAnchor=(_a=vp.rowsVirtualizer.focusAnchorCell)===null||_a===void 0?void 0:_a.htmlElement;focusAnchor===null||focusAnchor===void 0?void 0:focusAnchor.setAttribute("tabindex","0");delete vp.focusCursor};Cell.prototype.onKeyDown=function(e){var _a,_b,_c;var _d=this,row=_d.row,column=_d.column;var vp=row.viewport;var changeFocusKeys={ArrowDown:[1,0],ArrowUp:[-1,0],ArrowLeft:[0,-1],ArrowRight:[0,1]};var dir=changeFocusKeys[e.key];if(dir){e.preventDefault();e.stopPropagation();var localRowIndex=row.index===void 0?-1:row.index-vp.rows[0].index;var nextVerticalDir=localRowIndex+dir[0];if(nextVerticalDir<0&&vp.header){(_b=(_a=vp.columns[column.index+dir[1]])===null||_a===void 0?void 0:_a.header)===null||_b===void 0?void 0:_b.htmlElement.focus();return}var nextRow=vp.rows[nextVerticalDir];if(nextRow){(_c=nextRow.cells[column.index+dir[1]])===null||_c===void 0?void 0:_c.htmlElement.focus()}}};Cell.prototype.render=function(){this.row.htmlElement.appendChild(this.htmlElement)};Cell.prototype.reflow=function(){var column=this.column;var elementStyle=this.htmlElement.style;elementStyle.width=elementStyle.maxWidth=column.getWidth()+"px"};Cell.prototype.format=function(template){return Templating.format(template,this)};Cell.prototype.setCustomClassName=function(template){var _a,_b;var element=this.htmlElement;if(this.customClassName){(_a=element.classList).remove.apply(_a,this.customClassName.split(/\s+/g))}if(!template){delete this.customClassName;return}var newClassName=this.format(template);if(!newClassName){delete this.customClassName;return}(_b=element.classList).add.apply(_b,newClassName.split(/\s+/g));this.customClassName=newClassName};Cell.prototype.renderHTMLCellContent=function(cellContent,parentElement){var formattedNodes=new AST(cellContent);formattedNodes.addToDOM(parentElement)};Cell.prototype.destroy=function(){var _this=this;this.cellEvents.forEach(function(pair){_this.htmlElement.removeEventListener(pair[0],pair[1])});this.column.unregisterCell(this);this.row.unregisterCell(this);this.htmlElement.remove()};return Cell}();export default Cell;