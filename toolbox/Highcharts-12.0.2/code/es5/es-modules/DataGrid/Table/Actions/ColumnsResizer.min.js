"use strict";import Column from"../Column.js";import Globals from"../../Globals.js";import DGUtils from"../../Utils.js";var makeHTMLElement=DGUtils.makeHTMLElement;var ColumnsResizer=function(){function ColumnsResizer(viewport){var _this=this;this.handles=[];this.onDocumentMouseMove=function(e){var _a,_b,_c,_d;if(!_this.draggedResizeHandle||!_this.draggedColumn){return}var diff=e.pageX-(_this.dragStartX||0);if(_this.viewport.columnDistribution==="full"){_this.fullDistributionResize(diff)}else{_this.fixedDistributionResize(diff)}_this.viewport.reflow();_this.viewport.rowsVirtualizer.adjustRowHeights();(_d=(_c=(_b=(_a=_this.viewport.dataGrid.options)===null||_a===void 0?void 0:_a.events)===null||_b===void 0?void 0:_b.column)===null||_c===void 0?void 0:_c.afterResize)===null||_d===void 0?void 0:_d.call(_this.draggedColumn)};this.onDocumentMouseUp=function(){var _a,_b,_c;(_c=(_b=(_a=_this.draggedColumn)===null||_a===void 0?void 0:_a.header)===null||_b===void 0?void 0:_b.htmlElement)===null||_c===void 0?void 0:_c.classList.remove(Globals.classNames.resizedColumn);_this.dragStartX=void 0;_this.draggedColumn=void 0;_this.draggedResizeHandle=void 0;_this.columnStartWidth=void 0;_this.nextColumnStartWidth=void 0};this.viewport=viewport;document.addEventListener("mousemove",this.onDocumentMouseMove);document.addEventListener("mouseup",this.onDocumentMouseUp)}ColumnsResizer.prototype.fullDistributionResize=function(diff){var _a,_b;var vp=this.viewport;var column=this.draggedColumn;if(!column){return}var nextColumn=vp.columns[column.index+1];if(!nextColumn){return}var leftColW=(_a=this.columnStartWidth)!==null&&_a!==void 0?_a:0;var rightColW=(_b=this.nextColumnStartWidth)!==null&&_b!==void 0?_b:0;var MIN_WIDTH=Column.MIN_COLUMN_WIDTH;var newLeftW=leftColW+diff;var newRightW=rightColW-diff;if(newLeftW<MIN_WIDTH){newLeftW=MIN_WIDTH;newRightW=leftColW+rightColW-MIN_WIDTH}if(newRightW<MIN_WIDTH){newRightW=MIN_WIDTH;newLeftW=leftColW+rightColW-MIN_WIDTH}column.width=vp.getRatioFromWidth(newLeftW);nextColumn.width=vp.getRatioFromWidth(newRightW)};ColumnsResizer.prototype.renderColumnDragHandles=function(column,cell){var _a;var vp=column.viewport;if(vp.columnsResizer&&(vp.columnDistribution!=="full"||vp.dataGrid.enabledColumns&&column.index<vp.dataGrid.enabledColumns.length-1)){var handle=makeHTMLElement("div",{className:Globals.classNames.resizerHandles},cell.htmlElement);handle.setAttribute("aria-hidden",true);(_a=vp.columnsResizer)===null||_a===void 0?void 0:_a.addHandleListeners(handle,column)}};ColumnsResizer.prototype.fixedDistributionResize=function(diff){var _a;var column=this.draggedColumn;if(!column){return}var colW=(_a=this.columnStartWidth)!==null&&_a!==void 0?_a:0;var MIN_WIDTH=Column.MIN_COLUMN_WIDTH;var newW=colW+diff;if(newW<MIN_WIDTH){newW=MIN_WIDTH}column.width=newW};ColumnsResizer.prototype.addHandleListeners=function(handle,column){var _this=this;var onHandleMouseDown=function(e){var _a,_b;_this.dragStartX=e.pageX;_this.draggedColumn=column;_this.draggedResizeHandle=handle;_this.columnStartWidth=column.getWidth();_this.nextColumnStartWidth=(_a=_this.viewport.columns[column.index+1])===null||_a===void 0?void 0:_a.getWidth();(_b=column.header)===null||_b===void 0?void 0:_b.htmlElement.classList.add(Globals.classNames.resizedColumn)};this.handles.push([handle,onHandleMouseDown]);handle.addEventListener("mousedown",onHandleMouseDown)};ColumnsResizer.prototype.removeEventListeners=function(){document.removeEventListener("mousemove",this.onDocumentMouseMove);document.removeEventListener("mouseup",this.onDocumentMouseUp);for(var i=0,iEnd=this.handles.length;i<iEnd;i++){var _a=this.handles[i],handle=_a[0],listener=_a[1];handle.removeEventListener("mousedown",listener)}};return ColumnsResizer}();export default ColumnsResizer;