"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();import DataTableCore from"./DataTableCore.js";import U from"../Core/Utilities.js";var addEvent=U.addEvent,defined=U.defined,fireEvent=U.fireEvent,extend=U.extend,uniqueKey=U.uniqueKey;var DataTable=function(_super){__extends(DataTable,_super);function DataTable(options){if(options===void 0){options={}}var _this=_super.call(this,options)||this;_this.modified=_this;return _this}DataTable.isNull=function(row){if(row===DataTable.NULL){return true}if(row instanceof Array){if(!row.length){return false}for(var i=0,iEnd=row.length;i<iEnd;++i){if(row[i]!==null){return false}}}else{var columnNames=Object.keys(row);if(!columnNames.length){return false}for(var i=0,iEnd=columnNames.length;i<iEnd;++i){if(row[columnNames[i]]!==null){return false}}}return true};DataTable.prototype.clone=function(skipColumns,eventDetail){var table=this,tableOptions={};table.emit({type:"cloneTable",detail:eventDetail});if(!skipColumns){tableOptions.columns=table.columns}if(!table.autoId){tableOptions.id=table.id}var tableClone=new DataTable(tableOptions);if(!skipColumns){tableClone.versionTag=table.versionTag;tableClone.originalRowIndexes=table.originalRowIndexes;tableClone.localRowIndexes=table.localRowIndexes}table.emit({type:"afterCloneTable",detail:eventDetail,tableClone:tableClone});return tableClone};DataTable.prototype.deleteColumns=function(columnNames,eventDetail){var table=this,columns=table.columns,deletedColumns={},modifiedColumns={},modifier=table.modifier,rowCount=table.rowCount;columnNames=columnNames||Object.keys(columns);if(columnNames.length){table.emit({type:"deleteColumns",columnNames:columnNames,detail:eventDetail});for(var i=0,iEnd=columnNames.length,column=void 0,columnName=void 0;i<iEnd;++i){columnName=columnNames[i];column=columns[columnName];if(column){deletedColumns[columnName]=column;modifiedColumns[columnName]=new Array(rowCount)}delete columns[columnName]}if(!Object.keys(columns).length){table.rowCount=0;this.deleteRowIndexReferences()}if(modifier){modifier.modifyColumns(table,modifiedColumns,0,eventDetail)}table.emit({type:"afterDeleteColumns",columns:deletedColumns,columnNames:columnNames,detail:eventDetail});return deletedColumns}};DataTable.prototype.deleteRowIndexReferences=function(){delete this.originalRowIndexes;delete this.localRowIndexes};DataTable.prototype.deleteRows=function(rowIndex,rowCount,eventDetail){if(rowCount===void 0){rowCount=1}var table=this,deletedRows=[],modifiedRows=[],modifier=table.modifier;table.emit({type:"deleteRows",detail:eventDetail,rowCount:rowCount,rowIndex:rowIndex||0});if(typeof rowIndex==="undefined"){rowIndex=0;rowCount=table.rowCount}if(rowCount>0&&rowIndex<table.rowCount){var columns=table.columns,columnNames=Object.keys(columns);for(var i=0,iEnd=columnNames.length,column=void 0,deletedCells=void 0;i<iEnd;++i){column=columns[columnNames[i]];deletedCells=column.splice(rowIndex,rowCount);if(!i){table.rowCount=column.length}for(var j=0,jEnd=deletedCells.length;j<jEnd;++j){deletedRows[j]=deletedRows[j]||[];deletedRows[j][i]=deletedCells[j]}modifiedRows.push(new Array(iEnd))}}if(modifier){modifier.modifyRows(table,modifiedRows,rowIndex||0,eventDetail)}table.emit({type:"afterDeleteRows",detail:eventDetail,rowCount:rowCount,rowIndex:rowIndex||0,rows:deletedRows});return deletedRows};DataTable.prototype.emit=function(e){if(["afterDeleteColumns","afterDeleteRows","afterSetCell","afterSetColumns","afterSetRows"].includes(e.type)){this.versionTag=uniqueKey()}fireEvent(this,e.type,e)};DataTable.prototype.getCell=function(columnName,rowIndex){var table=this;var column=table.columns[columnName];if(column){return column[rowIndex]}};DataTable.prototype.getCellAsBoolean=function(columnName,rowIndex){var table=this;var column=table.columns[columnName];return!!(column&&column[rowIndex])};DataTable.prototype.getCellAsNumber=function(columnName,rowIndex,useNaN){var table=this;var column=table.columns[columnName];var cellValue=column&&column[rowIndex];switch(typeof cellValue){case"boolean":return cellValue?1:0;case"number":return isNaN(cellValue)&&!useNaN?null:cellValue}cellValue=parseFloat("".concat(cellValue!==null&&cellValue!==void 0?cellValue:""));return isNaN(cellValue)&&!useNaN?null:cellValue};DataTable.prototype.getCellAsString=function(columnName,rowIndex){var table=this;var column=table.columns[columnName];return"".concat(column&&column[rowIndex])};DataTable.prototype.getColumn=function(columnName,asReference){return this.getColumns([columnName],asReference)[columnName]};DataTable.prototype.getColumnAsNumbers=function(columnName,useNaN){var table=this,columns=table.columns;var column=columns[columnName],columnAsNumber=[];if(column){var columnLength=column.length;if(useNaN){for(var i=0;i<columnLength;++i){columnAsNumber.push(table.getCellAsNumber(columnName,i,true))}}else{for(var i=0,cellValue=void 0;i<columnLength;++i){cellValue=column[i];if(typeof cellValue==="number"){return column.slice()}if(cellValue!==null&&typeof cellValue!=="undefined"){break}}for(var i=0;i<columnLength;++i){columnAsNumber.push(table.getCellAsNumber(columnName,i))}}}return columnAsNumber};DataTable.prototype.getColumnNames=function(){var table=this,columnNames=Object.keys(table.columns);return columnNames};DataTable.prototype.getColumns=function(columnNames,asReference){var table=this,tableColumns=table.columns,columns={};columnNames=columnNames||Object.keys(tableColumns);for(var i=0,iEnd=columnNames.length,column=void 0,columnName=void 0;i<iEnd;++i){columnName=columnNames[i];column=tableColumns[columnName];if(column){columns[columnName]=asReference?column:column.slice()}}return columns};DataTable.prototype.getLocalRowIndex=function(originalRowIndex){var localRowIndexes=this.localRowIndexes;if(localRowIndexes){return localRowIndexes[originalRowIndex]}return originalRowIndex};DataTable.prototype.getModifier=function(){return this.modifier};DataTable.prototype.getOriginalRowIndex=function(rowIndex){var originalRowIndexes=this.originalRowIndexes;if(originalRowIndexes){return originalRowIndexes[rowIndex]}return rowIndex};DataTable.prototype.getRow=function(rowIndex,columnNames){return this.getRows(rowIndex,1,columnNames)[0]};DataTable.prototype.getRowCount=function(){return this.rowCount};DataTable.prototype.getRowIndexBy=function(columnName,cellValue,rowIndexOffset){var table=this;var column=table.columns[columnName];if(column){var rowIndex=column.indexOf(cellValue,rowIndexOffset);if(rowIndex!==-1){return rowIndex}}};DataTable.prototype.getRowObject=function(rowIndex,columnNames){return this.getRowObjects(rowIndex,1,columnNames)[0]};DataTable.prototype.getRowObjects=function(rowIndex,rowCount,columnNames){if(rowIndex===void 0){rowIndex=0}if(rowCount===void 0){rowCount=this.rowCount-rowIndex}var table=this,columns=table.columns,rows=new Array(rowCount);columnNames=columnNames||Object.keys(columns);for(var i=rowIndex,i2=0,iEnd=Math.min(table.rowCount,rowIndex+rowCount),column=void 0,row=void 0;i<iEnd;++i,++i2){row=rows[i2]={};for(var _i=0,columnNames_1=columnNames;_i<columnNames_1.length;_i++){var columnName=columnNames_1[_i];column=columns[columnName];row[columnName]=column?column[i]:void 0}}return rows};DataTable.prototype.getRows=function(rowIndex,rowCount,columnNames){if(rowIndex===void 0){rowIndex=0}if(rowCount===void 0){rowCount=this.rowCount-rowIndex}var table=this,columns=table.columns,rows=new Array(rowCount);columnNames=columnNames||Object.keys(columns);for(var i=rowIndex,i2=0,iEnd=Math.min(table.rowCount,rowIndex+rowCount),column=void 0,row=void 0;i<iEnd;++i,++i2){row=rows[i2]=[];for(var _i=0,columnNames_2=columnNames;_i<columnNames_2.length;_i++){var columnName=columnNames_2[_i];column=columns[columnName];row.push(column?column[i]:void 0)}}return rows};DataTable.prototype.getVersionTag=function(){return this.versionTag};DataTable.prototype.hasColumns=function(columnNames){var table=this,columns=table.columns;for(var i=0,iEnd=columnNames.length,columnName=void 0;i<iEnd;++i){columnName=columnNames[i];if(!columns[columnName]){return false}}return true};DataTable.prototype.hasRowWith=function(columnName,cellValue){var table=this;var column=table.columns[columnName];if(column){return column.indexOf(cellValue)!==-1}return false};DataTable.prototype.on=function(type,callback){return addEvent(this,type,callback)};DataTable.prototype.renameColumn=function(columnName,newColumnName){var table=this,columns=table.columns;if(columns[columnName]){if(columnName!==newColumnName){columns[newColumnName]=columns[columnName];delete columns[columnName]}return true}return false};DataTable.prototype.setCell=function(columnName,rowIndex,cellValue,eventDetail){var table=this,columns=table.columns,modifier=table.modifier;var column=columns[columnName];if(column&&column[rowIndex]===cellValue){return}table.emit({type:"setCell",cellValue:cellValue,columnName:columnName,detail:eventDetail,rowIndex:rowIndex});if(!column){column=columns[columnName]=new Array(table.rowCount)}if(rowIndex>=table.rowCount){table.rowCount=rowIndex+1}column[rowIndex]=cellValue;if(modifier){modifier.modifyCell(table,columnName,rowIndex,cellValue)}table.emit({type:"afterSetCell",cellValue:cellValue,columnName:columnName,detail:eventDetail,rowIndex:rowIndex})};DataTable.prototype.setColumns=function(columns,rowIndex,eventDetail){var table=this,tableColumns=table.columns,tableModifier=table.modifier,columnNames=Object.keys(columns);var rowCount=table.rowCount;table.emit({type:"setColumns",columns:columns,columnNames:columnNames,detail:eventDetail,rowIndex:rowIndex});if(typeof rowIndex==="undefined"){_super.prototype.setColumns.call(this,columns,rowIndex,extend(eventDetail,{silent:true}))}else{for(var i=0,iEnd=columnNames.length,column=void 0,columnName=void 0;i<iEnd;++i){columnName=columnNames[i];column=columns[columnName];var tableColumn=tableColumns[columnName]?tableColumns[columnName]:tableColumns[columnName]=new Array(table.rowCount);for(var i_1=rowIndex||0,iEnd_1=column.length;i_1<iEnd_1;++i_1){tableColumn[i_1]=column[i_1]}rowCount=Math.max(rowCount,tableColumn.length)}this.applyRowCount(rowCount)}if(tableModifier){tableModifier.modifyColumns(table,columns,rowIndex||0)}table.emit({type:"afterSetColumns",columns:columns,columnNames:columnNames,detail:eventDetail,rowIndex:rowIndex})};DataTable.prototype.setModifier=function(modifier,eventDetail){var table=this;var promise;table.emit({type:"setModifier",detail:eventDetail,modifier:modifier,modified:table.modified});table.modified=table;table.modifier=modifier;if(modifier){promise=modifier.modify(table)}else{promise=Promise.resolve(table)}return promise.then(function(table){table.emit({type:"afterSetModifier",detail:eventDetail,modifier:modifier,modified:table.modified});return table})["catch"](function(error){table.emit({type:"setModifierError",error:error,modifier:modifier,modified:table.modified});throw error})};DataTable.prototype.setOriginalRowIndexes=function(originalRowIndexes,omitLocalRowIndexes){if(omitLocalRowIndexes===void 0){omitLocalRowIndexes=false}this.originalRowIndexes=originalRowIndexes;if(omitLocalRowIndexes){return}var modifiedIndexes=this.localRowIndexes=[];for(var i=0,iEnd=originalRowIndexes.length,originalIndex=void 0;i<iEnd;++i){originalIndex=originalRowIndexes[i];if(defined(originalIndex)){modifiedIndexes[originalIndex]=i}}};DataTable.prototype.setRow=function(row,rowIndex,insert,eventDetail){this.setRows([row],rowIndex,insert,eventDetail)};DataTable.prototype.setRows=function(rows,rowIndex,insert,eventDetail){if(rowIndex===void 0){rowIndex=this.rowCount}var table=this,columns=table.columns,columnNames=Object.keys(columns),modifier=table.modifier,rowCount=rows.length;table.emit({type:"setRows",detail:eventDetail,rowCount:rowCount,rowIndex:rowIndex,rows:rows});for(var i=0,i2=rowIndex,row=void 0;i<rowCount;++i,++i2){row=rows[i];if(row===DataTable.NULL){for(var j=0,jEnd=columnNames.length;j<jEnd;++j){if(insert){columns[columnNames[j]].splice(i2,0,null)}else{columns[columnNames[j]][i2]=null}}}else if(row instanceof Array){for(var j=0,jEnd=columnNames.length;j<jEnd;++j){columns[columnNames[j]][i2]=row[j]}}else{_super.prototype.setRow.call(this,row,i2,void 0,{silent:true})}}var indexRowCount=insert?rowCount+rows.length:rowIndex+rowCount;if(indexRowCount>table.rowCount){table.rowCount=indexRowCount;for(var i=0,iEnd=columnNames.length;i<iEnd;++i){columns[columnNames[i]].length=indexRowCount}}if(modifier){modifier.modifyRows(table,rows,rowIndex)}table.emit({type:"afterSetRows",detail:eventDetail,rowCount:rowCount,rowIndex:rowIndex,rows:rows})};DataTable.NULL={};DataTable.version="1.0.0";return DataTable}(DataTableCore);export default DataTable;