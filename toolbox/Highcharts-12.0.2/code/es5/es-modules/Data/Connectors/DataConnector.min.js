"use strict";import DataModifier from"../Modifiers/DataModifier.js";import DataTable from"../DataTable.js";import U from"../../Core/Utilities.js";var addEvent=U.addEvent,fireEvent=U.fireEvent,merge=U.merge,pick=U.pick;var DataConnector=function(){function DataConnector(options){if(options===void 0){options={}}this.table=new DataTable(options.dataTable);this.metadata=options.metadata||{columns:{}}}Object.defineProperty(DataConnector.prototype,"polling",{get:function(){return!!this.polling},enumerable:false,configurable:true});DataConnector.prototype.describeColumn=function(name,columnMeta){var connector=this,columns=connector.metadata.columns;columns[name]=merge(columns[name]||{},columnMeta)};DataConnector.prototype.describeColumns=function(columns){var connector=this,columnNames=Object.keys(columns);var columnName;while(typeof(columnName=columnNames.pop())==="string"){connector.describeColumn(columnName,columns[columnName])}};DataConnector.prototype.emit=function(e){fireEvent(this,e.type,e)};DataConnector.prototype.getColumnOrder=function(usePresentationState){var connector=this,columns=connector.metadata.columns,names=Object.keys(columns||{});if(names.length){return names.sort(function(a,b){return pick(columns[a].index,0)-pick(columns[b].index,0)})}};DataConnector.prototype.getSortedColumns=function(usePresentationOrder){return this.table.getColumns(this.getColumnOrder(usePresentationOrder))};DataConnector.prototype.load=function(){fireEvent(this,"afterLoad",{table:this.table});return Promise.resolve(this)};DataConnector.prototype.on=function(type,callback){return addEvent(this,type,callback)};DataConnector.prototype.save=function(){fireEvent(this,"saveError",{table:this.table});return Promise.reject(new Error("Not implemented"))};DataConnector.prototype.setColumnOrder=function(columnNames){var connector=this;for(var i=0,iEnd=columnNames.length;i<iEnd;++i){connector.describeColumn(columnNames[i],{index:i})}};DataConnector.prototype.setModifierOptions=function(modifierOptions){var _this=this;var ModifierClass=modifierOptions&&DataModifier.types[modifierOptions.type];return this.table.setModifier(ModifierClass?new ModifierClass(modifierOptions):void 0).then(function(){return _this})};DataConnector.prototype.startPolling=function(refreshTime){if(refreshTime===void 0){refreshTime=1e3}var connector=this;window.clearTimeout(connector._polling);connector._polling=window.setTimeout(function(){return connector.load()["catch"](function(error){return connector.emit({type:"loadError",error:error,table:connector.table})}).then(function(){if(connector._polling){connector.startPolling(refreshTime)}})},refreshTime)};DataConnector.prototype.stopPolling=function(){var connector=this;window.clearTimeout(connector._polling);delete connector._polling};DataConnector.prototype.whatIs=function(name){return this.metadata.columns[name]};return DataConnector}();(function(DataConnector){DataConnector.types={};function registerType(key,DataConnectorClass){return!!key&&!DataConnector.types[key]&&!!(DataConnector.types[key]=DataConnectorClass)}DataConnector.registerType=registerType})(DataConnector||(DataConnector={}));export default DataConnector;