"use strict";import A from"../../Core/Animation/AnimationUtilities.js";var animObject=A.animObject;import U from"../../Core/Utilities.js";var addEvent=U.addEvent,extend=U.extend,fireEvent=U.fireEvent,merge=U.merge,pick=U.pick,syncTimeout=U.syncTimeout;function applyCursorCSS(element,cursor,addClass,styledMode){element[addClass?"addClass":"removeClass"]("highcharts-drilldown-point");if(!styledMode){element.css({cursor:cursor})}}function columnAnimateDrilldown(init){var series=this,chart=series.chart,drilldownLevels=chart.drilldownLevels,animationOptions=animObject((chart.options.drilldown||{}).animation),xAxis=this.xAxis,styledMode=chart.styledMode;if(!init){var animateFrom_1;(drilldownLevels||[]).forEach(function(level){if(series.options._ddSeriesId===level.lowerSeriesOptions._ddSeriesId){animateFrom_1=level.shapeArgs;if(!styledMode&&animateFrom_1){animateFrom_1.fill=level.color}}});animateFrom_1.x+=pick(xAxis.oldPos,xAxis.pos)-xAxis.pos;series.points.forEach(function(point){var animateTo=point.shapeArgs;if(!styledMode){animateTo.fill=point.color}if(point.graphic){point.graphic.attr(animateFrom_1).animate(extend(point.shapeArgs,{fill:point.color||series.color}),animationOptions)}});if(chart.drilldown){chart.drilldown.fadeInGroup(this.dataLabelsGroup)}delete this.animate}}function columnAnimateDrillupFrom(level){var series=this,animationOptions=animObject((series.chart.options.drilldown||{}).animation);(series.trackerGroups||[]).forEach(function(key){if(series[key]){series[key].on("mouseover")}});var group=series.group;var removeGroup=group!==series.chart.columnGroup;if(removeGroup){delete series.group}this.points.forEach(function(point){var graphic=point.graphic,animateTo=level.shapeArgs;if(graphic&&animateTo){var complete=function(){graphic.destroy();if(group&&removeGroup){group=group.destroy()}};delete point.graphic;if(!series.chart.styledMode){animateTo.fill=level.color}if(animationOptions.duration){graphic.animate(animateTo,merge(animationOptions,{complete:complete}))}else{graphic.attr(animateTo);complete()}}})}function columnAnimateDrillupTo(init){var series=this,level=series.drilldownLevel;if(!init){series.points.forEach(function(point){var _a;var dataLabel=point.dataLabel;if(point.graphic){point.graphic.hide()}if(dataLabel){dataLabel.hidden=dataLabel.attr("visibility")==="hidden";if(!dataLabel.hidden){dataLabel.hide();(_a=dataLabel.connector)===null||_a===void 0?void 0:_a.hide()}}});syncTimeout(function(){if(series.points){var pointsWithNodes_1=[];series.data.forEach(function(el){pointsWithNodes_1.push(el)});if(series.nodes){pointsWithNodes_1=pointsWithNodes_1.concat(series.nodes)}pointsWithNodes_1.forEach(function(point,i){var _a;var verb=i===(level&&level.pointIndex)?"show":"fadeIn",inherit=verb==="show"?true:void 0,dataLabel=point.dataLabel;if(point.graphic&&point.visible){point.graphic[verb](inherit)}if(dataLabel&&!dataLabel.hidden){dataLabel.fadeIn();(_a=dataLabel.connector)===null||_a===void 0?void 0:_a.fadeIn()}})}},Math.max(series.chart.options.drilldown.animation.duration-50,0));delete this.animate}}function compose(SeriesClass,seriesTypes){var PointClass=SeriesClass.prototype.pointClass,pointProto=PointClass.prototype;if(!pointProto.doDrilldown){var ColumnSeriesClass=seriesTypes.column,MapSeriesClass=seriesTypes.map,PieSeriesClass=seriesTypes.pie;addEvent(PointClass,"afterInit",onPointAfterInit);addEvent(PointClass,"afterSetState",onPointAfterSetState);addEvent(PointClass,"update",onPointUpdate);pointProto.doDrilldown=pointDoDrilldown;pointProto.runDrilldown=pointRunDrilldown;addEvent(SeriesClass,"afterDrawDataLabels",onSeriesAfterDrawDataLabels);addEvent(SeriesClass,"afterDrawTracker",onSeriesAfterDrawTracker);if(ColumnSeriesClass){var columnProto=ColumnSeriesClass.prototype;columnProto.animateDrilldown=columnAnimateDrilldown;columnProto.animateDrillupFrom=columnAnimateDrillupFrom;columnProto.animateDrillupTo=columnAnimateDrillupTo}if(MapSeriesClass){var mapProto=MapSeriesClass.prototype;mapProto.animateDrilldown=mapAnimateDrilldown;mapProto.animateDrillupFrom=mapAnimateDrillupFrom;mapProto.animateDrillupTo=mapAnimateDrillupTo}if(PieSeriesClass){var pieProto=PieSeriesClass.prototype;pieProto.animateDrilldown=pieAnimateDrilldown;pieProto.animateDrillupFrom=columnAnimateDrillupFrom;pieProto.animateDrillupTo=columnAnimateDrillupTo}}}function mapAnimateDrilldown(init){var series=this,chart=series.chart,group=series.group;if(chart&&group&&series.options&&chart.options.drilldown&&chart.options.drilldown.animation){if(init&&chart.mapView){group.attr({opacity:.01});chart.mapView.allowTransformAnimation=false;series.options.inactiveOtherPoints=true;series.options.enableMouseTracking=false}else{group.animate({opacity:1},chart.options.drilldown.animation,function(){if(series.options){series.options.inactiveOtherPoints=false;series.options.enableMouseTracking=pick(series.userOptions&&series.userOptions.enableMouseTracking,true)}});if(chart.drilldown){chart.drilldown.fadeInGroup(this.dataLabelsGroup)}}}}function mapAnimateDrillupFrom(){var series=this,chart=series.chart;if(chart&&chart.mapView){chart.mapView.allowTransformAnimation=false}if(series.options){series.options.inactiveOtherPoints=true}}function mapAnimateDrillupTo(init){var series=this,chart=series.chart,group=series.group;if(chart&&group){if(init){group.attr({opacity:.01});if(series.options){series.options.inactiveOtherPoints=true}}else{group.animate({opacity:1},(chart.options.drilldown||{}).animation);if(chart.drilldown){chart.drilldown.fadeInGroup(series.dataLabelsGroup)}}}}function onPointAfterInit(){var point=this;if(point.drilldown&&!point.unbindDrilldownClick){point.unbindDrilldownClick=addEvent(point,"click",onPointClick)}return point}function onPointAfterSetState(){var point=this,series=point.series,styledMode=series.chart.styledMode;if(point.drilldown&&series.halo&&point.state==="hover"){applyCursorCSS(series.halo,"pointer",true,styledMode)}else if(series.halo){applyCursorCSS(series.halo,"auto",false,styledMode)}}function onPointClick(e){var point=this,series=point.series;if(series.xAxis&&(series.chart.options.drilldown||{}).allowPointDrilldown===false){series.xAxis.drilldownCategory(point.x,e)}else{point.runDrilldown(void 0,void 0,e)}}function onPointUpdate(e){var point=this,options=e.options||{};if(options.drilldown&&!point.unbindDrilldownClick){point.unbindDrilldownClick=addEvent(point,"click",onPointClick)}else if(!options.drilldown&&options.drilldown!==void 0&&point.unbindDrilldownClick){point.unbindDrilldownClick=point.unbindDrilldownClick()}}function onSeriesAfterDrawDataLabels(){var series=this,chart=series.chart,css=chart.options.drilldown.activeDataLabelStyle,renderer=chart.renderer,styledMode=chart.styledMode;for(var _i=0,_a=series.points;_i<_a.length;_i++){var point=_a[_i];var dataLabelsOptions=point.options.dataLabels,pointCSS=pick(point.dlOptions,dataLabelsOptions&&dataLabelsOptions.style,{});if(point.drilldown&&point.dataLabel){if(css.color==="contrast"&&!styledMode){pointCSS.color=renderer.getContrast(point.color||series.color)}if(dataLabelsOptions&&dataLabelsOptions.color){pointCSS.color=dataLabelsOptions.color}point.dataLabel.addClass("highcharts-drilldown-data-label");if(!styledMode){point.dataLabel.css(css).css(pointCSS)}}}}function onSeriesAfterDrawTracker(){var series=this,styledMode=series.chart.styledMode;for(var _i=0,_a=series.points;_i<_a.length;_i++){var point=_a[_i];if(point.drilldown&&point.graphic){applyCursorCSS(point.graphic,"pointer",true,styledMode)}}}function pieAnimateDrilldown(init){var series=this,chart=series.chart,points=series.points,level=chart.drilldownLevels[chart.drilldownLevels.length-1],animationOptions=chart.options.drilldown.animation;if(series.is("item")){animationOptions.duration=0}if(series.center){var animateFrom=level.shapeArgs,start=animateFrom.start,angle=animateFrom.end-start,startAngle=angle/series.points.length,styledMode=chart.styledMode;if(!init){var animateTo=void 0,point=void 0;for(var i=0,iEnd=points.length;i<iEnd;++i){point=points[i];animateTo=point.shapeArgs;if(!styledMode){animateFrom.fill=level.color;animateTo.fill=point.color}if(point.graphic){point.graphic.attr(merge(animateFrom,{start:start+i*startAngle,end:start+(i+1)*startAngle}))[animationOptions?"animate":"attr"](animateTo,animationOptions)}}if(chart.drilldown){chart.drilldown.fadeInGroup(series.dataLabelsGroup)}delete series.animate}}}function pointDoDrilldown(){this.runDrilldown()}function pointRunDrilldown(holdRedraw,category,originalEvent){var point=this,series=point.series,chart=series.chart,drilldown=chart.options.drilldown||{};var i=(drilldown.series||[]).length,seriesOptions;if(!chart.ddDupes){chart.ddDupes=[]}chart.colorCounter=chart.symbolCounter=0;while(i--&&!seriesOptions){if(drilldown.series&&drilldown.series[i].id===point.drilldown&&point.drilldown&&chart.ddDupes.indexOf(point.drilldown)===-1){seriesOptions=drilldown.series[i];chart.ddDupes.push(point.drilldown)}}fireEvent(chart,"drilldown",{point:point,seriesOptions:seriesOptions,category:category,originalEvent:originalEvent,points:typeof category!=="undefined"&&series.xAxis.getDDPoints(category).slice(0)},function(e){var chart=e.point.series&&e.point.series.chart,seriesOptions=e.seriesOptions;if(chart&&seriesOptions){if(holdRedraw){chart.addSingleSeriesAsDrilldown(e.point,seriesOptions)}else{chart.addSeriesAsDrilldown(e.point,seriesOptions)}}})}var DrilldownSeries={compose:compose};export default DrilldownSeries;