"use strict";import A from"../Core/Animation/AnimationUtilities.js";var stop=A.stop;import H from"../Core/Globals.js";var composed=H.composed;import RendererRegistry from"../Core/Renderer/RendererRegistry.js";import U from"../Core/Utilities.js";var addEvent=U.addEvent,createElement=U.createElement,css=U.css,defined=U.defined,erase=U.erase,merge=U.merge,pushUnique=U.pushUnique;function onChartRender(){var scrollablePlotArea=this.scrollablePlotArea;if((this.scrollablePixelsX||this.scrollablePixelsY)&&!scrollablePlotArea){this.scrollablePlotArea=scrollablePlotArea=new ScrollablePlotArea(this)}scrollablePlotArea===null||scrollablePlotArea===void 0?void 0:scrollablePlotArea.applyFixed()}function markDirty(){if(this.chart.scrollablePlotArea){this.chart.scrollablePlotArea.isDirty=true}}var ScrollablePlotArea=function(){function ScrollablePlotArea(chart){var _a,_b;var chartOptions=chart.options.chart,Renderer=RendererRegistry.getRendererType(),scrollableOptions=chartOptions.scrollablePlotArea||{},moveFixedElements=this.moveFixedElements.bind(this),styles={WebkitOverflowScrolling:"touch",overflowX:"hidden",overflowY:"hidden"};if(chart.scrollablePixelsX){styles.overflowX="auto"}if(chart.scrollablePixelsY){styles.overflowY="auto"}this.chart=chart;var parentDiv=this.parentDiv=createElement("div",{className:"highcharts-scrolling-parent"},{position:"relative"},chart.renderTo),scrollingContainer=this.scrollingContainer=createElement("div",{className:"highcharts-scrolling"},styles,parentDiv),innerContainer=this.innerContainer=createElement("div",{className:"highcharts-inner-container"},void 0,scrollingContainer),fixedDiv=this.fixedDiv=createElement("div",{className:"highcharts-fixed"},{position:"absolute",overflow:"hidden",pointerEvents:"none",zIndex:(((_a=chartOptions.style)===null||_a===void 0?void 0:_a.zIndex)||0)+2,top:0},void 0,true),fixedRenderer=this.fixedRenderer=new Renderer(fixedDiv,chart.chartWidth,chart.chartHeight,chartOptions.style);this.mask=fixedRenderer.path().attr({fill:chartOptions.backgroundColor||"#fff","fill-opacity":(_b=scrollableOptions.opacity)!==null&&_b!==void 0?_b:.85,zIndex:-1}).addClass("highcharts-scrollable-mask").add();scrollingContainer.parentNode.insertBefore(fixedDiv,scrollingContainer);css(chart.renderTo,{overflow:"visible"});addEvent(chart,"afterShowResetZoom",moveFixedElements);addEvent(chart,"afterApplyDrilldown",moveFixedElements);addEvent(chart,"afterLayOutTitles",moveFixedElements);var lastHoverPoint;addEvent(scrollingContainer,"scroll",function(){var pointer=chart.pointer,hoverPoint=chart.hoverPoint;if(pointer){delete pointer.chartPosition;if(hoverPoint){lastHoverPoint=hoverPoint}pointer.runPointActions(void 0,lastHoverPoint,true)}});innerContainer.appendChild(chart.container)}ScrollablePlotArea.compose=function(AxisClass,ChartClass,SeriesClass){var _this=this;if(pushUnique(composed,this.compose)){addEvent(AxisClass,"afterInit",markDirty);addEvent(ChartClass,"afterSetChartSize",function(e){return _this.afterSetSize(e.target,e)});addEvent(ChartClass,"render",onChartRender);addEvent(SeriesClass,"show",markDirty)}};ScrollablePlotArea.afterSetSize=function(chart,e){var _a=chart.options.chart.scrollablePlotArea||{},minWidth=_a.minWidth,minHeight=_a.minHeight,clipBox=chart.clipBox,plotBox=chart.plotBox,inverted=chart.inverted,renderer=chart.renderer;var scrollablePixelsX,scrollablePixelsY,recalculateHoriz;if(!renderer.forExport){if(minWidth){chart.scrollablePixelsX=scrollablePixelsX=Math.max(0,minWidth-chart.chartWidth);if(scrollablePixelsX){chart.scrollablePlotBox=merge(chart.plotBox);plotBox.width=chart.plotWidth+=scrollablePixelsX;clipBox[inverted?"height":"width"]+=scrollablePixelsX;recalculateHoriz=true}}else if(minHeight){chart.scrollablePixelsY=scrollablePixelsY=Math.max(0,minHeight-chart.chartHeight);if(defined(scrollablePixelsY)){chart.scrollablePlotBox=merge(chart.plotBox);plotBox.height=chart.plotHeight+=scrollablePixelsY;clipBox[inverted?"width":"height"]+=scrollablePixelsY;recalculateHoriz=false}}if(defined(recalculateHoriz)&&!e.skipAxes){for(var _i=0,_b=chart.axes;_i<_b.length;_i++){var axis=_b[_i];if(axis.horiz===recalculateHoriz||chart.hasParallelCoordinates&&axis.coll==="yAxis"){axis.setAxisSize();axis.setAxisTranslation()}}}}};ScrollablePlotArea.prototype.applyFixed=function(){var _a;var _b=this,chart=_b.chart,fixedRenderer=_b.fixedRenderer,isDirty=_b.isDirty,scrollingContainer=_b.scrollingContainer,axisOffset=chart.axisOffset,chartWidth=chart.chartWidth,chartHeight=chart.chartHeight,container=chart.container,plotHeight=chart.plotHeight,plotLeft=chart.plotLeft,plotTop=chart.plotTop,plotWidth=chart.plotWidth,_c=chart.scrollablePixelsX,scrollablePixelsX=_c===void 0?0:_c,_d=chart.scrollablePixelsY,scrollablePixelsY=_d===void 0?0:_d,chartOptions=chart.options.chart,scrollableOptions=chartOptions.scrollablePlotArea||{},_e=scrollableOptions.scrollPositionX,scrollPositionX=_e===void 0?0:_e,_f=scrollableOptions.scrollPositionY,scrollPositionY=_f===void 0?0:_f,scrollableWidth=chartWidth+scrollablePixelsX,scrollableHeight=chartHeight+scrollablePixelsY;fixedRenderer.setSize(chartWidth,chartHeight);if(isDirty!==null&&isDirty!==void 0?isDirty:true){this.isDirty=false;this.moveFixedElements()}stop(chart.container);css(container,{width:"".concat(scrollableWidth,"px"),height:"".concat(scrollableHeight,"px")});chart.renderer.boxWrapper.attr({width:scrollableWidth,height:scrollableHeight,viewBox:[0,0,scrollableWidth,scrollableHeight].join(" ")});(_a=chart.chartBackground)===null||_a===void 0?void 0:_a.attr({width:scrollableWidth,height:scrollableHeight});css(scrollingContainer,{width:"".concat(chartWidth,"px"),height:"".concat(chartHeight,"px")});if(!defined(isDirty)){scrollingContainer.scrollLeft=scrollablePixelsX*scrollPositionX;scrollingContainer.scrollTop=scrollablePixelsY*scrollPositionY}var maskTop=plotTop-axisOffset[0]-1,maskLeft=plotLeft-axisOffset[3]-1,maskBottom=plotTop+plotHeight+axisOffset[2]+1,maskRight=plotLeft+plotWidth+axisOffset[1]+1,maskPlotRight=plotLeft+plotWidth-scrollablePixelsX,maskPlotBottom=plotTop+plotHeight-scrollablePixelsY;var d=[["M",0,0]];if(scrollablePixelsX){d=[["M",0,maskTop],["L",plotLeft-1,maskTop],["L",plotLeft-1,maskBottom],["L",0,maskBottom],["Z"],["M",maskPlotRight,maskTop],["L",chartWidth,maskTop],["L",chartWidth,maskBottom],["L",maskPlotRight,maskBottom],["Z"]]}else if(scrollablePixelsY){d=[["M",maskLeft,0],["L",maskLeft,plotTop-1],["L",maskRight,plotTop-1],["L",maskRight,0],["Z"],["M",maskLeft,maskPlotBottom],["L",maskLeft,chartHeight],["L",maskRight,chartHeight],["L",maskRight,maskPlotBottom],["Z"]]}if(chart.redrawTrigger!=="adjustHeight"){this.mask.attr({d:d})}};ScrollablePlotArea.prototype.moveFixedElements=function(){var _a=this.chart,container=_a.container,inverted=_a.inverted,scrollablePixelsX=_a.scrollablePixelsX,scrollablePixelsY=_a.scrollablePixelsY,fixedRenderer=this.fixedRenderer,fixedSelectors=ScrollablePlotArea.fixedSelectors;var axisClass;if(scrollablePixelsX&&!inverted){axisClass=".highcharts-yaxis"}else if(scrollablePixelsX&&inverted){axisClass=".highcharts-xaxis"}else if(scrollablePixelsY&&!inverted){axisClass=".highcharts-xaxis"}else if(scrollablePixelsY&&inverted){axisClass=".highcharts-yaxis"}if(axisClass&&!(this.chart.hasParallelCoordinates&&axisClass===".highcharts-yaxis")){for(var _i=0,_b=["".concat(axisClass,":not(.highcharts-radial-axis)"),"".concat(axisClass,"-labels:not(.highcharts-radial-axis-labels)")];_i<_b.length;_i++){var className=_b[_i];pushUnique(fixedSelectors,className)}}else{for(var _c=0,_d=[".highcharts-xaxis",".highcharts-yaxis"];_c<_d.length;_c++){var classBase=_d[_c];for(var _e=0,_f=["".concat(classBase,":not(.highcharts-radial-axis)"),"".concat(classBase,"-labels:not(.highcharts-radial-axis-labels)")];_e<_f.length;_e++){var className=_f[_e];erase(fixedSelectors,className)}}}for(var _g=0,fixedSelectors_1=fixedSelectors;_g<fixedSelectors_1.length;_g++){var className=fixedSelectors_1[_g];[].forEach.call(container.querySelectorAll(className),function(elem){(elem.namespaceURI===fixedRenderer.SVG_NS?fixedRenderer.box:fixedRenderer.box.parentNode).appendChild(elem);elem.style.pointerEvents="auto"})}};ScrollablePlotArea.fixedSelectors=[".highcharts-breadcrumbs-group",".highcharts-contextbutton",".highcharts-caption",".highcharts-credits",".highcharts-drillup-button",".highcharts-legend",".highcharts-legend-checkbox",".highcharts-navigator-series",".highcharts-navigator-xaxis",".highcharts-navigator-yaxis",".highcharts-navigator",".highcharts-range-selector-group",".highcharts-reset-zoom",".highcharts-scrollbar",".highcharts-subtitle",".highcharts-title"];return ScrollablePlotArea}();export default ScrollablePlotArea;"";