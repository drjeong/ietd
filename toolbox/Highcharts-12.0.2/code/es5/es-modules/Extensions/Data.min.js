"use strict";import Axis from"../Core/Axis/Axis.js";import Chart from"../Core/Chart/Chart.js";import D from"../Core/Defaults.js";var getOptions=D.getOptions;import G from"../Core/Globals.js";var doc=G.doc;import HU from"../Core/HttpUtilities.js";var ajax=HU.ajax;import Point from"../Core/Series/Point.js";import SeriesRegistry from"../Core/Series/SeriesRegistry.js";var seriesTypes=SeriesRegistry.seriesTypes;import U from"../Core/Utilities.js";var addEvent=U.addEvent,defined=U.defined,extend=U.extend,fireEvent=U.fireEvent,isNumber=U.isNumber,merge=U.merge,objectEach=U.objectEach,pick=U.pick,splat=U.splat;function getFreeIndexes(numberOfColumns,seriesBuilders){var freeIndexes=[],freeIndexValues=[];var s,i,referencedIndexes;for(i=0;i<numberOfColumns;i=i+1){freeIndexes.push(true)}for(s=0;s<seriesBuilders.length;s=s+1){referencedIndexes=seriesBuilders[s].getReferencedColumnIndexes();for(i=0;i<referencedIndexes.length;i=i+1){freeIndexes[referencedIndexes[i]]=false}}for(i=0;i<freeIndexes.length;i=i+1){if(freeIndexes[i]){freeIndexValues.push(i)}}return freeIndexValues}function hasURLOption(options){return Boolean(options&&(options.rowsURL||options.csvURL||options.columnsURL))}var Data=function(){function Data(dataOptions,chartOptions,chart){if(chartOptions===void 0){chartOptions={}}this.rowsToColumns=Data.rowsToColumns;this.dateFormats={"YYYY/mm/dd":{regex:/^(\d{4})[\-\/\.](\d{1,2})[\-\/\.](\d{1,2})$/,parser:function(match){return match?Date.UTC(+match[1],+match[2]-1,+match[3]):NaN}},"dd/mm/YYYY":{regex:/^(\d{1,2})[\-\/\.](\d{1,2})[\-\/\.](\d{4})$/,parser:function(match){return match?Date.UTC(+match[3],+match[2]-1,+match[1]):NaN},alternative:"mm/dd/YYYY"},"mm/dd/YYYY":{regex:/^(\d{1,2})[\-\/\.](\d{1,2})[\-\/\.](\d{4})$/,parser:function(match){return match?Date.UTC(+match[3],+match[1]-1,+match[2]):NaN}},"dd/mm/YY":{regex:/^(\d{1,2})[\-\/\.](\d{1,2})[\-\/\.](\d{2})$/,parser:function(match){if(!match){return NaN}var d=new Date;var year=+match[3];if(year>d.getFullYear()-2e3){year+=1900}else{year+=2e3}return Date.UTC(year,+match[2]-1,+match[1])},alternative:"mm/dd/YY"},"mm/dd/YY":{regex:/^(\d{1,2})[\-\/\.](\d{1,2})[\-\/\.](\d{2})$/,parser:function(match){return match?Date.UTC(+match[3]+2e3,+match[1]-1,+match[2]):NaN}}};this.chart=chart;this.chartOptions=chartOptions;this.options=dataOptions;this.rawColumns=[];this.init(dataOptions,chartOptions,chart)}Data.data=function(dataOptions,chartOptions,chart){if(chartOptions===void 0){chartOptions={}}return new Data(dataOptions,chartOptions,chart)};Data.rowsToColumns=function(rows){var row,rowsLength,col,colsLength,columns;if(rows){columns=[];rowsLength=rows.length;for(row=0;row<rowsLength;row++){colsLength=rows[row].length;for(col=0;col<colsLength;col++){if(!columns[col]){columns[col]=[]}columns[col][row]=rows[row][col]}}}return columns};Data.prototype.init=function(dataOptions,chartOptions,chart){var decimalPoint=dataOptions.decimalPoint,hasData;if(chartOptions){this.chartOptions=chartOptions}if(chart){this.chart=chart}if(decimalPoint!=="."&&decimalPoint!==","){decimalPoint=void 0}this.options=dataOptions;this.columns=dataOptions.columns||this.rowsToColumns(dataOptions.rows)||[];this.firstRowAsNames=pick(dataOptions.firstRowAsNames,this.firstRowAsNames,true);this.decimalRegex=decimalPoint&&new RegExp("^(-?[0-9]+)"+decimalPoint+"([0-9]+)$");if(this.liveDataTimeout!==void 0){clearTimeout(this.liveDataTimeout)}this.rawColumns=[];if(this.columns.length){this.dataFound();hasData=!hasURLOption(dataOptions)}if(!hasData){hasData=this.fetchLiveData()}if(!hasData){hasData=Boolean(this.parseCSV().length)}if(!hasData){hasData=Boolean(this.parseTable().length)}if(!hasData){hasData=this.parseGoogleSpreadsheet()}if(!hasData&&dataOptions.afterComplete){dataOptions.afterComplete(this)}};Data.prototype.getColumnDistribution=function(){var _a,_b;var chartOptions=this.chartOptions,options=this.options,xColumns=[],getValueCount=function(type){if(type===void 0){type="line"}return(seriesTypes[type].prototype.pointArrayMap||[0]).length},getPointArrayMap=function(type){if(type===void 0){type="line"}return seriesTypes[type].prototype.pointArrayMap},globalType=(_a=chartOptions===null||chartOptions===void 0?void 0:chartOptions.chart)===null||_a===void 0?void 0:_a.type,individualCounts=[],seriesBuilders=[],seriesMapping=(options===null||options===void 0?void 0:options.seriesMapping)||((_b=chartOptions===null||chartOptions===void 0?void 0:chartOptions.series)===null||_b===void 0?void 0:_b.map(function(){return{x:0}}))||[];var seriesIndex=0;((chartOptions===null||chartOptions===void 0?void 0:chartOptions.series)||[]).forEach(function(series){individualCounts.push(getValueCount(series.type||globalType))});seriesMapping.forEach(function(mapping){xColumns.push(mapping.x||0)});if(xColumns.length===0){xColumns.push(0)}seriesMapping.forEach(function(mapping){var _a,_b;var builder=new SeriesBuilder,numberOfValueColumnsNeeded=individualCounts[seriesIndex]||getValueCount(globalType),seriesArr=(_a=chartOptions===null||chartOptions===void 0?void 0:chartOptions.series)!==null&&_a!==void 0?_a:[],series=(_b=seriesArr[seriesIndex])!==null&&_b!==void 0?_b:{},defaultPointArrayMap=getPointArrayMap(series.type||globalType),pointArrayMap=defaultPointArrayMap!==null&&defaultPointArrayMap!==void 0?defaultPointArrayMap:["y"];if(defined(mapping.x)||series.isCartesian||!defaultPointArrayMap){builder.addColumnReader(mapping.x,"x")}objectEach(mapping,function(val,name){if(name!=="x"){builder.addColumnReader(val,name)}});for(var i=0;i<numberOfValueColumnsNeeded;i++){if(!builder.hasReader(pointArrayMap[i])){builder.addColumnReader(void 0,pointArrayMap[i])}}seriesBuilders.push(builder);seriesIndex++});var globalPointArrayMap=getPointArrayMap(globalType);if(typeof globalPointArrayMap==="undefined"){globalPointArrayMap=["y"]}this.valueCount={global:getValueCount(globalType),xColumns:xColumns,individual:individualCounts,seriesBuilders:seriesBuilders,globalPointArrayMap:globalPointArrayMap}};Data.prototype.dataFound=function(){if(this.options.switchRowsAndColumns){this.columns=this.rowsToColumns(this.columns)}this.getColumnDistribution();this.parseTypes();if(this.parsed()!==false){this.complete()}};Data.prototype.parseCSV=function(inOptions){var self=this,columns=this.columns=[],options=inOptions||this.options,startColumn=options.startColumn||0,endColumn=options.endColumn||Number.MAX_VALUE,dataTypes=[],potDelimiters={",":0,";":0,"\t":0};var csv=options.csv,startRow=options.startRow||0,endRow=options.endRow||Number.MAX_VALUE,itemDelimiter,lines,rowIt=0;function parseRow(columnStr,rowNumber,noAdd,callbacks){var i=0,c="",cl="",cn="",token="",actualColumn=0,column=0;function read(j){c=columnStr[j];cl=columnStr[j-1];cn=columnStr[j+1]}function pushType(type){if(dataTypes.length<column+1){dataTypes.push([type])}if(dataTypes[column][dataTypes[column].length-1]!==type){dataTypes[column].push(type)}}function push(){if(startColumn>actualColumn||actualColumn>endColumn){++actualColumn;token="";return}if(!options.columnTypes){if(!isNaN(parseFloat(token))&&isFinite(token)){token=parseFloat(token);pushType("number")}else if(!isNaN(Date.parse(token))){token=token.replace(/\//g,"-");pushType("date")}else{pushType("string")}}if(columns.length<column+1){columns.push([])}if(!noAdd){columns[column][rowNumber]=token}token="";++column;++actualColumn}if(!columnStr.trim().length){return}if(columnStr.trim()[0]==="#"){return}for(;i<columnStr.length;i++){read(i);if(c==='"'){read(++i);while(i<columnStr.length){if(c==='"'&&cl!=='"'&&cn!=='"'){break}if(c!=='"'||c==='"'&&cl!=='"'){token+=c}read(++i)}}else if(callbacks===null||callbacks===void 0?void 0:callbacks[c]){if(callbacks[c](c,token)){push()}}else if(c===itemDelimiter){push()}else{token+=c}}push()}function guessDelimiter(lines){var points=0,commas=0,guessed=false;lines.some(function(columnStr,i){var inStr=false,c,cn,cl,token="";if(i>13){return true}for(var j=0;j<columnStr.length;j++){c=columnStr[j];cn=columnStr[j+1];cl=columnStr[j-1];if(c==="#"){return}if(c==='"'){if(inStr){if(cl!=='"'&&cn!=='"'){while(cn===" "&&j<columnStr.length){cn=columnStr[++j]}if(typeof potDelimiters[cn]!=="undefined"){potDelimiters[cn]++}inStr=false}}else{inStr=true}}else if(typeof potDelimiters[c]!=="undefined"){token=token.trim();if(!isNaN(Date.parse(token))){potDelimiters[c]++}else if(isNaN(token)||!isFinite(token)){potDelimiters[c]++}token=""}else{token+=c}if(c===","){commas++}if(c==="."){points++}}});if(potDelimiters[";"]>potDelimiters[","]){guessed=";"}else if(potDelimiters[","]>potDelimiters[";"]){guessed=","}else{guessed=","}if(!options.decimalPoint){if(points>commas){options.decimalPoint="."}else{options.decimalPoint=","}self.decimalRegex=new RegExp("^(-?[0-9]+)"+options.decimalPoint+"([0-9]+)$")}return guessed}function deduceDateFormat(data,limit){var _a;var format="YYYY/mm/dd",stable=[],max=[];var thing,guessedFormat=[],calculatedFormat,i=0,madeDeduction=false,j;if(!limit||limit>data.length){limit=data.length}for(;i<limit;i++){if(typeof data[i]!=="undefined"&&((_a=data[i])===null||_a===void 0?void 0:_a.length)){thing=data[i].trim().replace(/\//g," ").replace(/\-/g," ").replace(/\./g," ").split(" ");guessedFormat=["","",""];for(j=0;j<thing.length;j++){if(j<guessedFormat.length){thing[j]=parseInt(thing[j],10);if(thing[j]){max[j]=!max[j]||max[j]<thing[j]?thing[j]:max[j];if(typeof stable[j]!=="undefined"){if(stable[j]!==thing[j]){stable[j]=false}}else{stable[j]=thing[j]}if(thing[j]>31){if(thing[j]<100){guessedFormat[j]="YY"}else{guessedFormat[j]="YYYY"}}else if(thing[j]>12&&thing[j]<=31){guessedFormat[j]="dd";madeDeduction=true}else if(!guessedFormat[j].length){guessedFormat[j]="mm"}}}}}}if(madeDeduction){for(j=0;j<stable.length;j++){if(stable[j]!==false){if(max[j]>12&&guessedFormat[j]!=="YY"&&guessedFormat[j]!=="YYYY"){guessedFormat[j]="YY"}}else if(max[j]>12&&guessedFormat[j]==="mm"){guessedFormat[j]="dd"}}if(guessedFormat.length===3&&guessedFormat[1]==="dd"&&guessedFormat[2]==="dd"){guessedFormat[2]="YY"}calculatedFormat=guessedFormat.join("/");if(!(options.dateFormats||self.dateFormats)[calculatedFormat]){fireEvent(self,"deduceDateFailed");return format}return calculatedFormat}return format}if(csv&&options.beforeParse){csv=options.beforeParse.call(this,csv)}if(csv){lines=csv.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split(options.lineDelimiter||"\n");if(!startRow||startRow<0){startRow=0}if(!endRow||endRow>=lines.length){endRow=lines.length-1}if(options.itemDelimiter){itemDelimiter=options.itemDelimiter}else{itemDelimiter=guessDelimiter(lines)}var offset=0;for(rowIt=startRow;rowIt<=endRow;rowIt++){if(lines[rowIt][0]==="#"){offset++}else{parseRow(lines[rowIt],rowIt-startRow-offset)}}if((!options.columnTypes||options.columnTypes.length===0)&&dataTypes.length&&dataTypes[0].length&&dataTypes[0][1]==="date"&&!options.dateFormat){options.dateFormat=deduceDateFormat(columns[0])}this.dataFound()}return columns};Data.prototype.parseTable=function(){var options=this.options,columns=this.columns||[],startRow=options.startRow||0,endRow=options.endRow||Number.MAX_VALUE,startColumn=options.startColumn||0,endColumn=options.endColumn||Number.MAX_VALUE;if(options.table){var table=options.table;if(typeof table==="string"){table=doc.getElementById(table)}[].forEach.call(table.getElementsByTagName("tr"),function(tr,rowNo){if(rowNo>=startRow&&rowNo<=endRow){[].forEach.call(tr.children,function(item,colNo){var row=columns[colNo-startColumn];var i=1;if((item.tagName==="TD"||item.tagName==="TH")&&colNo>=startColumn&&colNo<=endColumn){if(!columns[colNo-startColumn]){columns[colNo-startColumn]=[]}columns[colNo-startColumn][rowNo-startRow]=item.innerHTML;while(rowNo-startRow>=i&&row[rowNo-startRow-i]===void 0){row[rowNo-startRow-i]=null;i++}}})}});this.dataFound()}return columns};Data.prototype.fetchLiveData=function(){var data=this,chart=this.chart,options=this.options,maxRetries=3,pollingEnabled=options.enablePolling,originalOptions=merge(options);var currentRetries=0,updateIntervalMs=(options.dataRefreshRate||2)*1e3;if(!hasURLOption(options)){return false}if(updateIntervalMs<1e3){updateIntervalMs=1e3}delete options.csvURL;delete options.rowsURL;delete options.columnsURL;function performFetch(initialFetch){function request(url,done,tp){if(!url||!/^(http|\/|\.\/|\.\.\/)/.test(url)){if(url&&options.error){options.error("Invalid URL")}return false}if(initialFetch){clearTimeout(data.liveDataTimeout);chart.liveDataURL=url}function poll(){if(pollingEnabled&&chart.liveDataURL===url){data.liveDataTimeout=setTimeout(performFetch,updateIntervalMs)}}ajax({url:url,dataType:tp||"json",success:function(res){if(chart===null||chart===void 0?void 0:chart.series){done(res)}poll()},error:function(xhr,text){var _a;if(++currentRetries<maxRetries){poll()}return(_a=options.error)===null||_a===void 0?void 0:_a.call(options,text,xhr)}});return true}if(!request(originalOptions.csvURL,function(res){chart.update({data:{csv:res}})},"text")){if(!request(originalOptions.rowsURL,function(res){chart.update({data:{rows:res}})})){request(originalOptions.columnsURL,function(res){chart.update({data:{columns:res}})})}}}performFetch(true);return hasURLOption(options)};Data.prototype.parseGoogleSpreadsheet=function(){var data=this,options=this.options,googleSpreadsheetKey=options.googleSpreadsheetKey,chart=this.chart,refreshRate=Math.max((options.dataRefreshRate||2)*1e3,4e3);var getRange=function(){if(options.googleSpreadsheetRange){return options.googleSpreadsheetRange}var alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZ";var start=(alphabet.charAt(options.startColumn||0)||"A")+((options.startRow||0)+1);var end=alphabet.charAt(pick(options.endColumn,-1))||"ZZ";if(defined(options.endRow)){end+=options.endRow+1}return"".concat(start,":").concat(end)};function fetchSheet(fn){var url=["https://sheets.googleapis.com/v4/spreadsheets",googleSpreadsheetKey,"values",getRange(),"?alt=json&"+"majorDimension=COLUMNS&"+"valueRenderOption=UNFORMATTED_VALUE&"+"dateTimeRenderOption=FORMATTED_STRING&"+"key="+options.googleAPIKey].join("/");ajax({url:url,dataType:"json",success:function(json){fn(json);if(options.enablePolling){data.liveDataTimeout=setTimeout(function(){fetchSheet(fn)},refreshRate)}},error:function(xhr,text){var _a;return(_a=options.error)===null||_a===void 0?void 0:_a.call(options,text,xhr)}})}if(googleSpreadsheetKey){delete options.googleSpreadsheetKey;fetchSheet(function(json){var columns=json.values;if(!columns||columns.length===0){return false}var rowCount=columns.reduce(function(rowCount,column){return Math.max(rowCount,column.length)},0);columns.forEach(function(column){for(var i=0;i<rowCount;i++){if(typeof column[i]==="undefined"){column[i]=null}}});if(chart===null||chart===void 0?void 0:chart.series){chart.update({data:{columns:columns}})}else{data.columns=columns;data.dataFound()}})}return false};Data.prototype.trim=function(str,inside){if(typeof str==="string"){str=str.replace(/^\s+|\s+$/g,"");if(inside&&/[\d\s]+/.test(str)){str=str.replace(/\s/g,"")}if(this.decimalRegex){str=str.replace(this.decimalRegex,"$1.$2")}}return str};Data.prototype.parseTypes=function(){var columns=this.columns||[];var col=columns.length;while(col--){this.parseColumn(columns[col],col)}};Data.prototype.parseColumn=function(column,col){var _a;var rawColumns=this.rawColumns,columns=this.columns=this.columns||[],firstRowAsNames=this.firstRowAsNames,isXColumn=((_a=this.valueCount)===null||_a===void 0?void 0:_a.xColumns.indexOf(col))!==-1,backup=[],chartOptions=this.chartOptions,columnTypes=this.options.columnTypes||[],columnType=columnTypes[col],forceCategory=isXColumn&&((chartOptions===null||chartOptions===void 0?void 0:chartOptions.xAxis)&&splat(chartOptions.xAxis)[0].type==="category")||columnType==="string",columnHasName=defined(column.name);var row=column.length,val,floatVal,trimVal,trimInsideVal,dateVal,diff,descending;if(!rawColumns[col]){rawColumns[col]=[]}while(row--){val=backup[row]||column[row];trimVal=this.trim(val);trimInsideVal=this.trim(val,true);floatVal=parseFloat(trimInsideVal);if(typeof rawColumns[col][row]==="undefined"){rawColumns[col][row]=trimVal}if(forceCategory||row===0&&firstRowAsNames&&!columnHasName){column[row]=""+trimVal}else if(+trimInsideVal===floatVal){column[row]=floatVal;if(floatVal>365*24*3600*1e3&&columnType!=="float"){column.isDatetime=true}else{column.isNumeric=true}if(typeof column[row+1]!=="undefined"){descending=floatVal>column[row+1]}}else{if(trimVal===null||trimVal===void 0?void 0:trimVal.length){dateVal=this.parseDate(val)}if(isXColumn&&isNumber(dateVal)&&columnType!=="float"){backup[row]=val;column[row]=dateVal;column.isDatetime=true;if(typeof column[row+1]!=="undefined"){diff=dateVal>column[row+1];if(diff!==descending&&typeof descending!=="undefined"){if(this.alternativeFormat){this.dateFormat=this.alternativeFormat;row=column.length;this.alternativeFormat=this.dateFormats[this.dateFormat].alternative}else{column.unsorted=true}}descending=diff}}else{column[row]=trimVal===""?null:trimVal;if(row!==0&&(column.isDatetime||column.isNumeric)){column.mixed=true}}}}if(isXColumn&&column.mixed){columns[col]=rawColumns[col]}if(isXColumn&&descending&&this.options.sort){for(col=0;col<columns.length;col++){columns[col].reverse();if(firstRowAsNames){var poppedColumn=columns[col].pop();if(poppedColumn){columns[col].unshift(poppedColumn)}}}}};Data.prototype.parseDate=function(val){var parseDate=this.options.parseDate;var ret,key,format,dateFormat=this.options.dateFormat||this.dateFormat,match;if(parseDate){ret=parseDate(val)}else if(typeof val==="string"){if(!dateFormat){for(key in this.dateFormats){format=this.dateFormats[key];match=val.match(format.regex);if(match){this.dateFormat=dateFormat=key;this.alternativeFormat=format.alternative;ret=format.parser(match);break}}}else{format=this.dateFormats[dateFormat];if(!format){format=this.dateFormats["YYYY/mm/dd"]}match=val.match(format.regex);if(match){ret=format.parser(match)}}if(!match){if(val.match(/:.+(GMT|UTC|[Z+\-])/)){val=val.replace(/\s*(?:GMT|UTC)?([+\-])(\d\d)(\d\d)$/,"$1$2:$3").replace(/(?:\s+|GMT|UTC)([+\-])/,"$1").replace(/(\d)\s*(?:GMT|UTC|Z)$/,"$1+00:00")}match=Date.parse(val);if(typeof match==="object"&&match!==null&&match.getTime){ret=match.getTime()-match.getTimezoneOffset()*6e4}else if(isNumber(match)){ret=match-new Date(match).getTimezoneOffset()*6e4}}}return ret};Data.prototype.getData=function(){var _a;if(this.columns){return(_a=this.rowsToColumns(this.columns))===null||_a===void 0?void 0:_a.slice(1)}};Data.prototype.parsed=function(){if(this.options.parsed){return this.options.parsed.call(this,this.columns)}};Data.prototype.complete=function(){var _a,_b,_c,_d,_e;var columns=this.columns=this.columns||[],xColumns=[],options=this.options,allSeriesBuilders=[];var type="linear",series,data,i,j,r,seriesIndex,chartOptions,builder,freeIndexes,typeCol,index;xColumns.length=columns.length;if(options.complete||options.afterComplete){if(this.firstRowAsNames){for(i=0;i<columns.length;i++){var curCol=columns[i];if(!defined(curCol.name)){curCol.name=pick(curCol.shift(),"").toString()}}}series=[];freeIndexes=getFreeIndexes((columns===null||columns===void 0?void 0:columns.length)||0,this.valueCount.seriesBuilders);for(seriesIndex=0;seriesIndex<this.valueCount.seriesBuilders.length;seriesIndex++){builder=this.valueCount.seriesBuilders[seriesIndex];if(builder.populateColumns(freeIndexes)){allSeriesBuilders.push(builder)}}while(freeIndexes.length>0){builder=new SeriesBuilder;builder.addColumnReader(0,"x");index=freeIndexes.indexOf(0);if(index!==-1){freeIndexes.splice(index,1)}for(i=0;i<this.valueCount.global;i++){builder.addColumnReader(void 0,this.valueCount.globalPointArrayMap[i])}if(builder.populateColumns(freeIndexes)){allSeriesBuilders.push(builder)}}if(allSeriesBuilders.length>0&&allSeriesBuilders[0].readers.length>0){typeCol=columns===null||columns===void 0?void 0:columns[(_a=allSeriesBuilders[0].readers[0].columnIndex)!==null&&_a!==void 0?_a:-1];if(typeof typeCol!=="undefined"){if(typeCol.isDatetime){type="datetime"}else if(!typeCol.isNumeric){type="category"}}}if(type==="category"){for(seriesIndex=0;seriesIndex<allSeriesBuilders.length;seriesIndex++){builder=allSeriesBuilders[seriesIndex];for(r=0;r<builder.readers.length;r++){if(builder.readers[r].configName==="x"){builder.readers[r].configName="name"}}}}for(seriesIndex=0;seriesIndex<allSeriesBuilders.length;seriesIndex++){builder=allSeriesBuilders[seriesIndex];data=[];for(j=0;j<columns[0].length;j++){data[j]=builder.read(columns,j)}series[seriesIndex]={data:data,pointStart:data[0]&&(builder.pointIsArray?(_b=data[0])===null||_b===void 0?void 0:_b[0]:(_c=data[0])===null||_c===void 0?void 0:_c.x)||void 0};if(builder.name){series[seriesIndex].name=builder.name}if(type==="category"){series[seriesIndex].turboThreshold=0;series[seriesIndex].pointStart=0}}chartOptions={series:series};if(type==="linear"&&(!this.xAxisOptions||this.xAxisOptions.type===type)){type=this.xAxisOptions=void 0}else{this.xAxisOptions={type:type};if(type==="category"){this.xAxisOptions.uniqueNames=false}}if(!this.chart){merge(true,chartOptions,{xAxis:this.xAxisOptions||{}})}(_d=options.complete)===null||_d===void 0?void 0:_d.call(options,chartOptions);(_e=options.afterComplete)===null||_e===void 0?void 0:_e.call(options,this,chartOptions)}};Data.prototype.xAxisUpdateHandler=function(axis){var options=this.xAxisOptions;if(!options){return}if(!axis.options.type&&options.type){axis.type=options.type}if(!axis.options.uniqueNames&&options.uniqueNames===false){axis.uniqueNames=options.uniqueNames}};Data.prototype.update=function(options,redraw){var _a;var chart=this.chart,chartOptions=chart.options;if(options){options.afterComplete=function(dataInstance,dataOptions){if(!dataOptions){return}var xAxis=chart.xAxis[0],xAxisOptions=dataInstance.xAxisOptions;if(xAxisOptions&&xAxis&&(xAxis.type!==xAxisOptions.type&&!xAxis.options.type||xAxis.uniqueNames&&xAxisOptions.uniqueNames===false&&xAxis.options.uniqueNames===void 0)){xAxis.update({},false)}else{((dataOptions===null||dataOptions===void 0?void 0:dataOptions.series)||[]).forEach(function(seriesOptions){delete seriesOptions.pointStart})}chart.update(dataOptions,redraw,true)};merge(true,chartOptions.data,options);if(((_a=chartOptions.data)===null||_a===void 0?void 0:_a.googleSpreadsheetKey)&&!options.columns){delete chartOptions.data.columns}this.init(chartOptions.data||{},chartOptions)}};return Data}();addEvent(Axis,"afterSetOptions",function(){var _a;if(this.isXAxis&&(!this.chart.xAxis.length||this.chart.xAxis[0]===this)){(_a=this.chart.data)===null||_a===void 0?void 0:_a.xAxisUpdateHandler(this)}});addEvent(Chart,"init",function(e){var chart=this,callback=e.args[1],defaultDataOptions=getOptions().data;var userOptions=e.args[0]||{};if((defaultDataOptions||userOptions&&userOptions.data)&&!chart.hasDataDef){chart.hasDataDef=true;var dataOptions=merge(defaultDataOptions,userOptions.data);chart.data=new Data(extend(dataOptions,{afterComplete:function(dataInstance,dataOptions){var _a,_b,_c,_d;var i,series;if(Object.hasOwnProperty.call(userOptions,"series")){if(typeof userOptions.series==="object"){i=Math.max(userOptions.series.length,(_b=(_a=dataOptions===null||dataOptions===void 0?void 0:dataOptions.series)===null||_a===void 0?void 0:_a.length)!==null&&_b!==void 0?_b:0);while(i--){series=userOptions.series[i]||{};userOptions.series[i]=merge(series,(_d=(_c=dataOptions===null||dataOptions===void 0?void 0:dataOptions.series)===null||_c===void 0?void 0:_c[i])!==null&&_d!==void 0?_d:{})}}else{delete userOptions.series}}userOptions=merge(dataOptions,userOptions);chart.data=dataInstance;chart.init(userOptions,callback)}}),userOptions,chart);e.preventDefault()}});var SeriesBuilder=function(){function SeriesBuilder(){this.readers=[];this.pointIsArray=true}SeriesBuilder.prototype.populateColumns=function(freeIndexes){var builder=this;var enoughColumns=true;builder.readers.forEach(function(reader){if(typeof reader.columnIndex==="undefined"){reader.columnIndex=freeIndexes.shift()}});builder.readers.forEach(function(reader){if(typeof reader.columnIndex==="undefined"){enoughColumns=false}});return enoughColumns};SeriesBuilder.prototype.read=function(columns,rowIndex){var builder=this,pointIsArray=builder.pointIsArray,point=pointIsArray?[]:{};builder.readers.forEach(function(reader){var value=columns[reader.columnIndex][rowIndex];if(pointIsArray){point.push(value)}else{if(reader.configName.indexOf(".")>0){Point.prototype.setNestedProperty(point,value,reader.configName)}else{point[reader.configName]=value}}});if(typeof this.name==="undefined"&&builder.readers.length>=2){var columnIndexes_1=[];builder.readers.forEach(function(reader){if(reader.configName==="x"||reader.configName==="name"||reader.configName==="y"){if(typeof reader.columnIndex!=="undefined"){columnIndexes_1.push(reader.columnIndex)}}});if(columnIndexes_1.length>=2){columnIndexes_1.shift();columnIndexes_1.sort(function(a,b){return a-b})}this.name=columns[pick(columnIndexes_1.shift(),0)].name}return point};SeriesBuilder.prototype.addColumnReader=function(columnIndex,configName){this.readers.push({columnIndex:columnIndex,configName:configName});if(!(configName==="x"||configName==="y"||typeof configName==="undefined")){this.pointIsArray=false}};SeriesBuilder.prototype.getReferencedColumnIndexes=function(){var referencedColumnIndexes=[];var i,columnReader;for(i=0;i<this.readers.length;i=i+1){columnReader=this.readers[i];if(typeof columnReader.columnIndex!=="undefined"){referencedColumnIndexes.push(columnReader.columnIndex)}}return referencedColumnIndexes};SeriesBuilder.prototype.hasReader=function(configName){var i,columnReader;for(i=0;i<this.readers.length;i=i+1){columnReader=this.readers[i];if(columnReader.configName===configName){return true}}};return SeriesBuilder}();export default Data;"";