"use strict";import BreadcrumbsDefaults from"./BreadcrumbsDefaults.js";import F from"../../Core/Templating.js";var format=F.format;import H from"../../Core/Globals.js";var composed=H.composed;import U from"../../Core/Utilities.js";var addEvent=U.addEvent,defined=U.defined,extend=U.extend,fireEvent=U.fireEvent,isString=U.isString,merge=U.merge,objectEach=U.objectEach,pick=U.pick,pushUnique=U.pushUnique;function onChartAfterShowResetZoom(){var chart=this;if(chart.breadcrumbs){var bbox=chart.resetZoomButton&&chart.resetZoomButton.getBBox(),breadcrumbsOptions=chart.breadcrumbs.options;if(bbox&&breadcrumbsOptions.position.align==="right"&&breadcrumbsOptions.relativeTo==="plotBox"){chart.breadcrumbs.alignBreadcrumbsGroup(-bbox.width-breadcrumbsOptions.buttonSpacing)}}}function onChartDestroy(){if(this.breadcrumbs){this.breadcrumbs.destroy();this.breadcrumbs=void 0}}function onChartGetMargins(){var breadcrumbs=this.breadcrumbs;if(breadcrumbs&&!breadcrumbs.options.floating&&breadcrumbs.level){var breadcrumbsOptions=breadcrumbs.options,buttonTheme=breadcrumbsOptions.buttonTheme,breadcrumbsHeight=(buttonTheme.height||0)+2*(buttonTheme.padding||0)+breadcrumbsOptions.buttonSpacing,verticalAlign=breadcrumbsOptions.position.verticalAlign;if(verticalAlign==="bottom"){this.marginBottom=(this.marginBottom||0)+breadcrumbsHeight;breadcrumbs.yOffset=breadcrumbsHeight}else if(verticalAlign!=="middle"){this.plotTop+=breadcrumbsHeight;breadcrumbs.yOffset=-breadcrumbsHeight}else{breadcrumbs.yOffset=void 0}}}function onChartRedraw(){this.breadcrumbs&&this.breadcrumbs.redraw()}function onChartSelection(event){if(event.resetSelection===true&&this.breadcrumbs){this.breadcrumbs.alignBreadcrumbsGroup()}}var Breadcrumbs=function(){function Breadcrumbs(chart,userOptions){this.elementList={};this.isDirty=true;this.level=0;this.list=[];var chartOptions=merge(chart.options.drilldown&&chart.options.drilldown.drillUpButton,Breadcrumbs.defaultOptions,chart.options.navigation&&chart.options.navigation.breadcrumbs,userOptions);this.chart=chart;this.options=chartOptions||{}}Breadcrumbs.compose=function(ChartClass,highchartsDefaultOptions){if(pushUnique(composed,"Breadcrumbs")){addEvent(ChartClass,"destroy",onChartDestroy);addEvent(ChartClass,"afterShowResetZoom",onChartAfterShowResetZoom);addEvent(ChartClass,"getMargins",onChartGetMargins);addEvent(ChartClass,"redraw",onChartRedraw);addEvent(ChartClass,"selection",onChartSelection);extend(highchartsDefaultOptions.lang,BreadcrumbsDefaults.lang)}};Breadcrumbs.prototype.updateProperties=function(list){this.setList(list);this.setLevel();this.isDirty=true};Breadcrumbs.prototype.setList=function(list){this.list=list};Breadcrumbs.prototype.setLevel=function(){this.level=this.list.length&&this.list.length-1};Breadcrumbs.prototype.getLevel=function(){return this.level};Breadcrumbs.prototype.getButtonText=function(breadcrumb){var breadcrumbs=this,chart=breadcrumbs.chart,breadcrumbsOptions=breadcrumbs.options,lang=chart.options.lang,textFormat=pick(breadcrumbsOptions.format,breadcrumbsOptions.showFullPath?"{level.name}":"← {level.name}"),defaultText=lang&&pick(lang.drillUpText,lang.mainBreadcrumb);var returnText=breadcrumbsOptions.formatter&&breadcrumbsOptions.formatter(breadcrumb)||format(textFormat,{level:breadcrumb.levelOptions},chart)||"";if((isString(returnText)&&!returnText.length||returnText==="← ")&&defined(defaultText)){returnText=!breadcrumbsOptions.showFullPath?"← "+defaultText:defaultText}return returnText};Breadcrumbs.prototype.redraw=function(){if(this.isDirty){this.render()}if(this.group){this.group.align()}this.isDirty=false};Breadcrumbs.prototype.render=function(){var breadcrumbs=this,chart=breadcrumbs.chart,breadcrumbsOptions=breadcrumbs.options;if(!breadcrumbs.group&&breadcrumbsOptions){breadcrumbs.group=chart.renderer.g("breadcrumbs-group").addClass("highcharts-no-tooltip highcharts-breadcrumbs").attr({zIndex:breadcrumbsOptions.zIndex}).add()}if(breadcrumbsOptions.showFullPath){this.renderFullPathButtons()}else{this.renderSingleButton()}this.alignBreadcrumbsGroup()};Breadcrumbs.prototype.renderFullPathButtons=function(){this.destroySingleButton();this.resetElementListState();this.updateListElements();this.destroyListElements()};Breadcrumbs.prototype.renderSingleButton=function(){var breadcrumbs=this,chart=breadcrumbs.chart,list=breadcrumbs.list,breadcrumbsOptions=breadcrumbs.options,buttonSpacing=breadcrumbsOptions.buttonSpacing;this.destroyListElements();var posX=breadcrumbs.group?breadcrumbs.group.getBBox().width:buttonSpacing,posY=buttonSpacing;var previousBreadcrumb=list[list.length-2];if(!chart.drillUpButton&&this.level>0){chart.drillUpButton=breadcrumbs.renderButton(previousBreadcrumb,posX,posY)}else if(chart.drillUpButton){if(this.level>0){this.updateSingleButton()}else{this.destroySingleButton()}}};Breadcrumbs.prototype.alignBreadcrumbsGroup=function(xOffset){var breadcrumbs=this;if(breadcrumbs.group){var breadcrumbsOptions=breadcrumbs.options,buttonTheme=breadcrumbsOptions.buttonTheme,positionOptions=breadcrumbsOptions.position,alignTo=breadcrumbsOptions.relativeTo==="chart"||breadcrumbsOptions.relativeTo==="spacingBox"?void 0:"plotBox",bBox=breadcrumbs.group.getBBox(),additionalSpace=2*(buttonTheme.padding||0)+breadcrumbsOptions.buttonSpacing;positionOptions.width=bBox.width+additionalSpace;positionOptions.height=bBox.height+additionalSpace;var newPositions=merge(positionOptions);if(xOffset){newPositions.x+=xOffset}if(breadcrumbs.options.rtl){newPositions.x+=positionOptions.width}newPositions.y=pick(newPositions.y,this.yOffset,0);breadcrumbs.group.align(newPositions,true,alignTo)}};Breadcrumbs.prototype.renderButton=function(breadcrumb,posX,posY){var breadcrumbs=this,chart=this.chart,breadcrumbsOptions=breadcrumbs.options,buttonTheme=merge(breadcrumbsOptions.buttonTheme);var button=chart.renderer.button(breadcrumbs.getButtonText(breadcrumb),posX,posY,function(e){var buttonEvents=breadcrumbsOptions.events&&breadcrumbsOptions.events.click;var callDefaultEvent;if(buttonEvents){callDefaultEvent=buttonEvents.call(breadcrumbs,e,breadcrumb)}if(callDefaultEvent!==false){if(!breadcrumbsOptions.showFullPath){e.newLevel=breadcrumbs.level-1}else{e.newLevel=breadcrumb.level}fireEvent(breadcrumbs,"up",e)}},buttonTheme).addClass("highcharts-breadcrumbs-button").add(breadcrumbs.group);if(!chart.styledMode){button.attr(breadcrumbsOptions.style)}return button};Breadcrumbs.prototype.renderSeparator=function(posX,posY){var breadcrumbs=this,chart=this.chart,breadcrumbsOptions=breadcrumbs.options,separatorOptions=breadcrumbsOptions.separator;var separator=chart.renderer.label(separatorOptions.text,posX,posY,void 0,void 0,void 0,false).addClass("highcharts-breadcrumbs-separator").add(breadcrumbs.group);if(!chart.styledMode){separator.css(separatorOptions.style)}return separator};Breadcrumbs.prototype.update=function(options){merge(true,this.options,options);this.destroy();this.isDirty=true};Breadcrumbs.prototype.updateSingleButton=function(){var chart=this.chart,currentBreadcrumb=this.list[this.level-1];if(chart.drillUpButton){chart.drillUpButton.attr({text:this.getButtonText(currentBreadcrumb)})}};Breadcrumbs.prototype.destroy=function(){this.destroySingleButton();this.destroyListElements(true);if(this.group){this.group.destroy()}this.group=void 0};Breadcrumbs.prototype.destroyListElements=function(force){var elementList=this.elementList;objectEach(elementList,function(element,level){if(force||!elementList[level].updated){element=elementList[level];element.button&&element.button.destroy();element.separator&&element.separator.destroy();delete element.button;delete element.separator;delete elementList[level]}});if(force){this.elementList={}}};Breadcrumbs.prototype.destroySingleButton=function(){if(this.chart.drillUpButton){this.chart.drillUpButton.destroy();this.chart.drillUpButton=void 0}};Breadcrumbs.prototype.resetElementListState=function(){objectEach(this.elementList,function(element){element.updated=false})};Breadcrumbs.prototype.updateListElements=function(){var breadcrumbs=this,elementList=breadcrumbs.elementList,buttonSpacing=breadcrumbs.options.buttonSpacing,posY=buttonSpacing,list=breadcrumbs.list,rtl=breadcrumbs.options.rtl,rtlFactor=rtl?-1:1,updateXPosition=function(element,spacing){return rtlFactor*element.getBBox().width+rtlFactor*spacing},adjustToRTL=function(element,posX,posY){element.translate(posX-element.getBBox().width,posY)};var posX=breadcrumbs.group?updateXPosition(breadcrumbs.group,buttonSpacing):buttonSpacing,currentBreadcrumb,breadcrumb;for(var i=0,iEnd=list.length;i<iEnd;++i){var isLast=i===iEnd-1;var button=void 0,separator=void 0;breadcrumb=list[i];if(elementList[breadcrumb.level]){currentBreadcrumb=elementList[breadcrumb.level];button=currentBreadcrumb.button;if(!currentBreadcrumb.separator&&!isLast){posX+=rtlFactor*buttonSpacing;currentBreadcrumb.separator=breadcrumbs.renderSeparator(posX,posY);if(rtl){adjustToRTL(currentBreadcrumb.separator,posX,posY)}posX+=updateXPosition(currentBreadcrumb.separator,buttonSpacing)}else if(currentBreadcrumb.separator&&isLast){currentBreadcrumb.separator.destroy();delete currentBreadcrumb.separator}elementList[breadcrumb.level].updated=true}else{button=breadcrumbs.renderButton(breadcrumb,posX,posY);if(rtl){adjustToRTL(button,posX,posY)}posX+=updateXPosition(button,buttonSpacing);if(!isLast){separator=breadcrumbs.renderSeparator(posX,posY);if(rtl){adjustToRTL(separator,posX,posY)}posX+=updateXPosition(separator,buttonSpacing)}elementList[breadcrumb.level]={button:button,separator:separator,updated:true}}if(button){button.setState(isLast?2:0)}}};Breadcrumbs.defaultOptions=BreadcrumbsDefaults.options;return Breadcrumbs}();export default Breadcrumbs;"";