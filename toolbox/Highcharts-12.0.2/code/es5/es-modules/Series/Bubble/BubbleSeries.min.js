"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();import BubbleLegendComposition from"./BubbleLegendComposition.js";import BubblePoint from"./BubblePoint.js";import Color from"../../Core/Color/Color.js";var color=Color.parse;import H from"../../Core/Globals.js";var composed=H.composed,noop=H.noop;import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";var Series=SeriesRegistry.series,_a=SeriesRegistry.seriesTypes,columnProto=_a.column.prototype,ScatterSeries=_a.scatter;import U from"../../Core/Utilities.js";var addEvent=U.addEvent,arrayMax=U.arrayMax,arrayMin=U.arrayMin,clamp=U.clamp,extend=U.extend,isNumber=U.isNumber,merge=U.merge,pick=U.pick,pushUnique=U.pushUnique;function onAxisFoundExtremes(){var _this=this;var axisLength=this.len,_a=this,coll=_a.coll,isXAxis=_a.isXAxis,min=_a.min,range=(this.max||0)-(min||0);var pxMin=0,pxMax=axisLength,transA=axisLength/range,hasActiveSeries;if(coll!=="xAxis"&&coll!=="yAxis"){return}this.series.forEach(function(series){if(series.bubblePadding&&series.reserveSpace()){_this.allowZoomOutside=true;hasActiveSeries=true;var data=series.getColumn(isXAxis?"x":"y");if(isXAxis){(series.onPoint||series).getRadii(0,0,series);if(series.onPoint){series.radii=series.onPoint.radii}}if(range>0){var i=data.length;while(i--){if(isNumber(data[i])&&_this.dataMin<=data[i]&&data[i]<=_this.max){var radius=series.radii&&series.radii[i]||0;pxMin=Math.min((data[i]-min)*transA-radius,pxMin);pxMax=Math.max((data[i]-min)*transA+radius,pxMax)}}}}});if(hasActiveSeries&&range>0&&!this.logarithmic){pxMax-=axisLength;transA*=(axisLength+Math.max(0,pxMin)-Math.min(pxMax,axisLength))/axisLength;[["min","userMin",pxMin],["max","userMax",pxMax]].forEach(function(keys){if(typeof pick(_this.options[keys[0]],_this[keys[1]])==="undefined"){_this[keys[0]]+=keys[2]/transA}})}}function onAxisAfterRender(){var _a;var _b=this,ticks=_b.ticks,tickPositions=_b.tickPositions,_c=_b.dataMin,dataMin=_c===void 0?0:_c,_d=_b.dataMax,dataMax=_d===void 0?0:_d,categories=_b.categories,type=this.options.type;if(((categories===null||categories===void 0?void 0:categories.length)||type==="category")&&this.series.find(function(s){return s.bubblePadding})){var tickCount=tickPositions.length;while(tickCount--){var tick=ticks[tickPositions[tickCount]],pos=tick.pos||0;if(pos>dataMax||pos<dataMin){(_a=tick.label)===null||_a===void 0?void 0:_a.hide()}}}}var BubbleSeries=function(_super){__extends(BubbleSeries,_super);function BubbleSeries(){return _super!==null&&_super.apply(this,arguments)||this}BubbleSeries.compose=function(AxisClass,ChartClass,LegendClass){BubbleLegendComposition.compose(ChartClass,LegendClass);if(pushUnique(composed,"Series.Bubble")){addEvent(AxisClass,"foundExtremes",onAxisFoundExtremes);addEvent(AxisClass,"afterRender",onAxisAfterRender)}};BubbleSeries.prototype.animate=function(init){if(!init&&this.points.length<this.options.animationLimit){this.points.forEach(function(point){var graphic=point.graphic,_a=point.plotX,plotX=_a===void 0?0:_a,_b=point.plotY,plotY=_b===void 0?0:_b;if(graphic&&graphic.width){if(!this.hasRendered){graphic.attr({x:plotX,y:plotY,width:1,height:1})}graphic.animate(this.markerAttribs(point),this.options.animation)}},this)}};BubbleSeries.prototype.getRadii=function(){var zData=this.getColumn("z"),yData=this.getColumn("y"),radii=[];var len,i,value,zExtremes=this.chart.bubbleZExtremes;var _a=this.getPxExtremes(),minPxSize=_a.minPxSize,maxPxSize=_a.maxPxSize;if(!zExtremes){var zMin_1=Number.MAX_VALUE;var zMax_1=-Number.MAX_VALUE;var valid_1;this.chart.series.forEach(function(otherSeries){if(otherSeries.bubblePadding&&otherSeries.reserveSpace()){var zExtremes_1=(otherSeries.onPoint||otherSeries).getZExtremes();if(zExtremes_1){zMin_1=Math.min(pick(zMin_1,zExtremes_1.zMin),zExtremes_1.zMin);zMax_1=Math.max(pick(zMax_1,zExtremes_1.zMax),zExtremes_1.zMax);valid_1=true}}});if(valid_1){zExtremes={zMin:zMin_1,zMax:zMax_1};this.chart.bubbleZExtremes=zExtremes}else{zExtremes={zMin:0,zMax:0}}}for(i=0,len=zData.length;i<len;i++){value=zData[i];radii.push(this.getRadius(zExtremes.zMin,zExtremes.zMax,minPxSize,maxPxSize,value,yData&&yData[i]))}this.radii=radii};BubbleSeries.prototype.getRadius=function(zMin,zMax,minSize,maxSize,value,yValue){var options=this.options,sizeByArea=options.sizeBy!=="width",zThreshold=options.zThreshold;var zRange=zMax-zMin,pos=.5;if(yValue===null||value===null){return null}if(isNumber(value)){if(options.sizeByAbsoluteValue){value=Math.abs(value-zThreshold);zMax=zRange=Math.max(zMax-zThreshold,Math.abs(zMin-zThreshold));zMin=0}if(value<zMin){return minSize/2-1}if(zRange>0){pos=(value-zMin)/zRange}}if(sizeByArea&&pos>=0){pos=Math.sqrt(pos)}return Math.ceil(minSize+pos*(maxSize-minSize))/2};BubbleSeries.prototype.hasData=function(){return!!this.dataTable.rowCount};BubbleSeries.prototype.markerAttribs=function(point,state){var attr=_super.prototype.markerAttribs.call(this,point,state),_a=attr.height,height=_a===void 0?0:_a,_b=attr.width,width=_b===void 0?0:_b;return this.chart.inverted?extend(attr,{x:(point.plotX||0)-width/2,y:(point.plotY||0)-height/2}):attr};BubbleSeries.prototype.pointAttribs=function(point,state){var markerOptions=this.options.marker,fillOpacity=markerOptions.fillOpacity,attr=Series.prototype.pointAttribs.call(this,point,state);if(fillOpacity!==1){attr.fill=color(attr.fill).setOpacity(fillOpacity).get("rgba")}return attr};BubbleSeries.prototype.translate=function(){_super.prototype.translate.call(this);this.getRadii();this.translateBubble()};BubbleSeries.prototype.translateBubble=function(){var _a=this,data=_a.data,options=_a.options,radii=_a.radii,minPxSize=this.getPxExtremes().minPxSize;var i=data.length;while(i--){var point=data[i],radius=radii?radii[i]:0;if(this.zoneAxis==="z"){point.negative=(point.z||0)<(options.zThreshold||0)}if(isNumber(radius)&&radius>=minPxSize/2){point.marker=extend(point.marker,{radius:radius,width:2*radius,height:2*radius});point.dlBox={x:point.plotX-radius,y:point.plotY-radius,width:2*radius,height:2*radius}}else{point.shapeArgs=point.plotY=point.dlBox=void 0;point.isInside=false}}};BubbleSeries.prototype.getPxExtremes=function(){var smallestSize=Math.min(this.chart.plotWidth,this.chart.plotHeight);var getPxSize=function(length){var isPercent;if(typeof length==="string"){isPercent=/%$/.test(length);length=parseInt(length,10)}return isPercent?smallestSize*length/100:length};var minPxSize=getPxSize(pick(this.options.minSize,8));var maxPxSize=Math.max(getPxSize(pick(this.options.maxSize,"20%")),minPxSize);return{minPxSize:minPxSize,maxPxSize:maxPxSize}};BubbleSeries.prototype.getZExtremes=function(){var options=this.options,zData=this.getColumn("z").filter(isNumber);if(zData.length){var zMin=pick(options.zMin,clamp(arrayMin(zData),options.displayNegative===false?options.zThreshold||0:-Number.MAX_VALUE,Number.MAX_VALUE));var zMax=pick(options.zMax,arrayMax(zData));if(isNumber(zMin)&&isNumber(zMax)){return{zMin:zMin,zMax:zMax}}}};BubbleSeries.defaultOptions=merge(ScatterSeries.defaultOptions,{dataLabels:{formatter:function(){var numberFormatter=this.series.chart.numberFormatter;var z=this.point.z;return isNumber(z)?numberFormatter(z,-1):""},inside:true,verticalAlign:"middle"},animationLimit:250,marker:{lineColor:null,lineWidth:1,fillOpacity:.5,radius:null,states:{hover:{radiusPlus:0}},symbol:"circle"},minSize:8,maxSize:"20%",softThreshold:false,states:{hover:{halo:{size:5}}},tooltip:{pointFormat:"({point.x}, {point.y}), Size: {point.z}"},turboThreshold:0,zThreshold:0,zoneAxis:"z"});return BubbleSeries}(ScatterSeries);extend(BubbleSeries.prototype,{alignDataLabel:columnProto.alignDataLabel,applyZones:noop,bubblePadding:true,isBubble:true,keysAffectYAxis:["y"],pointArrayMap:["y","z"],pointClass:BubblePoint,parallelArrays:["x","y","z"],trackerGroups:["group","dataLabelsGroup"],specialGroup:"group",zoneAxis:"z"});addEvent(BubbleSeries,"updatedData",function(e){delete e.target.chart.bubbleZExtremes});addEvent(BubbleSeries,"remove",function(e){delete e.target.chart.bubbleZExtremes});SeriesRegistry.registerSeriesType("bubble",BubbleSeries);export default BubbleSeries;"";"";