"use strict";import DataTableCore from"../Data/DataTableCore.js";import H from"../Core/Globals.js";var composed=H.composed;import Point from"../Core/Series/Point.js";import Series from"../Core/Series/Series.js";import SeriesRegistry from"../Core/Series/SeriesRegistry.js";var bubble=SeriesRegistry.seriesTypes.bubble;import SVGRenderer from"../Core/Renderer/SVG/SVGRenderer.js";import U from"../Core/Utilities.js";var addEvent=U.addEvent,defined=U.defined,find=U.find,isNumber=U.isNumber,pushUnique=U.pushUnique;var SeriesOnPointComposition;(function(SeriesOnPointComposition){function compose(SeriesClass,ChartClass){if(pushUnique(composed,"SeriesOnPoint")){var _a=Additions.prototype,chartGetZData=_a.chartGetZData,seriesAfterInit=_a.seriesAfterInit,seriesAfterRender=_a.seriesAfterRender,seriesGetCenter=_a.seriesGetCenter,seriesShowOrHide=_a.seriesShowOrHide,seriesTranslate=_a.seriesTranslate;SeriesClass.types.pie.prototype.onPointSupported=true;addEvent(SeriesClass,"afterInit",seriesAfterInit);addEvent(SeriesClass,"afterRender",seriesAfterRender);addEvent(SeriesClass,"afterGetCenter",seriesGetCenter);addEvent(SeriesClass,"hide",seriesShowOrHide);addEvent(SeriesClass,"show",seriesShowOrHide);addEvent(SeriesClass,"translate",seriesTranslate);addEvent(ChartClass,"beforeRender",chartGetZData);addEvent(ChartClass,"beforeRedraw",chartGetZData)}return SeriesClass}SeriesOnPointComposition.compose=compose;var Additions=function(){function Additions(series){this.getColumn=bubble.prototype.getColumn;this.getRadii=bubble.prototype.getRadii;this.getRadius=bubble.prototype.getRadius;this.getPxExtremes=bubble.prototype.getPxExtremes;this.getZExtremes=bubble.prototype.getZExtremes;this.chart=series.chart;this.series=series;this.options=series.options.onPoint}Additions.prototype.drawConnector=function(){if(!this.connector){this.connector=this.series.chart.renderer.path().addClass("highcharts-connector-seriesonpoint").attr({zIndex:-1}).add(this.series.markerGroup)}var attribs=this.getConnectorAttributes();attribs&&this.connector.animate(attribs)};Additions.prototype.getConnectorAttributes=function(){var chart=this.series.chart,onPointOptions=this.options;if(!onPointOptions){return}var connectorOpts=onPointOptions.connectorOptions||{},position=onPointOptions.position,connectedPoint=chart.get(onPointOptions.id);if(!(connectedPoint instanceof Point)||!position||!defined(connectedPoint.plotX)||!defined(connectedPoint.plotY)){return}var xFrom=defined(position.x)?position.x:connectedPoint.plotX,yFrom=defined(position.y)?position.y:connectedPoint.plotY,xTo=xFrom+(position.offsetX||0),yTo=yFrom+(position.offsetY||0),width=connectorOpts.width||1,color=connectorOpts.stroke||this.series.color,dashStyle=connectorOpts.dashstyle,attribs={d:SVGRenderer.prototype.crispLine([["M",xFrom,yFrom],["L",xTo,yTo]],width),"stroke-width":width};if(!chart.styledMode){attribs.stroke=color;attribs.dashstyle=dashStyle}return attribs};Additions.prototype.seriesAfterInit=function(){if(this.onPointSupported&&this.options.onPoint){this.bubblePadding=true;this.useMapGeometry=true;this.onPoint=new Additions(this)}};Additions.prototype.seriesAfterRender=function(){delete this.chart.bubbleZExtremes;this.onPoint&&this.onPoint.drawConnector()};Additions.prototype.seriesGetCenter=function(e){var onPointOptions=this.options.onPoint,center=e.positions;if(onPointOptions){var connectedPoint=this.chart.get(onPointOptions.id);if(connectedPoint instanceof Point&&defined(connectedPoint.plotX)&&defined(connectedPoint.plotY)){center[0]=connectedPoint.plotX;center[1]=connectedPoint.plotY}var position=onPointOptions.position;if(position){if(defined(position.x)){center[0]=position.x}if(defined(position.y)){center[1]=position.y}if(position.offsetX){center[0]+=position.offsetX}if(position.offsetY){center[1]+=position.offsetY}}}var radius=this.radii&&this.radii[this.index];if(isNumber(radius)){center[2]=radius*2}e.positions=center};Additions.prototype.seriesShowOrHide=function(){var _a;var allSeries=this.chart.series;(_a=this.points)===null||_a===void 0?void 0:_a.forEach(function(point){var series=find(allSeries,function(series){var id=((series.onPoint||{}).options||{}).id;if(!id){return false}return id===point.id});series&&series.setVisible(!series.visible,false)})};Additions.prototype.seriesTranslate=function(){if(this.onPoint){this.onPoint.getRadii();this.radii=this.onPoint.radii}};Additions.prototype.chartGetZData=function(){var zData=[];this.series.forEach(function(series){var _a;var onPointOpts=series.options.onPoint;zData.push((_a=onPointOpts===null||onPointOpts===void 0?void 0:onPointOpts.z)!==null&&_a!==void 0?_a:null)});var dataTable=new DataTableCore({columns:{z:zData}});this.series.forEach(function(series){if(series.onPoint){series.onPoint.dataTable=series.dataTable=dataTable}})};return Additions}();SeriesOnPointComposition.Additions=Additions})(SeriesOnPointComposition||(SeriesOnPointComposition={}));export default SeriesOnPointComposition;"";