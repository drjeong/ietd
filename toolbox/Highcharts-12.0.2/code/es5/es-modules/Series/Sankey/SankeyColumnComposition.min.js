"use strict";import U from"../../Core/Utilities.js";var defined=U.defined,getAlignFactor=U.getAlignFactor,relativeLength=U.relativeLength;var SankeyColumnComposition;(function(SankeyColumnComposition){function compose(points,series){var sankeyColumnArray=points;sankeyColumnArray.sankeyColumn=new SankeyColumnAdditions(sankeyColumnArray,series);return sankeyColumnArray}SankeyColumnComposition.compose=compose;var SankeyColumnAdditions=function(){function SankeyColumnAdditions(points,series){this.points=points;this.series=series}SankeyColumnAdditions.prototype.getTranslationFactor=function(series){var column=this.points,nodes=column.slice(),chart=series.chart,minLinkWidth=series.options.minLinkWidth||0;var skipPoint,factor=0,i,remainingHeight=(chart.plotSizeY||0)-(series.options.borderWidth||0)-(column.length-1)*series.nodePadding;while(column.length){factor=remainingHeight/column.sankeyColumn.sum();skipPoint=false;i=column.length;while(i--){if(column[i].getSum()*factor<minLinkWidth){column.splice(i,1);remainingHeight=Math.max(0,remainingHeight-minLinkWidth);skipPoint=true}}if(!skipPoint){break}}column.length=0;for(var _i=0,nodes_1=nodes;_i<nodes_1.length;_i++){var node=nodes_1[_i];column.push(node)}return factor};SankeyColumnAdditions.prototype.top=function(factor){var series=this.series,nodePadding=series.nodePadding,height=this.points.reduce(function(height,node){if(height>0){height+=nodePadding}var nodeHeight=Math.max(node.getSum()*factor,series.options.minLinkWidth||0);height+=nodeHeight;return height},0);return getAlignFactor(series.options.nodeAlignment||"center")*((series.chart.plotSizeY||0)-height)};SankeyColumnAdditions.prototype.left=function(factor){var series=this.series,chart=series.chart,equalNodes=series.options.equalNodes,maxNodesLength=chart.inverted?chart.plotHeight:chart.plotWidth,nodePadding=series.nodePadding,width=this.points.reduce(function(width,node){if(width>0){width+=nodePadding}var nodeWidth=equalNodes?maxNodesLength/node.series.nodes.length-nodePadding:Math.max(node.getSum()*factor,series.options.minLinkWidth||0);width+=nodeWidth;return width},0);return((chart.plotSizeX||0)-Math.round(width))/2};SankeyColumnAdditions.prototype.sum=function(){return this.points.reduce(function(sum,node){return sum+node.getSum()},0)};SankeyColumnAdditions.prototype.offset=function(node,factor){var column=this.points,series=this.series,nodePadding=series.nodePadding;var offset=0,totalNodeOffset;if(series.is("organization")&&node.hangsFrom){return{absoluteTop:node.hangsFrom.nodeY}}for(var i=0;i<column.length;i++){var sum=column[i].getSum();var height=Math.max(sum*factor,series.options.minLinkWidth||0);var directionOffset=node.options[series.chart.inverted?"offsetHorizontal":"offsetVertical"],optionOffset=node.options.offset||0;if(sum){totalNodeOffset=height+nodePadding}else{totalNodeOffset=0}if(column[i]===node){return{relativeTop:offset+(defined(directionOffset)?relativeLength(directionOffset,height):relativeLength(optionOffset,totalNodeOffset))}}offset+=totalNodeOffset}};return SankeyColumnAdditions}();SankeyColumnComposition.SankeyColumnAdditions=SankeyColumnAdditions})(SankeyColumnComposition||(SankeyColumnComposition={}));export default SankeyColumnComposition;