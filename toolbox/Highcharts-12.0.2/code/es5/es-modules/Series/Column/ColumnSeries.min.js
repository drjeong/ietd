"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();import A from"../../Core/Animation/AnimationUtilities.js";var animObject=A.animObject;import Color from"../../Core/Color/Color.js";var color=Color.parse;import ColumnSeriesDefaults from"./ColumnSeriesDefaults.js";import H from"../../Core/Globals.js";var noop=H.noop;import Series from"../../Core/Series/Series.js";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";import U from"../../Core/Utilities.js";var clamp=U.clamp,crisp=U.crisp,defined=U.defined,extend=U.extend,fireEvent=U.fireEvent,isArray=U.isArray,isNumber=U.isNumber,merge=U.merge,pick=U.pick,objectEach=U.objectEach;var ColumnSeries=function(_super){__extends(ColumnSeries,_super);function ColumnSeries(){return _super!==null&&_super.apply(this,arguments)||this}ColumnSeries.prototype.animate=function(init){var series=this,yAxis=this.yAxis,yAxisPos=yAxis.pos,reversed=yAxis.reversed,options=series.options,_a=this.chart,clipOffset=_a.clipOffset,inverted=_a.inverted,attr={},translateProp=inverted?"translateX":"translateY";var translateStart,translatedThreshold;if(init&&clipOffset){attr.scaleY=.001;translatedThreshold=clamp(yAxis.toPixels(options.threshold||0),yAxisPos,yAxisPos+yAxis.len);if(inverted){translatedThreshold+=reversed?-Math.floor(clipOffset[0]):Math.ceil(clipOffset[2]);attr.translateX=translatedThreshold-yAxis.len}else{translatedThreshold+=reversed?Math.ceil(clipOffset[0]):-Math.floor(clipOffset[2]);attr.translateY=translatedThreshold}if(series.clipBox){series.setClip()}series.group.attr(attr)}else{translateStart=Number(series.group.attr(translateProp));series.group.animate({scaleY:1},extend(animObject(series.options.animation),{step:function(val,fx){if(series.group){attr[translateProp]=translateStart+fx.pos*(yAxisPos-translateStart);series.group.attr(attr)}}}))}};ColumnSeries.prototype.init=function(chart,options){_super.prototype.init.apply(this,arguments);var series=this;chart=series.chart;if(chart.hasRendered){chart.series.forEach(function(otherSeries){if(otherSeries.type===series.type){otherSeries.isDirty=true}})}};ColumnSeries.prototype.getColumnMetrics=function(){var _a,_b;var series=this,options=series.options,xAxis=series.xAxis,yAxis=series.yAxis,reversedStacks=xAxis.options.reversedStacks,reverseStacks=xAxis.reversed&&!reversedStacks||!xAxis.reversed&&reversedStacks,stackGroups={};var stackKey,columnCount=0;if(options.grouping===false){columnCount=1}else{series.chart.series.forEach(function(otherSeries){var otherYAxis=otherSeries.yAxis,otherOptions=otherSeries.options;var columnIndex;if(otherSeries.type===series.type&&otherSeries.reserveSpace()&&yAxis.len===otherYAxis.len&&yAxis.pos===otherYAxis.pos){if(otherOptions.stacking&&otherOptions.stacking!=="group"){stackKey=otherSeries.stackKey;if(typeof stackGroups[stackKey]==="undefined"){stackGroups[stackKey]=columnCount++}columnIndex=stackGroups[stackKey]}else if(otherOptions.grouping!==false){columnIndex=columnCount++}otherSeries.columnIndex=columnIndex}})}var categoryWidth=Math.min(Math.abs(xAxis.transA)*(!((_a=xAxis.brokenAxis)===null||_a===void 0?void 0:_a.hasBreaks)&&((_b=xAxis.ordinal)===null||_b===void 0?void 0:_b.slope)||options.pointRange||xAxis.closestPointRange||xAxis.tickInterval||1),xAxis.len),groupPadding=categoryWidth*options.groupPadding,groupWidth=categoryWidth-2*groupPadding,pointOffsetWidth=groupWidth/(columnCount||1),pointWidth=Math.min(options.maxPointWidth||xAxis.len,pick(options.pointWidth,pointOffsetWidth*(1-2*options.pointPadding))),pointPadding=(pointOffsetWidth-pointWidth)/2,colIndex=(series.columnIndex||0)+(reverseStacks?1:0),pointXOffset=pointPadding+(groupPadding+colIndex*pointOffsetWidth-categoryWidth/2)*(reverseStacks?-1:1);series.columnMetrics={width:pointWidth,offset:pointXOffset,paddedWidth:pointOffsetWidth,columnCount:columnCount};return series.columnMetrics};ColumnSeries.prototype.crispCol=function(x,y,width,height){var borderWidth=this.borderWidth,inverted=this.chart.inverted,bottom=crisp(y+height,borderWidth,inverted);y=crisp(y,borderWidth,inverted);height=bottom-y;if(this.options.crisp){var right=crisp(x+width,borderWidth);x=crisp(x,borderWidth);width=right-x}return{x:x,y:y,width:width,height:height}};ColumnSeries.prototype.adjustForMissingColumns=function(x,pointWidth,point,metrics){var _this=this;var _a;if(!point.isNull&&metrics.columnCount>1){var visibleSeries_1=this.xAxis.series.filter(function(s){return s.visible}).map(function(s){return s.index});var indexInCategory_1=0,totalInCategory_1=0;objectEach((_a=this.xAxis.stacking)===null||_a===void 0?void 0:_a.stacks,function(stack){var _a;var points=typeof point.x==="number"?(_a=stack[point.x.toString()])===null||_a===void 0?void 0:_a.points:void 0,pointValues=points===null||points===void 0?void 0:points[_this.index],yStackMap={};if(points&&isArray(pointValues)){var baseIndex_1=_this.index;var seriesIndexes=Object.keys(points).filter(function(pointKey){return!pointKey.match(",")&&points[pointKey]&&points[pointKey].length>1}).map(parseFloat).filter(function(index){return visibleSeries_1.indexOf(index)!==-1}).filter(function(index){var otherOptions=_this.chart.series[index].options,yStack=otherOptions.stacking&&otherOptions.stack;if(defined(yStack)){if(isNumber(yStackMap[yStack])){if(baseIndex_1===index){baseIndex_1=yStackMap[yStack]}return false}yStackMap[yStack]=index}return true}).sort(function(a,b){return b-a});indexInCategory_1=seriesIndexes.indexOf(baseIndex_1);totalInCategory_1=seriesIndexes.length}});indexInCategory_1=this.xAxis.reversed?totalInCategory_1-1-indexInCategory_1:indexInCategory_1;var boxWidth=(totalInCategory_1-1)*metrics.paddedWidth+pointWidth;x=(point.plotX||0)+boxWidth/2-pointWidth-indexInCategory_1*metrics.paddedWidth}return x};ColumnSeries.prototype.translate=function(){var series=this,chart=series.chart,options=series.options,dense=series.dense=series.closestPointRange*series.xAxis.transA<2,borderWidth=series.borderWidth=pick(options.borderWidth,dense?0:1),xAxis=series.xAxis,yAxis=series.yAxis,threshold=options.threshold,minPointLength=pick(options.minPointLength,5),metrics=series.getColumnMetrics(),seriesPointWidth=metrics.width,seriesXOffset=series.pointXOffset=metrics.offset,dataMin=series.dataMin,dataMax=series.dataMax,translatedThreshold=series.translatedThreshold=yAxis.getThreshold(threshold);var seriesBarW=series.barW=Math.max(seriesPointWidth,1+2*borderWidth);if(options.pointPadding&&options.crisp){seriesBarW=Math.ceil(seriesBarW)}Series.prototype.translate.apply(series);series.points.forEach(function(point){var yBottom=pick(point.yBottom,translatedThreshold),safeDistance=999+Math.abs(yBottom),plotX=point.plotX||0,plotY=clamp(point.plotY,-safeDistance,yAxis.len+safeDistance);var up,barY=Math.min(plotY,yBottom),barH=Math.max(plotY,yBottom)-barY,pointWidth=seriesPointWidth,barX=plotX+seriesXOffset,barW=seriesBarW;if(minPointLength&&Math.abs(barH)<minPointLength){barH=minPointLength;up=!yAxis.reversed&&!point.negative||yAxis.reversed&&point.negative;if(isNumber(threshold)&&isNumber(dataMax)&&point.y===threshold&&dataMax<=threshold&&(yAxis.min||0)<threshold&&(dataMin!==dataMax||(yAxis.max||0)<=threshold)){up=!up;point.negative=!point.negative}barY=Math.abs(barY-translatedThreshold)>minPointLength?yBottom-minPointLength:translatedThreshold-(up?minPointLength:0)}if(defined(point.options.pointWidth)){pointWidth=barW=Math.ceil(point.options.pointWidth);barX-=Math.round((pointWidth-seriesPointWidth)/2)}if(options.centerInCategory){barX=series.adjustForMissingColumns(barX,pointWidth,point,metrics)}point.barX=barX;point.pointWidth=pointWidth;point.tooltipPos=chart.inverted?[clamp(yAxis.len+yAxis.pos-chart.plotLeft-plotY,yAxis.pos-chart.plotLeft,yAxis.len+yAxis.pos-chart.plotLeft),xAxis.len+xAxis.pos-chart.plotTop-barX-barW/2,barH]:[xAxis.left-chart.plotLeft+barX+barW/2,clamp(plotY+yAxis.pos-chart.plotTop,yAxis.pos-chart.plotTop,yAxis.len+yAxis.pos-chart.plotTop),barH];point.shapeType=series.pointClass.prototype.shapeType||"roundedRect";point.shapeArgs=series.crispCol(barX,point.isNull?translatedThreshold:barY,barW,point.isNull?0:barH)});fireEvent(this,"afterColumnTranslate")};ColumnSeries.prototype.drawGraph=function(){this.group[this.dense?"addClass":"removeClass"]("highcharts-dense-data")};ColumnSeries.prototype.pointAttribs=function(point,state){var options=this.options,p2o=this.pointAttrToOptions||{},strokeOption=p2o.stroke||"borderColor",strokeWidthOption=p2o["stroke-width"]||"borderWidth";var stateOptions,zone,brightness,fill=point&&point.color||this.color,stroke=point&&point[strokeOption]||options[strokeOption]||fill,dashstyle=point&&point.options.dashStyle||options.dashStyle,strokeWidth=point&&point[strokeWidthOption]||options[strokeWidthOption]||this[strokeWidthOption]||0,opacity=pick(point&&point.opacity,options.opacity,1);if(point&&this.zones.length){zone=point.getZone();fill=point.options.color||zone&&(zone.color||point.nonZonedColor)||this.color;if(zone){stroke=zone.borderColor||stroke;dashstyle=zone.dashStyle||dashstyle;strokeWidth=zone.borderWidth||strokeWidth}}if(state&&point){stateOptions=merge(options.states[state],point.options.states&&point.options.states[state]||{});brightness=stateOptions.brightness;fill=stateOptions.color||typeof brightness!=="undefined"&&color(fill).brighten(stateOptions.brightness).get()||fill;stroke=stateOptions[strokeOption]||stroke;strokeWidth=stateOptions[strokeWidthOption]||strokeWidth;dashstyle=stateOptions.dashStyle||dashstyle;opacity=pick(stateOptions.opacity,opacity)}var ret={fill:fill,stroke:stroke,"stroke-width":strokeWidth,opacity:opacity};if(dashstyle){ret.dashstyle=dashstyle}return ret};ColumnSeries.prototype.drawPoints=function(points){if(points===void 0){points=this.points}var series=this,chart=this.chart,options=series.options,renderer=chart.renderer,animationLimit=options.animationLimit||250;var shapeArgs;points.forEach(function(point){var plotY=point.plotY;var graphic=point.graphic,hasGraphic=!!graphic,verb=graphic&&chart.pointCount<animationLimit?"animate":"attr";if(isNumber(plotY)&&point.y!==null){shapeArgs=point.shapeArgs;if(graphic&&point.hasNewShapeType()){graphic=graphic.destroy()}if(series.enabledDataSorting){point.startXPos=series.xAxis.reversed?-(shapeArgs?shapeArgs.width||0:0):series.xAxis.width}if(!graphic){point.graphic=graphic=renderer[point.shapeType](shapeArgs).add(point.group||series.group);if(graphic&&series.enabledDataSorting&&chart.hasRendered&&chart.pointCount<animationLimit){graphic.attr({x:point.startXPos});hasGraphic=true;verb="animate"}}if(graphic&&hasGraphic){graphic[verb](merge(shapeArgs))}if(!chart.styledMode){graphic[verb](series.pointAttribs(point,point.selected&&"select")).shadow(point.allowShadow!==false&&options.shadow)}if(graphic){graphic.addClass(point.getClassName(),true);graphic.attr({visibility:point.visible?"inherit":"hidden"})}}else if(graphic){point.graphic=graphic.destroy()}})};ColumnSeries.prototype.drawTracker=function(points){if(points===void 0){points=this.points}var series=this,chart=series.chart,pointer=chart.pointer,onMouseOver=function(e){pointer===null||pointer===void 0?void 0:pointer.normalize(e);var point=pointer===null||pointer===void 0?void 0:pointer.getPointFromEvent(e),isInsidePlot=chart.scrollablePlotArea?chart.isInsidePlot(e.chartX-chart.plotLeft,e.chartY-chart.plotTop,{visiblePlotOnly:true}):true;if(pointer&&point&&series.options.enableMouseTracking&&isInsidePlot){pointer.isDirectTouch=true;point.onMouseOver(e)}};var dataLabels;points.forEach(function(point){dataLabels=isArray(point.dataLabels)?point.dataLabels:point.dataLabel?[point.dataLabel]:[];if(point.graphic){point.graphic.element.point=point}dataLabels.forEach(function(dataLabel){(dataLabel.div||dataLabel.element).point=point})});if(!series._hasTracking){series.trackerGroups.forEach(function(key){if(series[key]){series[key].addClass("highcharts-tracker").on("mouseover",onMouseOver).on("mouseout",function(e){pointer===null||pointer===void 0?void 0:pointer.onTrackerMouseOut(e)}).on("touchstart",onMouseOver);if(!chart.styledMode&&series.options.cursor){series[key].css({cursor:series.options.cursor})}}});series._hasTracking=true}fireEvent(this,"afterDrawTracker")};ColumnSeries.prototype.remove=function(){var series=this,chart=series.chart;if(chart.hasRendered){chart.series.forEach(function(otherSeries){if(otherSeries.type===series.type){otherSeries.isDirty=true}})}Series.prototype.remove.apply(series,arguments)};ColumnSeries.defaultOptions=merge(Series.defaultOptions,ColumnSeriesDefaults);return ColumnSeries}(Series);extend(ColumnSeries.prototype,{directTouch:true,getSymbol:noop,negStacks:true,trackerGroups:["group","dataLabelsGroup"]});SeriesRegistry.registerSeriesType("column",ColumnSeries);export default ColumnSeries;"";