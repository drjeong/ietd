"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();import AreaRangePoint from"./AreaRangePoint.js";import H from"../../Core/Globals.js";var noop=H.noop;import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";var _a=SeriesRegistry.seriesTypes,AreaSeries=_a.area,areaProto=_a.area.prototype,columnProto=_a.column.prototype;import U from"../../Core/Utilities.js";var addEvent=U.addEvent,defined=U.defined,extend=U.extend,isArray=U.isArray,isNumber=U.isNumber,pick=U.pick,merge=U.merge;var areaRangeSeriesOptions={lineWidth:1,threshold:null,tooltip:{pointFormat:'<span style="color:{series.color}">‚óè</span> '+"{series.name}: <b>{point.low}</b> - <b>{point.high}</b><br/>"},trackByArea:true,dataLabels:{align:void 0,verticalAlign:void 0,xLow:0,xHigh:0,yLow:0,yHigh:0}};var AreaRangeSeries=function(_super){__extends(AreaRangeSeries,_super);function AreaRangeSeries(){return _super!==null&&_super.apply(this,arguments)||this}AreaRangeSeries.prototype.toYData=function(point){return[point.low,point.high]};AreaRangeSeries.prototype.highToXY=function(point){var chart=this.chart,xy=this.xAxis.postTranslate(point.rectPlotX||0,this.yAxis.len-(point.plotHigh||0));point.plotHighX=xy.x-chart.plotLeft;point.plotHigh=xy.y-chart.plotTop;point.plotLowX=point.plotX};AreaRangeSeries.prototype.getGraphPath=function(points){var highPoints=[],highAreaPoints=[],getGraphPath=areaProto.getGraphPath,options=this.options,polar=this.chart.polar,connectEnds=polar&&options.connectEnds!==false,connectNulls=options.connectNulls;var i,point,pointShim,step=options.step;points=points||this.points;i=points.length;while(i--){point=points[i];var highAreaPoint=polar?{plotX:point.rectPlotX,plotY:point.yBottom,doCurve:false}:{plotX:point.plotX,plotY:point.plotY,doCurve:false};if(!point.isNull&&!connectEnds&&!connectNulls&&(!points[i+1]||points[i+1].isNull)){highAreaPoints.push(highAreaPoint)}pointShim={polarPlotY:point.polarPlotY,rectPlotX:point.rectPlotX,yBottom:point.yBottom,plotX:pick(point.plotHighX,point.plotX),plotY:point.plotHigh,isNull:point.isNull};highAreaPoints.push(pointShim);highPoints.push(pointShim);if(!point.isNull&&!connectEnds&&!connectNulls&&(!points[i-1]||points[i-1].isNull)){highAreaPoints.push(highAreaPoint)}}var lowerPath=getGraphPath.call(this,points);if(step){if(step===true){step="left"}options.step={left:"right",center:"center",right:"left"}[step]}var higherPath=getGraphPath.call(this,highPoints);var higherAreaPath=getGraphPath.call(this,highAreaPoints);options.step=step;var linePath=[].concat(lowerPath,higherPath);if(!this.chart.polar&&higherAreaPath[0]&&higherAreaPath[0][0]==="M"){higherAreaPath[0]=["L",higherAreaPath[0][1],higherAreaPath[0][2]]}this.graphPath=linePath;this.areaPath=lowerPath.concat(higherAreaPath);linePath.isArea=true;linePath.xMap=lowerPath.xMap;this.areaPath.xMap=lowerPath.xMap;return linePath};AreaRangeSeries.prototype.drawDataLabels=function(){var _a,_b;var data=this.points,length=data.length,originalDataLabels=[],dataLabelOptions=this.options.dataLabels,inverted=this.chart.inverted;var i,point,up,upperDataLabelOptions,lowerDataLabelOptions;if(dataLabelOptions){if(isArray(dataLabelOptions)){upperDataLabelOptions=dataLabelOptions[0]||{enabled:false};lowerDataLabelOptions=dataLabelOptions[1]||{enabled:false}}else{upperDataLabelOptions=extend({},dataLabelOptions);upperDataLabelOptions.x=dataLabelOptions.xHigh;upperDataLabelOptions.y=dataLabelOptions.yHigh;lowerDataLabelOptions=extend({},dataLabelOptions);lowerDataLabelOptions.x=dataLabelOptions.xLow;lowerDataLabelOptions.y=dataLabelOptions.yLow}if(upperDataLabelOptions.enabled||((_a=this.hasDataLabels)===null||_a===void 0?void 0:_a.call(this))){i=length;while(i--){point=data[i];if(point){var _c=point.plotHigh,plotHigh=_c===void 0?0:_c,_d=point.plotLow,plotLow=_d===void 0?0:_d;up=upperDataLabelOptions.inside?plotHigh<plotLow:plotHigh>plotLow;point.y=point.high;point._plotY=point.plotY;point.plotY=plotHigh;originalDataLabels[i]=point.dataLabel;point.dataLabel=point.dataLabelUpper;point.below=up;if(inverted){if(!upperDataLabelOptions.align){upperDataLabelOptions.align=up?"right":"left"}}else{if(!upperDataLabelOptions.verticalAlign){upperDataLabelOptions.verticalAlign=up?"top":"bottom"}}}}this.options.dataLabels=upperDataLabelOptions;if(areaProto.drawDataLabels){areaProto.drawDataLabels.apply(this,arguments)}i=length;while(i--){point=data[i];if(point){point.dataLabelUpper=point.dataLabel;point.dataLabel=originalDataLabels[i];delete point.dataLabels;point.y=point.low;point.plotY=point._plotY}}}if(lowerDataLabelOptions.enabled||((_b=this.hasDataLabels)===null||_b===void 0?void 0:_b.call(this))){i=length;while(i--){point=data[i];if(point){var _e=point.plotHigh,plotHigh=_e===void 0?0:_e,_f=point.plotLow,plotLow=_f===void 0?0:_f;up=lowerDataLabelOptions.inside?plotHigh<plotLow:plotHigh>plotLow;point.below=!up;if(inverted){if(!lowerDataLabelOptions.align){lowerDataLabelOptions.align=up?"left":"right"}}else{if(!lowerDataLabelOptions.verticalAlign){lowerDataLabelOptions.verticalAlign=up?"bottom":"top"}}}}this.options.dataLabels=lowerDataLabelOptions;if(areaProto.drawDataLabels){areaProto.drawDataLabels.apply(this,arguments)}}if(upperDataLabelOptions.enabled){i=length;while(i--){point=data[i];if(point){point.dataLabels=[point.dataLabelUpper,point.dataLabel].filter(function(label){return!!label})}}}this.options.dataLabels=dataLabelOptions}};AreaRangeSeries.prototype.alignDataLabel=function(){columnProto.alignDataLabel.apply(this,arguments)};AreaRangeSeries.prototype.modifyMarkerSettings=function(){var series=this,originalMarkerSettings={marker:series.options.marker,symbol:series.symbol};if(series.options.lowMarker){var _a=series.options,marker=_a.marker,lowMarker=_a.lowMarker;series.options.marker=merge(marker,lowMarker);if(lowMarker.symbol){series.symbol=lowMarker.symbol}}return originalMarkerSettings};AreaRangeSeries.prototype.restoreMarkerSettings=function(originalSettings){var series=this;series.options.marker=originalSettings.marker;series.symbol=originalSettings.symbol};AreaRangeSeries.prototype.drawPoints=function(){var series=this,pointLength=series.points.length;var i,point;var originalSettings=series.modifyMarkerSettings();areaProto.drawPoints.apply(series,arguments);series.restoreMarkerSettings(originalSettings);i=0;while(i<pointLength){point=series.points[i];point.graphics=point.graphics||[];point.origProps={plotY:point.plotY,plotX:point.plotX,isInside:point.isInside,negative:point.negative,zone:point.zone,y:point.y};if(point.graphic||point.graphics[0]){point.graphics[0]=point.graphic}point.graphic=point.graphics[1];point.plotY=point.plotHigh;if(defined(point.plotHighX)){point.plotX=point.plotHighX}point.y=pick(point.high,point.origProps.y);point.negative=point.y<(series.options.threshold||0);if(series.zones.length){point.zone=point.getZone()}if(!series.chart.polar){point.isInside=point.isTopInside=typeof point.plotY!=="undefined"&&point.plotY>=0&&point.plotY<=series.yAxis.len&&point.plotX>=0&&point.plotX<=series.xAxis.len}i++}areaProto.drawPoints.apply(series,arguments);i=0;while(i<pointLength){point=series.points[i];point.graphics=point.graphics||[];if(point.graphic||point.graphics[1]){point.graphics[1]=point.graphic}point.graphic=point.graphics[0];if(point.origProps){extend(point,point.origProps);delete point.origProps}i++}};AreaRangeSeries.prototype.hasMarkerChanged=function(options,oldOptions){var lowMarker=options.lowMarker,oldMarker=oldOptions.lowMarker||{};return lowMarker&&(lowMarker.enabled===false||oldMarker.symbol!==lowMarker.symbol||oldMarker.height!==lowMarker.height||oldMarker.width!==lowMarker.width)||_super.prototype.hasMarkerChanged.call(this,options,oldOptions)};AreaRangeSeries.defaultOptions=merge(AreaSeries.defaultOptions,areaRangeSeriesOptions);return AreaRangeSeries}(AreaSeries);addEvent(AreaRangeSeries,"afterTranslate",function(){var _this=this;if(this.pointArrayMap.join(",")==="low,high"){this.points.forEach(function(point){var high=point.high,plotY=point.plotY;if(point.isNull){point.plotY=void 0}else{point.plotLow=plotY;point.plotHigh=isNumber(high)?_this.yAxis.translate(_this.dataModify?_this.dataModify.modifyValue(high):high,false,true,void 0,true):void 0;if(_this.dataModify){point.yBottom=point.plotHigh}}})}},{order:0});addEvent(AreaRangeSeries,"afterTranslate",function(){var _this=this;this.points.forEach(function(point){if(_this.chart.polar){_this.highToXY(point);point.plotLow=point.plotY;point.tooltipPos=[((point.plotHighX||0)+(point.plotLowX||0))/2,((point.plotHigh||0)+(point.plotLow||0))/2]}else{var tooltipPos=point.pos(false,point.plotLow),posHigh=point.pos(false,point.plotHigh);if(tooltipPos&&posHigh){tooltipPos[0]=(tooltipPos[0]+posHigh[0])/2;tooltipPos[1]=(tooltipPos[1]+posHigh[1])/2}point.tooltipPos=tooltipPos}})},{order:3});extend(AreaRangeSeries.prototype,{deferTranslatePolar:true,pointArrayMap:["low","high"],pointClass:AreaRangePoint,pointValKey:"low",setStackedPoints:noop});SeriesRegistry.registerSeriesType("arearange",AreaRangeSeries);export default AreaRangeSeries;