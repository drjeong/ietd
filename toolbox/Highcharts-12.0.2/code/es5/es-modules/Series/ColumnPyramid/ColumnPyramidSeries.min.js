"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();import ColumnPyramidSeriesDefaults from"./ColumnPyramidSeriesDefaults.js";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";var ColumnSeries=SeriesRegistry.seriesTypes.column;import U from"../../Core/Utilities.js";var clamp=U.clamp,merge=U.merge,pick=U.pick;var ColumnPyramidSeries=function(_super){__extends(ColumnPyramidSeries,_super);function ColumnPyramidSeries(){return _super!==null&&_super.apply(this,arguments)||this}ColumnPyramidSeries.prototype.translate=function(){var series=this,chart=series.chart,options=series.options,dense=series.dense=series.closestPointRange*series.xAxis.transA<2,borderWidth=series.borderWidth=pick(options.borderWidth,dense?0:1),yAxis=series.yAxis,threshold=options.threshold,minPointLength=pick(options.minPointLength,5),metrics=series.getColumnMetrics(),pointWidth=metrics.width,pointXOffset=series.pointXOffset=metrics.offset;var translatedThreshold=series.translatedThreshold=yAxis.getThreshold(threshold),seriesBarW=series.barW=Math.max(pointWidth,1+2*borderWidth);if(chart.inverted){translatedThreshold-=.5}if(options.pointPadding){seriesBarW=Math.ceil(seriesBarW)}_super.prototype.translate.call(this);for(var _i=0,_a=series.points;_i<_a.length;_i++){var point=_a[_i];var yBottom=pick(point.yBottom,translatedThreshold),safeDistance=999+Math.abs(yBottom),plotY=clamp(point.plotY,-safeDistance,yAxis.len+safeDistance),barW=seriesBarW/2,barY=Math.min(plotY,yBottom),barH=Math.max(plotY,yBottom)-barY;var barX=point.plotX+pointXOffset,stackTotal=void 0,stackHeight=void 0,topXwidth=void 0,bottomXwidth=void 0,invBarPos=void 0,x1=void 0,x2=void 0,x3=void 0,x4=void 0,y1=void 0,y2=void 0;if(options.centerInCategory){barX=series.adjustForMissingColumns(barX,pointWidth,point,metrics)}point.barX=barX;point.pointWidth=pointWidth;point.tooltipPos=chart.inverted?[yAxis.len+yAxis.pos-chart.plotLeft-plotY,series.xAxis.len-barX-barW,barH]:[barX+barW,plotY+yAxis.pos-chart.plotTop,barH];stackTotal=threshold+(point.total||point.y);if(options.stacking==="percent"){stackTotal=threshold+(point.y<0)?-100:100}var topPointY=yAxis.toPixels(stackTotal,true);stackHeight=chart.plotHeight-topPointY-(chart.plotHeight-translatedThreshold);topXwidth=stackHeight?barW*(barY-topPointY)/stackHeight:0;bottomXwidth=stackHeight?barW*(barY+barH-topPointY)/stackHeight:0;x1=barX-topXwidth+barW;x2=barX+topXwidth+barW;x3=barX+bottomXwidth+barW;x4=barX-bottomXwidth+barW;y1=barY-minPointLength;y2=barY+barH;if(point.y<0){y1=barY;y2=barY+barH+minPointLength}if(chart.inverted){invBarPos=yAxis.width-barY;stackHeight=topPointY-(yAxis.width-translatedThreshold);topXwidth=barW*(topPointY-invBarPos)/stackHeight;bottomXwidth=barW*(topPointY-(invBarPos-barH))/stackHeight;x1=barX+barW+topXwidth;x2=x1-2*topXwidth;x3=barX-bottomXwidth+barW;x4=barX+bottomXwidth+barW;y1=barY;y2=barY+barH-minPointLength;if(point.y<0){y2=barY+barH+minPointLength}}point.shapeType="path";point.shapeArgs={x:x1,y:y1,width:x2-x1,height:barH,d:[["M",x1,y1],["L",x2,y1],["L",x3,y2],["L",x4,y2],["Z"]]}}};ColumnPyramidSeries.defaultOptions=merge(ColumnSeries.defaultOptions,ColumnPyramidSeriesDefaults);return ColumnPyramidSeries}(ColumnSeries);SeriesRegistry.registerSeriesType("columnpyramid",ColumnPyramidSeries);export default ColumnPyramidSeries;