"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();import U from"../../Core/Utilities.js";var attr=U.attr;import AccessibilityComponent from"../AccessibilityComponent.js";import KeyboardNavigationHandler from"../KeyboardNavigationHandler.js";import ChartUtilities from"../Utils/ChartUtilities.js";var getChartTitle=ChartUtilities.getChartTitle,unhideChartElementFromAT=ChartUtilities.unhideChartElementFromAT;import HTMLUtilities from"../Utils/HTMLUtilities.js";var getFakeMouseEvent=HTMLUtilities.getFakeMouseEvent;function getExportMenuButtonElement(chart){return chart.exportSVGElements&&chart.exportSVGElements[0]}function exportingShouldHaveA11y(chart){var exportingOpts=chart.options.exporting,exportButton=getExportMenuButtonElement(chart);return!!(exportingOpts&&exportingOpts.enabled!==false&&exportingOpts.accessibility&&exportingOpts.accessibility.enabled&&exportButton&&exportButton.element)}var MenuComponent=function(_super){__extends(MenuComponent,_super);function MenuComponent(){return _super!==null&&_super.apply(this,arguments)||this}MenuComponent.prototype.init=function(){var chart=this.chart,component=this;this.addEvent(chart,"exportMenuShown",function(){component.onMenuShown()});this.addEvent(chart,"exportMenuHidden",function(){component.onMenuHidden()});this.createProxyGroup()};MenuComponent.prototype.onMenuHidden=function(){var menu=this.chart.exportContextMenu;if(menu){menu.setAttribute("aria-hidden","true")}this.setExportButtonExpandedState("false")};MenuComponent.prototype.onMenuShown=function(){var chart=this.chart,menu=chart.exportContextMenu;if(menu){this.addAccessibleContextMenuAttribs();unhideChartElementFromAT(chart,menu)}this.setExportButtonExpandedState("true")};MenuComponent.prototype.setExportButtonExpandedState=function(stateStr){if(this.exportButtonProxy){this.exportButtonProxy.innerElement.setAttribute("aria-expanded",stateStr)}};MenuComponent.prototype.onChartRender=function(){var chart=this.chart,focusEl=chart.focusElement,a11y=chart.accessibility;this.proxyProvider.clearGroup("chartMenu");this.proxyMenuButton();if(this.exportButtonProxy&&focusEl&&focusEl===chart.exportingGroup){if(focusEl.focusBorder){chart.setFocusToElement(focusEl,this.exportButtonProxy.innerElement)}else if(a11y){a11y.keyboardNavigation.tabindexContainer.focus()}}};MenuComponent.prototype.proxyMenuButton=function(){var chart=this.chart;var proxyProvider=this.proxyProvider;var buttonEl=getExportMenuButtonElement(chart);if(exportingShouldHaveA11y(chart)&&buttonEl){this.exportButtonProxy=proxyProvider.addProxyElement("chartMenu",{click:buttonEl},"button",{"aria-label":chart.langFormat("accessibility.exporting.menuButtonLabel",{chart:chart,chartTitle:getChartTitle(chart)}),"aria-expanded":false,title:chart.options.lang.contextButtonTitle||null})}};MenuComponent.prototype.createProxyGroup=function(){var chart=this.chart;if(chart&&this.proxyProvider){this.proxyProvider.addGroup("chartMenu")}};MenuComponent.prototype.addAccessibleContextMenuAttribs=function(){var chart=this.chart,exportList=chart.exportDivElements;if(exportList&&exportList.length){exportList.forEach(function(item){if(item){if(item.tagName==="LI"&&!(item.children&&item.children.length)){item.setAttribute("tabindex",-1)}else{item.setAttribute("aria-hidden","true")}}});var parentDiv=exportList[0]&&exportList[0].parentNode;if(parentDiv){attr(parentDiv,{"aria-hidden":void 0,"aria-label":chart.langFormat("accessibility.exporting.chartMenuLabel",{chart:chart}),role:"list"})}}};MenuComponent.prototype.getKeyboardNavigation=function(){var keys=this.keyCodes,chart=this.chart,component=this;return new KeyboardNavigationHandler(chart,{keyCodeMap:[[[keys.left,keys.up],function(){return component.onKbdPrevious(this)}],[[keys.right,keys.down],function(){return component.onKbdNext(this)}],[[keys.enter,keys.space],function(){return component.onKbdClick(this)}]],validate:function(){return!!chart.exporting&&chart.options.exporting.enabled!==false&&chart.options.exporting.accessibility.enabled!==false},init:function(){var proxy=component.exportButtonProxy;var svgEl=component.chart.exportingGroup;if(proxy&&svgEl){chart.setFocusToElement(svgEl,proxy.innerElement)}},terminate:function(){chart.hideExportMenu()}})};MenuComponent.prototype.onKbdPrevious=function(keyboardNavigationHandler){var chart=this.chart;var a11yOptions=chart.options.accessibility;var response=keyboardNavigationHandler.response;var i=chart.highlightedExportItemIx||0;while(i--){if(chart.highlightExportItem(i)){return response.success}}if(a11yOptions.keyboardNavigation.wrapAround){chart.highlightLastExportItem();return response.success}return response.prev};MenuComponent.prototype.onKbdNext=function(keyboardNavigationHandler){var chart=this.chart;var a11yOptions=chart.options.accessibility;var response=keyboardNavigationHandler.response;for(var i=(chart.highlightedExportItemIx||0)+1;i<chart.exportDivElements.length;++i){if(chart.highlightExportItem(i)){return response.success}}if(a11yOptions.keyboardNavigation.wrapAround){chart.highlightExportItem(0);return response.success}return response.next};MenuComponent.prototype.onKbdClick=function(keyboardNavigationHandler){var chart=this.chart;var curHighlightedItem=chart.exportDivElements[chart.highlightedExportItemIx];var exportButtonElement=getExportMenuButtonElement(chart).element;if(chart.openMenu){this.fakeClickEvent(curHighlightedItem)}else{this.fakeClickEvent(exportButtonElement);chart.highlightExportItem(0)}return keyboardNavigationHandler.response.success};return MenuComponent}(AccessibilityComponent);(function(MenuComponent){function compose(ChartClass){var chartProto=ChartClass.prototype;if(!chartProto.hideExportMenu){chartProto.hideExportMenu=chartHideExportMenu;chartProto.highlightExportItem=chartHighlightExportItem;chartProto.highlightLastExportItem=chartHighlightLastExportItem;chartProto.showExportMenu=chartShowExportMenu}}MenuComponent.compose=compose;function chartShowExportMenu(){var exportButton=getExportMenuButtonElement(this);if(exportButton){var el=exportButton.element;if(el.onclick){el.onclick(getFakeMouseEvent("click"))}}}function chartHideExportMenu(){var chart=this,exportList=chart.exportDivElements;if(exportList&&chart.exportContextMenu&&chart.openMenu){exportList.forEach(function(el){if(el&&el.className==="highcharts-menu-item"&&el.onmouseout){el.onmouseout(getFakeMouseEvent("mouseout"))}});chart.highlightedExportItemIx=0;chart.exportContextMenu.hideMenu();chart.container.focus()}}function chartHighlightExportItem(ix){var listItem=this.exportDivElements&&this.exportDivElements[ix];var curHighlighted=this.exportDivElements&&this.exportDivElements[this.highlightedExportItemIx];if(listItem&&listItem.tagName==="LI"&&!(listItem.children&&listItem.children.length)){var hasSVGFocusSupport=!!(this.renderTo.getElementsByTagName("g")[0]||{}).focus;if(listItem.focus&&hasSVGFocusSupport){listItem.focus()}if(curHighlighted&&curHighlighted.onmouseout){curHighlighted.onmouseout(getFakeMouseEvent("mouseout"))}if(listItem.onmouseover){listItem.onmouseover(getFakeMouseEvent("mouseover"))}this.highlightedExportItemIx=ix;return true}return false}function chartHighlightLastExportItem(){var chart=this;if(chart.exportDivElements){var i=chart.exportDivElements.length;while(i--){if(chart.highlightExportItem(i)){return true}}}return false}})(MenuComponent||(MenuComponent={}));export default MenuComponent;