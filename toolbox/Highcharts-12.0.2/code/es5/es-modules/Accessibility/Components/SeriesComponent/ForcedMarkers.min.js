"use strict";import H from"../../../Core/Globals.js";var composed=H.composed;import U from"../../../Core/Utilities.js";var addEvent=U.addEvent,merge=U.merge,pushUnique=U.pushUnique;var ForcedMarkersComposition;(function(ForcedMarkersComposition){function compose(SeriesClass){if(pushUnique(composed,"A11y.FM")){addEvent(SeriesClass,"afterSetOptions",seriesOnAfterSetOptions);addEvent(SeriesClass,"render",seriesOnRender);addEvent(SeriesClass,"afterRender",seriesOnAfterRender);addEvent(SeriesClass,"renderCanvas",seriesOnRenderCanvas)}}ForcedMarkersComposition.compose=compose;function forceZeroOpacityMarkerOptions(options){merge(true,options,{marker:{enabled:true,states:{normal:{opacity:0}}}})}function getPointMarkerOpacity(pointOptions){return pointOptions.marker.states&&pointOptions.marker.states.normal&&pointOptions.marker.states.normal.opacity}function handleForcePointMarkers(series){var i=series.points.length;while(i--){var point=series.points[i];var pointOptions=point.options;var hadForcedMarker=point.hasForcedA11yMarker;delete point.hasForcedA11yMarker;if(pointOptions.marker){var isStillForcedMarker=hadForcedMarker&&getPointMarkerOpacity(pointOptions)===0;if(pointOptions.marker.enabled&&!isStillForcedMarker){unforcePointMarkerOptions(pointOptions);point.hasForcedA11yMarker=false}else if(pointOptions.marker.enabled===false){forceZeroOpacityMarkerOptions(pointOptions);point.hasForcedA11yMarker=true}}}}function hasIndividualPointMarkerOptions(series){return!!(series._hasPointMarkers&&series.points&&series.points.length)}function isWithinDescriptionThreshold(series){var a11yOptions=series.chart.options.accessibility;return series.points.length<a11yOptions.series.pointDescriptionEnabledThreshold||a11yOptions.series.pointDescriptionEnabledThreshold===false}function seriesOnAfterRender(){var series=this;if(series.chart.styledMode){if(series.markerGroup){series.markerGroup[series.a11yMarkersForced?"addClass":"removeClass"]("highcharts-a11y-markers-hidden")}if(hasIndividualPointMarkerOptions(series)){series.points.forEach(function(point){if(point.graphic){point.graphic[point.hasForcedA11yMarker?"addClass":"removeClass"]("highcharts-a11y-marker-hidden");point.graphic[point.hasForcedA11yMarker===false?"addClass":"removeClass"]("highcharts-a11y-marker-visible")}})}}}function seriesOnAfterSetOptions(e){this.resetA11yMarkerOptions=merge(e.options.marker||{},this.userOptions.marker||{})}function seriesOnRender(){var series=this,options=series.options;if(shouldForceMarkers(series)){if(options.marker&&options.marker.enabled===false){series.a11yMarkersForced=true;forceZeroOpacityMarkerOptions(series.options)}if(hasIndividualPointMarkerOptions(series)){handleForcePointMarkers(series)}}else if(series.a11yMarkersForced){delete series.a11yMarkersForced;unforceSeriesMarkerOptions(series);delete series.resetA11yMarkerOptions}}function shouldForceMarkers(series){var chart=series.chart,chartA11yEnabled=chart.options.accessibility.enabled,seriesA11yEnabled=(series.options.accessibility&&series.options.accessibility.enabled)!==false;return chartA11yEnabled&&seriesA11yEnabled&&isWithinDescriptionThreshold(series)}function unforcePointMarkerOptions(pointOptions){merge(true,pointOptions.marker,{states:{normal:{opacity:getPointMarkerOpacity(pointOptions)||1}}})}function unforceSeriesMarkerOptions(series){var resetMarkerOptions=series.resetA11yMarkerOptions;if(resetMarkerOptions){var originalOpacity=resetMarkerOptions.states&&resetMarkerOptions.states.normal&&resetMarkerOptions.states.normal.opacity;if(series.userOptions&&series.userOptions.marker){series.userOptions.marker.enabled=true}series.update({marker:{enabled:resetMarkerOptions.enabled,states:{normal:{opacity:originalOpacity}}}})}}function seriesOnRenderCanvas(){if(this.boosted&&this.a11yMarkersForced){merge(true,this.options,{marker:{enabled:false}});delete this.a11yMarkersForced}}})(ForcedMarkersComposition||(ForcedMarkersComposition={}));export default ForcedMarkersComposition;