"use strict";import D from"../Core/Defaults.js";var setOptions=D.setOptions;import H from"../Core/Globals.js";var composed=H.composed;import MapNavigationDefaults from"./MapNavigationDefaults.js";import MapPointer from"./MapPointer.js";import MapSymbols from"./MapSymbols.js";import U from"../Core/Utilities.js";var addEvent=U.addEvent,extend=U.extend,merge=U.merge,objectEach=U.objectEach,pick=U.pick,pushUnique=U.pushUnique;function stopEvent(e){var _a,_b;if(e){(_a=e.preventDefault)===null||_a===void 0?void 0:_a.call(e);(_b=e.stopPropagation)===null||_b===void 0?void 0:_b.call(e);e.cancelBubble=true}}var MapNavigation=function(){function MapNavigation(chart){this.chart=chart;this.navButtons=[]}MapNavigation.compose=function(MapChartClass,PointerClass,SVGRendererClass){MapPointer.compose(PointerClass);MapSymbols.compose(SVGRendererClass);if(pushUnique(composed,"Map.Navigation")){addEvent(MapChartClass,"beforeRender",function(){this.mapNavigation=new MapNavigation(this);this.mapNavigation.update()});setOptions(MapNavigationDefaults)}};MapNavigation.prototype.update=function(options){var _a;var mapNav=this,chart=mapNav.chart,navButtons=mapNav.navButtons,outerHandler=function(e){this.handler.call(chart,e);stopEvent(e)};var navOptions=chart.options.mapNavigation;if(options){navOptions=chart.options.mapNavigation=merge(chart.options.mapNavigation,options)}while(navButtons.length){(_a=navButtons.pop())===null||_a===void 0?void 0:_a.destroy()}if(!chart.renderer.forExport&&pick(navOptions.enableButtons,navOptions.enabled)){if(!mapNav.navButtonsGroup){mapNav.navButtonsGroup=chart.renderer.g().attr({zIndex:7}).add()}objectEach(navOptions.buttons,function(buttonOptions,n){var _a;buttonOptions=merge(navOptions.buttonOptions,buttonOptions);var attr={padding:buttonOptions.padding};if(!chart.styledMode&&buttonOptions.theme){extend(attr,buttonOptions.theme);attr.style=merge(buttonOptions.theme.style,buttonOptions.style)}var text=buttonOptions.text,_b=buttonOptions.width,width=_b===void 0?0:_b,_c=buttonOptions.height,height=_c===void 0?0:_c,_d=buttonOptions.padding,padding=_d===void 0?0:_d;var button=chart.renderer.button(text!=="+"&&text!=="-"&&text||"",0,0,outerHandler,attr,void 0,void 0,void 0,n==="zoomIn"?"topbutton":"bottombutton").addClass("highcharts-map-navigation highcharts-"+{zoomIn:"zoom-in",zoomOut:"zoom-out"}[n]).attr({width:width,height:height,title:chart.options.lang[n],zIndex:5}).add(mapNav.navButtonsGroup);if(text==="+"||text==="-"){var w=width+1,d=[["M",padding+3,padding+height/2],["L",padding+w-3,padding+height/2]];if(text==="+"){d.push(["M",padding+w/2,padding+3],["L",padding+w/2,padding+height-3])}chart.renderer.path(d).addClass("highcharts-button-symbol").attr(chart.styledMode?{}:{stroke:(_a=buttonOptions.style)===null||_a===void 0?void 0:_a.color,"stroke-width":3,"stroke-linecap":"round"}).add(button)}button.handler=buttonOptions.onclick;addEvent(button.element,"dblclick",stopEvent);navButtons.push(button);extend(buttonOptions,{width:button.width,height:2*(button.height||0)});if(!chart.hasLoaded){var unbind_1=addEvent(chart,"load",function(){if(button.element){button.align(buttonOptions,false,buttonOptions.alignTo)}unbind_1()})}else{button.align(buttonOptions,false,buttonOptions.alignTo)}});var isIntersectRect_1=function(box1,box2){return!(box2.x>=box1.x+box1.width||box2.x+box2.width<=box1.x||box2.y>=box1.y+box1.height||box2.y+box2.height<=box1.y)};var adjustMapNavBtn=function(){var _a;var expBtnBBox=(_a=chart.exportingGroup)===null||_a===void 0?void 0:_a.getBBox();if(expBtnBBox){var navBtnsBBox=mapNav.navButtonsGroup.getBBox();if(isIntersectRect_1(expBtnBBox,navBtnsBBox)){var aboveExpBtn=-navBtnsBBox.y-navBtnsBBox.height+expBtnBBox.y-5,belowExpBtn=expBtnBBox.y+expBtnBBox.height-navBtnsBBox.y+5,mapNavVerticalAlign=navOptions.buttonOptions&&navOptions.buttonOptions.verticalAlign;mapNav.navButtonsGroup.attr({translateY:mapNavVerticalAlign==="bottom"?aboveExpBtn:belowExpBtn})}}};if(!chart.hasLoaded){addEvent(chart,"render",adjustMapNavBtn)}}this.updateEvents(navOptions)};MapNavigation.prototype.updateEvents=function(options){var chart=this.chart;if(pick(options.enableDoubleClickZoom,options.enabled)||options.enableDoubleClickZoomTo){this.unbindDblClick=this.unbindDblClick||addEvent(chart.container,"dblclick",function(e){chart.pointer.onContainerDblClick(e)})}else if(this.unbindDblClick){this.unbindDblClick=this.unbindDblClick()}if(pick(options.enableMouseWheelZoom,options.enabled)){this.unbindMouseWheel=this.unbindMouseWheel||addEvent(chart.container,"wheel",function(e){var _a,_b;if(!chart.pointer.inClass(e.target,"highcharts-no-mousewheel")){var initialZoom=(_a=chart.mapView)===null||_a===void 0?void 0:_a.zoom;chart.pointer.onContainerMouseWheel(e);if(initialZoom!==((_b=chart.mapView)===null||_b===void 0?void 0:_b.zoom)){stopEvent(e)}}return false})}else if(this.unbindMouseWheel){this.unbindMouseWheel=this.unbindMouseWheel()}};return MapNavigation}();export default MapNavigation;