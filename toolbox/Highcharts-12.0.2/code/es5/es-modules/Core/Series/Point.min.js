"use strict";import AST from"../Renderer/HTML/AST.js";import A from"../Animation/AnimationUtilities.js";var animObject=A.animObject;import D from"../Defaults.js";var defaultOptions=D.defaultOptions;import F from"../Templating.js";var format=F.format;import U from"../Utilities.js";var addEvent=U.addEvent,crisp=U.crisp,erase=U.erase,extend=U.extend,fireEvent=U.fireEvent,getNestedProperty=U.getNestedProperty,isArray=U.isArray,isFunction=U.isFunction,isNumber=U.isNumber,isObject=U.isObject,merge=U.merge,pick=U.pick,syncTimeout=U.syncTimeout,removeEvent=U.removeEvent,uniqueKey=U.uniqueKey;var Point=function(){function Point(series,options,x){var _a;this.formatPrefix="point";this.visible=true;this.point=this;this.series=series;this.applyOptions(options,x);(_a=this.id)!==null&&_a!==void 0?_a:this.id=uniqueKey();this.resolveColor();series.chart.pointCount++;fireEvent(this,"afterInit")}Point.prototype.animateBeforeDestroy=function(){var point=this,animateParams={x:point.startXPos,opacity:0},graphicalProps=point.getGraphicalProps();graphicalProps.singular.forEach(function(prop){var isDataLabel=prop==="dataLabel";point[prop]=point[prop].animate(isDataLabel?{x:point[prop].startXPos,y:point[prop].startYPos,opacity:0}:animateParams)});graphicalProps.plural.forEach(function(plural){point[plural].forEach(function(item){if(item.element){item.animate(extend({x:point.startXPos},item.startYPos?{x:item.startXPos,y:item.startYPos}:{}))}})})};Point.prototype.applyOptions=function(options,x){var point=this,series=point.series,pointValKey=series.options.pointValKey||series.pointValKey;options=Point.prototype.optionsToObject.call(this,options);extend(point,options);point.options=point.options?extend(point.options,options):options;if(options.group){delete point.group}if(options.dataLabels){delete point.dataLabels}if(pointValKey){point.y=Point.prototype.getNestedProperty.call(point,pointValKey)}if(point.selected){point.state="select"}if("name"in point&&typeof x==="undefined"&&series.xAxis&&series.xAxis.hasNames){point.x=series.xAxis.nameToX(point)}if(typeof point.x==="undefined"&&series){point.x=x!==null&&x!==void 0?x:series.autoIncrement()}else if(isNumber(options.x)&&series.options.relativeXValue){point.x=series.autoIncrement(options.x)}else if(typeof point.x==="string"){x!==null&&x!==void 0?x:x=series.chart.time.parse(point.x);if(isNumber(x)){point.x=x}}point.isNull=this.isValid&&!this.isValid();point.formatPrefix=point.isNull?"null":"point";return point};Point.prototype.destroy=function(){if(!this.destroyed){var point_1=this,series=point_1.series,chart=series.chart,dataSorting=series.options.dataSorting,hoverPoints=chart.hoverPoints,globalAnimation=point_1.series.chart.renderer.globalAnimation,animation=animObject(globalAnimation);var destroyPoint=function(){if(point_1.graphic||point_1.graphics||point_1.dataLabel||point_1.dataLabels){removeEvent(point_1);point_1.destroyElements()}for(var prop in point_1){delete point_1[prop]}};if(point_1.legendItem){chart.legend.destroyItem(point_1)}if(hoverPoints){point_1.setState();erase(hoverPoints,point_1);if(!hoverPoints.length){chart.hoverPoints=null}}if(point_1===chart.hoverPoint){point_1.onMouseOut()}if(!dataSorting||!dataSorting.enabled){destroyPoint()}else{this.animateBeforeDestroy();syncTimeout(destroyPoint,animation.duration)}chart.pointCount--}this.destroyed=true};Point.prototype.destroyElements=function(kinds){var point=this,props=point.getGraphicalProps(kinds);props.singular.forEach(function(prop){point[prop]=point[prop].destroy()});props.plural.forEach(function(plural){point[plural].forEach(function(item){if(item&&item.element){item.destroy()}});delete point[plural]})};Point.prototype.firePointEvent=function(eventType,eventArgs,defaultFunction){var point=this,series=this.series,seriesOptions=series.options;point.manageEvent(eventType);if(eventType==="click"&&seriesOptions.allowPointSelect){defaultFunction=function(event){if(!point.destroyed&&point.select){point.select(null,event.ctrlKey||event.metaKey||event.shiftKey)}}}fireEvent(point,eventType,eventArgs,defaultFunction)};Point.prototype.getClassName=function(){var point=this;return"highcharts-point"+(point.selected?" highcharts-point-select":"")+(point.negative?" highcharts-negative":"")+(point.isNull?" highcharts-null-point":"")+(typeof point.colorIndex!=="undefined"?" highcharts-color-"+point.colorIndex:"")+(point.options.className?" "+point.options.className:"")+(point.zone&&point.zone.className?" "+point.zone.className.replace("highcharts-negative",""):"")};Point.prototype.getGraphicalProps=function(kinds){var point=this,props=[],graphicalProps={singular:[],plural:[]};var prop,i;kinds=kinds||{graphic:1,dataLabel:1};if(kinds.graphic){props.push("graphic","connector")}if(kinds.dataLabel){props.push("dataLabel","dataLabelPath","dataLabelUpper")}i=props.length;while(i--){prop=props[i];if(point[prop]){graphicalProps.singular.push(prop)}}["graphic","dataLabel"].forEach(function(prop){var plural=prop+"s";if(kinds[prop]&&point[plural]){graphicalProps.plural.push(plural)}});return graphicalProps};Point.prototype.getNestedProperty=function(key){if(!key){return}if(key.indexOf("custom.")===0){return getNestedProperty(key,this.options)}return this[key]};Point.prototype.getZone=function(){var series=this.series,zones=series.zones,zoneAxis=series.zoneAxis||"y";var zone,i=0;zone=zones[i];while(this[zoneAxis]>=zone.value){zone=zones[++i]}if(!this.nonZonedColor){this.nonZonedColor=this.color}if(zone&&zone.color&&!this.options.color){this.color=zone.color}else{this.color=this.nonZonedColor}return zone};Point.prototype.hasNewShapeType=function(){var point=this;var oldShapeType=point.graphic&&(point.graphic.symbolName||point.graphic.element.nodeName);return oldShapeType!==this.shapeType};Point.prototype.isValid=function(){return(isNumber(this.x)||this.x instanceof Date)&&isNumber(this.y)};Point.prototype.optionsToObject=function(options){var _a;var series=this.series,keys=series.options.keys,pointArrayMap=keys||series.pointArrayMap||["y"],valueCount=pointArrayMap.length;var ret={},firstItemType,i=0,j=0;if(isNumber(options)||options===null){ret[pointArrayMap[0]]=options}else if(isArray(options)){if(!keys&&options.length>valueCount){firstItemType=typeof options[0];if(firstItemType==="string"){if((_a=series.xAxis)===null||_a===void 0?void 0:_a.dateTime){ret.x=series.chart.time.parse(options[0])}else{ret.name=options[0]}}else if(firstItemType==="number"){ret.x=options[0]}i++}while(j<valueCount){if(!keys||typeof options[i]!=="undefined"){if(pointArrayMap[j].indexOf(".")>0){Point.prototype.setNestedProperty(ret,options[i],pointArrayMap[j])}else{ret[pointArrayMap[j]]=options[i]}}i++;j++}}else if(typeof options==="object"){ret=options;if(options.dataLabels){series.hasDataLabels=function(){return true}}if(options.marker){series._hasPointMarkers=true}}return ret};Point.prototype.pos=function(chartCoordinates,plotY){if(plotY===void 0){plotY=this.plotY}if(!this.destroyed){var _a=this,plotX=_a.plotX,series=_a.series,chart=series.chart,xAxis=series.xAxis,yAxis=series.yAxis;var posX=0,posY=0;if(isNumber(plotX)&&isNumber(plotY)){if(chartCoordinates){posX=xAxis?xAxis.pos:chart.plotLeft;posY=yAxis?yAxis.pos:chart.plotTop}return chart.inverted&&xAxis&&yAxis?[yAxis.len-plotY+posY,xAxis.len-plotX+posX]:[plotX+posX,plotY+posY]}}};Point.prototype.resolveColor=function(){var series=this.series,optionsChart=series.chart.options.chart,styledMode=series.chart.styledMode;var color,colors,colorCount=optionsChart.colorCount,colorIndex;delete this.nonZonedColor;if(series.options.colorByPoint){if(!styledMode){colors=series.options.colors||series.chart.options.colors;color=colors[series.colorCounter];colorCount=colors.length}colorIndex=series.colorCounter;series.colorCounter++;if(series.colorCounter===colorCount){series.colorCounter=0}}else{if(!styledMode){color=series.color}colorIndex=series.colorIndex}this.colorIndex=pick(this.options.colorIndex,colorIndex);this.color=pick(this.options.color,color)};Point.prototype.setNestedProperty=function(object,value,key){var nestedKeys=key.split(".");nestedKeys.reduce(function(result,key,i,arr){var isLastKey=arr.length-1===i;result[key]=isLastKey?value:isObject(result[key],true)?result[key]:{};return result[key]},object);return object};Point.prototype.shouldDraw=function(){return!this.isNull};Point.prototype.tooltipFormatter=function(pointFormat){var _a;var _b=this.series,chart=_b.chart,_c=_b.pointArrayMap,pointArrayMap=_c===void 0?["y"]:_c,tooltipOptions=_b.tooltipOptions,_d=tooltipOptions.valueDecimals,valueDecimals=_d===void 0?"":_d,_e=tooltipOptions.valuePrefix,valuePrefix=_e===void 0?"":_e,_f=tooltipOptions.valueSuffix,valueSuffix=_f===void 0?"":_f;if(chart.styledMode){pointFormat=((_a=chart.tooltip)===null||_a===void 0?void 0:_a.styledModeFormat(pointFormat))||pointFormat}pointArrayMap.forEach(function(key){key="{point."+key;if(valuePrefix||valueSuffix){pointFormat=pointFormat.replace(RegExp(key+"}","g"),valuePrefix+key+"}"+valueSuffix)}pointFormat=pointFormat.replace(RegExp(key+"}","g"),key+":,."+valueDecimals+"f}")});return format(pointFormat,this,chart)};Point.prototype.update=function(options,redraw,animation,runEvent){var point=this,series=point.series,graphic=point.graphic,chart=series.chart,seriesOptions=series.options;var i;redraw=pick(redraw,true);function update(){point.applyOptions(options);var hasMockGraphic=graphic&&point.hasMockGraphic;var shouldDestroyGraphic=point.y===null?!hasMockGraphic:hasMockGraphic;if(graphic&&shouldDestroyGraphic){point.graphic=graphic.destroy();delete point.hasMockGraphic}if(isObject(options,true)){if(graphic&&graphic.element){if(options&&options.marker&&typeof options.marker.symbol!=="undefined"){point.graphic=graphic.destroy()}}if((options===null||options===void 0?void 0:options.dataLabels)&&point.dataLabel){point.dataLabel=point.dataLabel.destroy()}}i=point.index;var row={};for(var _i=0,_a=series.dataColumnKeys();_i<_a.length;_i++){var key=_a[_i];row[key]=point[key]}series.dataTable.setRow(row,i);seriesOptions.data[i]=isObject(seriesOptions.data[i],true)||isObject(options,true)?point.options:pick(options,seriesOptions.data[i]);series.isDirty=series.isDirtyData=true;if(!series.fixedBox&&series.hasCartesianSeries){chart.isDirtyBox=true}if(seriesOptions.legendType==="point"){chart.isDirtyLegend=true}if(redraw){chart.redraw(animation)}}if(runEvent===false){update()}else{point.firePointEvent("update",{options:options},update)}};Point.prototype.remove=function(redraw,animation){this.series.removePoint(this.series.data.indexOf(this),redraw,animation)};Point.prototype.select=function(selected,accumulate){var point=this,series=point.series,chart=series.chart;selected=pick(selected,!point.selected);this.selectedStaging=selected;point.firePointEvent(selected?"select":"unselect",{accumulate:accumulate},function(){point.selected=point.options.selected=selected;series.options.data[series.data.indexOf(point)]=point.options;point.setState(selected&&"select");if(!accumulate){chart.getSelectedPoints().forEach(function(loopPoint){var loopSeries=loopPoint.series;if(loopPoint.selected&&loopPoint!==point){loopPoint.selected=loopPoint.options.selected=false;loopSeries.options.data[loopSeries.data.indexOf(loopPoint)]=loopPoint.options;loopPoint.setState(chart.hoverPoints&&loopSeries.options.inactiveOtherPoints?"inactive":"");loopPoint.firePointEvent("unselect")}})}});delete this.selectedStaging};Point.prototype.onMouseOver=function(e){var point=this,series=point.series,_a=series.chart,inverted=_a.inverted,pointer=_a.pointer;if(pointer){e=e?pointer.normalize(e):pointer.getChartCoordinatesFromPoint(point,inverted);pointer.runPointActions(e,point)}};Point.prototype.onMouseOut=function(){var point=this,chart=point.series.chart;point.firePointEvent("mouseOut");if(!point.series.options.inactiveOtherPoints){(chart.hoverPoints||[]).forEach(function(p){p.setState()})}chart.hoverPoints=chart.hoverPoint=null};Point.prototype.manageEvent=function(eventType){var _a,_b,_c,_d,_e,_f,_g;var point=this,options=merge(point.series.options.point,point.options),userEvent=(_a=options.events)===null||_a===void 0?void 0:_a[eventType];if(isFunction(userEvent)&&(!((_b=point.hcEvents)===null||_b===void 0?void 0:_b[eventType])||((_d=(_c=point.hcEvents)===null||_c===void 0?void 0:_c[eventType])===null||_d===void 0?void 0:_d.map(function(el){return el.fn}).indexOf(userEvent))===-1)){(_e=point.importedUserEvent)===null||_e===void 0?void 0:_e.call(point);point.importedUserEvent=addEvent(point,eventType,userEvent);if(point.hcEvents){point.hcEvents[eventType].userEvent=true}}else if(point.importedUserEvent&&!userEvent&&((_f=point.hcEvents)===null||_f===void 0?void 0:_f[eventType])&&((_g=point.hcEvents)===null||_g===void 0?void 0:_g[eventType].userEvent)){removeEvent(point,eventType);delete point.hcEvents[eventType];if(!Object.keys(point.hcEvents)){delete point.importedUserEvent}}};Point.prototype.setState=function(state,move){var _a;var point=this,series=point.series,previousState=point.state,stateOptions=series.options.states[state||"normal"]||{},markerOptions=defaultOptions.plotOptions[series.type].marker&&series.options.marker,normalDisabled=markerOptions&&markerOptions.enabled===false,markerStateOptions=markerOptions&&markerOptions.states&&markerOptions.states[state||"normal"]||{},stateDisabled=markerStateOptions.enabled===false,pointMarker=point.marker||{},chart=series.chart,hasMarkers=markerOptions&&series.markerAttribs;var halo=series.halo,markerAttribs,pointAttribs,pointAttribsAnimation,stateMarkerGraphic=series.stateMarkerGraphic,newSymbol;state=state||"";if(state===point.state&&!move||point.selected&&state!=="select"||stateOptions.enabled===false||state&&(stateDisabled||normalDisabled&&markerStateOptions.enabled===false)||state&&pointMarker.states&&pointMarker.states[state]&&pointMarker.states[state].enabled===false){return}point.state=state;if(hasMarkers){markerAttribs=series.markerAttribs(point,state)}if(point.graphic&&!point.hasMockGraphic){if(previousState){point.graphic.removeClass("highcharts-point-"+previousState)}if(state){point.graphic.addClass("highcharts-point-"+state)}if(!chart.styledMode){pointAttribs=series.pointAttribs(point,state);pointAttribsAnimation=pick(chart.options.chart.animation,stateOptions.animation);var opacity_1=pointAttribs.opacity;if(series.options.inactiveOtherPoints&&isNumber(opacity_1)){(point.dataLabels||[]).forEach(function(label){if(label&&!label.hasClass("highcharts-data-label-hidden")){label.animate({opacity:opacity_1},pointAttribsAnimation);if(label.connector){label.connector.animate({opacity:opacity_1},pointAttribsAnimation)}}})}point.graphic.animate(pointAttribs,pointAttribsAnimation)}if(markerAttribs){point.graphic.animate(markerAttribs,pick(chart.options.chart.animation,markerStateOptions.animation,markerOptions.animation))}if(stateMarkerGraphic){stateMarkerGraphic.hide()}}else{if(state&&markerStateOptions){newSymbol=pointMarker.symbol||series.symbol;if(stateMarkerGraphic&&stateMarkerGraphic.currentSymbol!==newSymbol){stateMarkerGraphic=stateMarkerGraphic.destroy()}if(markerAttribs){if(!stateMarkerGraphic){if(newSymbol){series.stateMarkerGraphic=stateMarkerGraphic=chart.renderer.symbol(newSymbol,markerAttribs.x,markerAttribs.y,markerAttribs.width,markerAttribs.height,merge(markerOptions,markerStateOptions)).add(series.markerGroup);stateMarkerGraphic.currentSymbol=newSymbol}}else{stateMarkerGraphic[move?"animate":"attr"]({x:markerAttribs.x,y:markerAttribs.y})}}if(!chart.styledMode&&stateMarkerGraphic&&point.state!=="inactive"){stateMarkerGraphic.attr(series.pointAttribs(point,state))}}if(stateMarkerGraphic){stateMarkerGraphic[state&&point.isInside?"show":"hide"]();stateMarkerGraphic.element.point=point;stateMarkerGraphic.addClass(point.getClassName(),true)}}var haloOptions=stateOptions.halo;var markerGraphic=point.graphic||stateMarkerGraphic;var markerVisibility=markerGraphic&&markerGraphic.visibility||"inherit";if(haloOptions&&haloOptions.size&&markerGraphic&&markerVisibility!=="hidden"&&!point.isCluster){if(!halo){series.halo=halo=chart.renderer.path().add(markerGraphic.parentGroup)}halo.show()[move?"animate":"attr"]({d:point.haloPath(haloOptions.size)});halo.attr({class:"highcharts-halo highcharts-color-"+pick(point.colorIndex,series.colorIndex)+(point.className?" "+point.className:""),visibility:markerVisibility,zIndex:-1});halo.point=point;if(!chart.styledMode){halo.attr(extend({fill:point.color||series.color,"fill-opacity":haloOptions.opacity},AST.filterUserAttributes(haloOptions.attributes||{})))}}else if(((_a=halo===null||halo===void 0?void 0:halo.point)===null||_a===void 0?void 0:_a.haloPath)&&!halo.point.destroyed){halo.animate({d:halo.point.haloPath(0)},null,halo.hide)}fireEvent(point,"afterSetState",{state:state})};Point.prototype.haloPath=function(size){var pos=this.pos();return pos?this.series.chart.renderer.symbols.circle(crisp(pos[0],1)-size,pos[1]-size,size*2,size*2):[]};return Point}();export default Point;"";