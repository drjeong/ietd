"use strict";import D from"./Defaults.js";var defaultOptions=D.defaultOptions,defaultTime=D.defaultTime;import G from"./Globals.js";var doc=G.doc;import U from"./Utilities.js";var extend=U.extend,getNestedProperty=U.getNestedProperty,isArray=U.isArray,isNumber=U.isNumber,isObject=U.isObject,pick=U.pick,ucfirst=U.ucfirst;var helpers={add:function(a,b){return a+b},divide:function(a,b){return b!==0?a/b:""},eq:function(a,b){return a==b},each:function(arr){var match=arguments[arguments.length-1];return isArray(arr)?arr.map(function(item,i){return format(match.body,extend(isObject(item)?item:{"@this":item},{"@index":i,"@first":i===0,"@last":i===arr.length-1}))}).join(""):false},ge:function(a,b){return a>=b},gt:function(a,b){return a>b},if:function(condition){return!!condition},le:function(a,b){return a<=b},lt:function(a,b){return a<b},multiply:function(a,b){return a*b},ne:function(a,b){return a!=b},subtract:function(a,b){return a-b},ucfirst:ucfirst,unless:function(condition){return!condition}};var numberFormatCache={};function dateFormat(format,timestamp,upperCaseFirst){return defaultTime.dateFormat(format,timestamp,upperCaseFirst)}function format(str,ctx,chart){if(str===void 0){str=""}var regex=/\{([\p{L}\d:\.,;\-\/<>\[\]%_@"'â€™= #\(\)]+)\}/gu,subRegex=/\(([\p{L}\d:\.,;\-\/<>\[\]%_@"'= ]+)\)/gu,matches=[],floatRegex=/f$/,decRegex=/\.(\d)/,lang=(chart===null||chart===void 0?void 0:chart.options.lang)||defaultOptions.lang,time=chart&&chart.time||defaultTime,numberFormatter=chart&&chart.numberFormatter||numberFormat;var resolveProperty=function(key){if(key===void 0){key=""}var n;if(key==="true"){return true}if(key==="false"){return false}if((n=Number(key)).toString()===key){return n}if(/^["'].+["']$/.test(key)){return key.slice(1,-1)}return getNestedProperty(key,ctx)};var match,currentMatch,depth=0,hasSub;while((match=regex.exec(str))!==null){var mainMatch=match,subMatch=subRegex.exec(match[1]);if(subMatch){match=subMatch;hasSub=true}if(!currentMatch||!currentMatch.isBlock){currentMatch={ctx:ctx,expression:match[1],find:match[0],isBlock:match[1].charAt(0)==="#",start:match.index,startInner:match.index+match[0].length,length:match[0].length}}var fn=(currentMatch.isBlock?mainMatch:match)[1].split(" ")[0].replace("#","");if(helpers[fn]){if(currentMatch.isBlock&&fn===currentMatch.fn){depth++}if(!currentMatch.fn){currentMatch.fn=fn}}var startingElseSection=match[1]==="else";if(currentMatch.isBlock&&currentMatch.fn&&(match[1]==="/".concat(currentMatch.fn)||startingElseSection)){if(!depth){var start=currentMatch.startInner,body=str.substr(start,match.index-start);if(currentMatch.body===void 0){currentMatch.body=body;currentMatch.startInner=match.index+match[0].length}else{currentMatch.elseBody=body}currentMatch.find+=body+match[0];if(!startingElseSection){matches.push(currentMatch);currentMatch=void 0}}else if(!startingElseSection){depth--}}else if(!currentMatch.isBlock){matches.push(currentMatch)}if(subMatch&&!(currentMatch===null||currentMatch===void 0?void 0:currentMatch.isBlock)){break}}matches.forEach(function(match){var body=match.body,elseBody=match.elseBody,expression=match.expression,fn=match.fn;var replacement,i;if(fn){var args=[match],parts=[],len=expression.length;var start=0,startChar=void 0;for(i=0;i<=len;i++){var char=expression.charAt(i);if(!startChar&&(char==='"'||char==="'")){startChar=char}else if(startChar===char){startChar=""}if(!startChar&&(char===" "||i===len)){parts.push(expression.substr(start,i-start));start=i+1}}i=helpers[fn].length;while(i--){args.unshift(resolveProperty(parts[i+1]))}replacement=helpers[fn].apply(ctx,args);if(match.isBlock&&typeof replacement==="boolean"){replacement=format(replacement?body:elseBody,ctx,chart)}}else{var valueAndFormat=expression.split(":");replacement=resolveProperty(valueAndFormat.shift()||"");if(valueAndFormat.length&&typeof replacement==="number"){var segment=valueAndFormat.join(":");if(floatRegex.test(segment)){var decimals=parseInt((segment.match(decRegex)||["","-1"])[1],10);if(replacement!==null){replacement=numberFormatter(replacement,decimals,lang.decimalPoint,segment.indexOf(",")>-1?lang.thousandsSep:"")}}else{replacement=time.dateFormat(segment,replacement);if(hasSub){replacement='"'.concat(replacement,'"')}}}}str=str.replace(match.find,pick(replacement,""))});return hasSub?format(str,ctx,chart):str}function numberFormat(number,decimals,decimalPoint,thousandsSep){var _a,_b,_c;number=+number||0;decimals=+decimals;var ret,fractionDigits,_d=number.toString().split("e").map(Number),mantissa=_d[0],exp=_d[1];var lang=((_a=this===null||this===void 0?void 0:this.options)===null||_a===void 0?void 0:_a.lang)||defaultOptions.lang,origDec=(number.toString().split(".")[1]||"").split("e")[0].length,firstDecimals=decimals,options={};decimalPoint!==null&&decimalPoint!==void 0?decimalPoint:decimalPoint=lang.decimalPoint;thousandsSep!==null&&thousandsSep!==void 0?thousandsSep:thousandsSep=lang.thousandsSep;if(decimals===-1){decimals=Math.min(origDec,20)}else if(!isNumber(decimals)){decimals=2}else if(decimals&&exp<0){fractionDigits=decimals+exp;if(fractionDigits>=0){mantissa=+mantissa.toExponential(fractionDigits).split("e")[0];decimals=fractionDigits}else{mantissa=Math.floor(mantissa);if(decimals<20){number=+(mantissa*Math.pow(10,exp)).toFixed(decimals)}else{number=0}exp=0}}if(exp){decimals!==null&&decimals!==void 0?decimals:decimals=2;number=mantissa}if(isNumber(decimals)&&decimals>=0){options.minimumFractionDigits=decimals;options.maximumFractionDigits=decimals}if(thousandsSep===""){options.useGrouping=false}var hasSeparators=thousandsSep||decimalPoint,locale=hasSeparators?"en":(this===null||this===void 0?void 0:this.locale)||lang.locale||((_b=doc.body.closest("[lang]"))===null||_b===void 0?void 0:_b.lang),cacheKey=JSON.stringify(options)+locale,nf=(_c=numberFormatCache[cacheKey])!==null&&_c!==void 0?_c:numberFormatCache[cacheKey]=new Intl.NumberFormat(locale,options);ret=nf.format(number);if(hasSeparators){ret=ret.replace(/\,/g,thousandsSep!==null&&thousandsSep!==void 0?thousandsSep:",").replace(".",decimalPoint!==null&&decimalPoint!==void 0?decimalPoint:".")}if(!decimals&&+ret===0||exp<0&&!firstDecimals){ret="0"}if(exp&&+ret!==0){ret+="e"+(exp<0?"":"+")+exp}return ret}var Templating={dateFormat:dateFormat,format:format,helpers:helpers,numberFormat:numberFormat};export default Templating;