var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();import SVGElement from"./SVGElement.js";import U from"../../Utilities.js";var defined=U.defined,extend=U.extend,getAlignFactor=U.getAlignFactor,isNumber=U.isNumber,merge=U.merge,pick=U.pick,removeEvent=U.removeEvent;var SVGLabel=function(_super){__extends(SVGLabel,_super);function SVGLabel(renderer,str,x,y,shape,anchorX,anchorY,useHTML,baseline,className){var _this=_super.call(this,renderer,"g")||this;_this.paddingLeftSetter=_this.paddingSetter;_this.paddingRightSetter=_this.paddingSetter;_this.doUpdate=false;_this.textStr=str;_this.x=x;_this.y=y;_this.anchorX=anchorX;_this.anchorY=anchorY;_this.baseline=baseline;_this.className=className;_this.addClass(className==="button"?"highcharts-no-tooltip":"highcharts-label");if(className){_this.addClass("highcharts-"+className)}_this.text=renderer.text(void 0,0,0,useHTML).attr({zIndex:1});var hasBGImage;if(typeof shape==="string"){hasBGImage=/^url\((.*?)\)$/.test(shape);if(hasBGImage||_this.renderer.symbols[shape]){_this.symbolKey=shape}}_this.bBox=SVGLabel.emptyBBox;_this.padding=3;_this.baselineOffset=0;_this.needsBox=renderer.styledMode||hasBGImage;_this.deferredAttr={};_this.alignFactor=0;return _this}SVGLabel.prototype.alignSetter=function(value){var alignFactor=getAlignFactor(value);if(alignFactor!==this.alignFactor){this.alignFactor=alignFactor;if(this.bBox&&isNumber(this.xSetting)){this.attr({x:this.xSetting})}}};SVGLabel.prototype.anchorXSetter=function(value,key){this.anchorX=value;this.boxAttr(key,Math.round(value)-this.getCrispAdjust()-this.xSetting)};SVGLabel.prototype.anchorYSetter=function(value,key){this.anchorY=value;this.boxAttr(key,value-this.ySetting)};SVGLabel.prototype.boxAttr=function(key,value){if(this.box){this.box.attr(key,value)}else{this.deferredAttr[key]=value}};SVGLabel.prototype.css=function(styles){if(styles){var textStyles_1={};styles=merge(styles);SVGLabel.textProps.forEach(function(prop){if(typeof styles[prop]!=="undefined"){textStyles_1[prop]=styles[prop];delete styles[prop]}});this.text.css(textStyles_1);if("fontSize"in textStyles_1||"fontWeight"in textStyles_1){this.updateTextPadding()}else if("width"in textStyles_1||"textOverflow"in textStyles_1){this.updateBoxSize()}}return SVGElement.prototype.css.call(this,styles)};SVGLabel.prototype.destroy=function(){removeEvent(this.element,"mouseenter");removeEvent(this.element,"mouseleave");if(this.text){this.text.destroy()}if(this.box){this.box=this.box.destroy()}SVGElement.prototype.destroy.call(this);return void 0};SVGLabel.prototype.fillSetter=function(value,key){if(value){this.needsBox=true}this.fill=value;this.boxAttr(key,value)};SVGLabel.prototype.getBBox=function(reload,rot){if(this.textStr&&this.bBox.width===0&&this.bBox.height===0){this.updateBoxSize()}var _a=this,padding=_a.padding,_b=_a.height,height=_b===void 0?0:_b,_c=_a.translateX,translateX=_c===void 0?0:_c,_d=_a.translateY,translateY=_d===void 0?0:_d,_e=_a.width,width=_e===void 0?0:_e,paddingLeft=pick(this.paddingLeft,padding),rotation=rot!==null&&rot!==void 0?rot:this.rotation||0;var bBox={width:width,height:height,x:translateX+this.bBox.x-paddingLeft,y:translateY+this.bBox.y-padding+this.baselineOffset};if(rotation){bBox=this.getRotatedBox(bBox,rotation)}return bBox};SVGLabel.prototype.getCrispAdjust=function(){return(this.renderer.styledMode&&this.box?this.box.strokeWidth():this["stroke-width"]?parseInt(this["stroke-width"],10):0)%2/2};SVGLabel.prototype.heightSetter=function(value){this.heightSetting=value;this.doUpdate=true};SVGLabel.prototype.afterSetters=function(){_super.prototype.afterSetters.call(this);if(this.doUpdate){this.updateBoxSize();this.doUpdate=false}};SVGLabel.prototype.onAdd=function(){this.text.add(this);this.attr({text:pick(this.textStr,""),x:this.x||0,y:this.y||0});if(this.box&&defined(this.anchorX)){this.attr({anchorX:this.anchorX,anchorY:this.anchorY})}};SVGLabel.prototype.paddingSetter=function(value,key){if(!isNumber(value)){this[key]=void 0}else if(value!==this[key]){this[key]=value;this.updateTextPadding()}};SVGLabel.prototype.rSetter=function(value,key){this.boxAttr(key,value)};SVGLabel.prototype.strokeSetter=function(value,key){this.stroke=value;this.boxAttr(key,value)};SVGLabel.prototype["stroke-widthSetter"]=function(value,key){if(value){this.needsBox=true}this["stroke-width"]=value;this.boxAttr(key,value)};SVGLabel.prototype["text-alignSetter"]=function(value){this.textAlign=value};SVGLabel.prototype.textSetter=function(text){if(typeof text!=="undefined"){this.text.attr({text:text})}this.updateTextPadding();this.reAlign()};SVGLabel.prototype.updateBoxSize=function(){var text=this.text,attribs={},padding=this.padding,bBox=this.bBox=(!isNumber(this.widthSetting)||!isNumber(this.heightSetting)||this.textAlign)&&defined(text.textStr)?text.getBBox(void 0,0):SVGLabel.emptyBBox;var crispAdjust;this.width=this.getPaddedWidth();this.height=(this.heightSetting||bBox.height||0)+2*padding;var metrics=this.renderer.fontMetrics(text);this.baselineOffset=padding+Math.min((this.text.firstLineMetrics||metrics).b,bBox.height||Infinity);if(this.heightSetting){this.baselineOffset+=(this.heightSetting-metrics.h)/2}if(this.needsBox&&!text.textPath){if(!this.box){var box=this.box=this.symbolKey?this.renderer.symbol(this.symbolKey):this.renderer.rect();box.addClass((this.className==="button"?"":"highcharts-label-box")+(this.className?" highcharts-"+this.className+"-box":""));box.add(this)}crispAdjust=this.getCrispAdjust();attribs.x=crispAdjust;attribs.y=(this.baseline?-this.baselineOffset:0)+crispAdjust;attribs.width=Math.round(this.width);attribs.height=Math.round(this.height);this.box.attr(extend(attribs,this.deferredAttr));this.deferredAttr={}}};SVGLabel.prototype.updateTextPadding=function(){var _a;var text=this.text;if(!text.textPath){this.updateBoxSize();var textY=this.baseline?0:this.baselineOffset,textX=((_a=this.paddingLeft)!==null&&_a!==void 0?_a:this.padding)+(defined(this.widthSetting)&&this.bBox?getAlignFactor(this.textAlign)*(this.widthSetting-this.bBox.width):0);if(textX!==text.x||textY!==text.y){text.attr("x",textX);if(text.hasBoxWidthChanged){this.bBox=text.getBBox(true)}if(typeof textY!=="undefined"){text.attr("y",textY)}}text.x=textX;text.y=textY}};SVGLabel.prototype.widthSetter=function(value){this.widthSetting=isNumber(value)?value:void 0;this.doUpdate=true};SVGLabel.prototype.getPaddedWidth=function(){var padding=this.padding;var paddingLeft=pick(this.paddingLeft,padding);var paddingRight=pick(this.paddingRight,padding);return(this.widthSetting||this.bBox.width||0)+paddingLeft+paddingRight};SVGLabel.prototype.xSetter=function(value){this.x=value;if(this.alignFactor){value-=this.alignFactor*this.getPaddedWidth();this["forceAnimate:x"]=true}this.xSetting=Math.round(value);this.attr("translateX",this.xSetting)};SVGLabel.prototype.ySetter=function(value){this.ySetting=this.y=Math.round(value);this.attr("translateY",this.ySetting)};SVGLabel.emptyBBox={width:0,height:0,x:0,y:0};SVGLabel.textProps=["color","direction","fontFamily","fontSize","fontStyle","fontWeight","lineClamp","lineHeight","textAlign","textDecoration","textOutline","textOverflow","whiteSpace","width"];return SVGLabel}(SVGElement);export default SVGLabel;