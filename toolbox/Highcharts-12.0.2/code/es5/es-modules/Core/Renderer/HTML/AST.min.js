"use strict";import H from"../../Globals.js";var SVG_NS=H.SVG_NS,win=H.win;import U from"../../Utilities.js";var attr=U.attr,createElement=U.createElement,css=U.css,error=U.error,isFunction=U.isFunction,isString=U.isString,objectEach=U.objectEach,splat=U.splat;var trustedTypes=win.trustedTypes;var trustedTypesPolicy=trustedTypes&&isFunction(trustedTypes.createPolicy)&&trustedTypes.createPolicy("highcharts",{createHTML:function(s){return s}});var emptyHTML=trustedTypesPolicy?trustedTypesPolicy.createHTML(""):"";var AST=function(){function AST(source){this.nodes=typeof source==="string"?this.parseMarkup(source):source}AST.filterUserAttributes=function(attributes){objectEach(attributes,function(val,key){var valid=true;if(AST.allowedAttributes.indexOf(key)===-1){valid=false}if(["background","dynsrc","href","lowsrc","src"].indexOf(key)!==-1){valid=isString(val)&&AST.allowedReferences.some(function(ref){return val.indexOf(ref)===0})}if(!valid){error(33,false,void 0,{"Invalid attribute in config":"".concat(key)});delete attributes[key]}if(isString(val)&&attributes[key]){attributes[key]=val.replace(/</g,"&lt;")}});return attributes};AST.parseStyle=function(style){return style.split(";").reduce(function(styles,line){var pair=line.split(":").map(function(s){return s.trim()}),key=pair.shift();if(key&&pair.length){styles[key.replace(/-([a-z])/g,function(g){return g[1].toUpperCase()})]=pair.join(":")}return styles},{})};AST.setElementHTML=function(el,html){el.innerHTML=AST.emptyHTML;if(html){var ast=new AST(html);ast.addToDOM(el)}};AST.prototype.addToDOM=function(parent){function recurse(subtree,subParent){var ret;splat(subtree).forEach(function(item){var tagName=item.tagName;var textNode=item.textContent?H.doc.createTextNode(item.textContent):void 0;var bypassHTMLFiltering=AST.bypassHTMLFiltering;var node;if(tagName){if(tagName==="#text"){node=textNode}else if(AST.allowedTags.indexOf(tagName)!==-1||bypassHTMLFiltering){var NS=tagName==="svg"?SVG_NS:subParent.namespaceURI||SVG_NS;var element=H.doc.createElementNS(NS,tagName);var attributes_1=item.attributes||{};objectEach(item,function(val,key){if(key!=="tagName"&&key!=="attributes"&&key!=="children"&&key!=="style"&&key!=="textContent"){attributes_1[key]=val}});attr(element,bypassHTMLFiltering?attributes_1:AST.filterUserAttributes(attributes_1));if(item.style){css(element,item.style)}if(textNode){element.appendChild(textNode)}recurse(item.children||[],element);node=element}else{error(33,false,void 0,{"Invalid tagName in config":tagName})}}if(node){subParent.appendChild(node)}ret=node});return ret}return recurse(this.nodes,parent)};AST.prototype.parseMarkup=function(markup){var nodes=[];markup=markup.trim().replace(/ style=(["'])/g," data-style=$1");var doc;try{doc=(new DOMParser).parseFromString(trustedTypesPolicy?trustedTypesPolicy.createHTML(markup):markup,"text/html")}catch(e){}if(!doc){var body=createElement("div");body.innerHTML=markup;doc={body:body}}var appendChildNodes=function(node,addTo){var tagName=node.nodeName.toLowerCase();var astNode={tagName:tagName};if(tagName==="#text"){astNode.textContent=node.textContent||""}var parsedAttributes=node.attributes;if(parsedAttributes){var attributes_2={};[].forEach.call(parsedAttributes,function(attrib){if(attrib.name==="data-style"){astNode.style=AST.parseStyle(attrib.value)}else{attributes_2[attrib.name]=attrib.value}});astNode.attributes=attributes_2}if(node.childNodes.length){var children_1=[];[].forEach.call(node.childNodes,function(childNode){appendChildNodes(childNode,children_1)});if(children_1.length){astNode.children=children_1}}addTo.push(astNode)};[].forEach.call(doc.body.childNodes,function(childNode){return appendChildNodes(childNode,nodes)});return nodes};AST.allowedAttributes=["alt","aria-controls","aria-describedby","aria-expanded","aria-haspopup","aria-hidden","aria-label","aria-labelledby","aria-live","aria-pressed","aria-readonly","aria-roledescription","aria-selected","class","clip-path","color","colspan","cx","cy","d","dx","dy","disabled","fill","filterUnits","flood-color","flood-opacity","height","href","id","in","in2","markerHeight","markerWidth","offset","opacity","operator","orient","padding","paddingLeft","paddingRight","patternUnits","r","radius","refX","refY","role","scope","slope","src","startOffset","stdDeviation","stroke","stroke-linecap","stroke-width","style","tableValues","result","rowspan","summary","target","tabindex","text-align","text-anchor","textAnchor","textLength","title","type","valign","width","x","x1","x2","xlink:href","y","y1","y2","zIndex"];AST.allowedReferences=["https://","http://","mailto:","/","../","./","#"];AST.allowedTags=["a","abbr","b","br","button","caption","circle","clipPath","code","dd","defs","div","dl","dt","em","feComponentTransfer","feComposite","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMorphology","feOffset","feMerge","feMergeNode","filter","h1","h2","h3","h4","h5","h6","hr","i","img","li","linearGradient","marker","ol","p","path","pattern","pre","rect","small","span","stop","strong","style","sub","sup","svg","table","text","textPath","thead","title","tbody","tspan","td","th","tr","u","ul","#text"];AST.emptyHTML=emptyHTML;AST.bypassHTMLFiltering=false;return AST}();export default AST;"";