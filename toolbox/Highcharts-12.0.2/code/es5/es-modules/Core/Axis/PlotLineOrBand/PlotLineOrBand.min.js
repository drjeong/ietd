"use strict";var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};import PlotLineOrBandAxis from"./PlotLineOrBandAxis.js";import U from"../../Utilities.js";var addEvent=U.addEvent,arrayMax=U.arrayMax,arrayMin=U.arrayMin,defined=U.defined,destroyObjectProperties=U.destroyObjectProperties,erase=U.erase,fireEvent=U.fireEvent,merge=U.merge,objectEach=U.objectEach,pick=U.pick;var PlotLineOrBand=function(){function PlotLineOrBand(axis,options){this.axis=axis;this.options=options;this.id=options.id}PlotLineOrBand.compose=function(ChartClass,AxisClass){addEvent(ChartClass,"afterInit",function(){var _this=this;this.labelCollectors.push(function(){var _a;var labels=[];for(var _i=0,_b=_this.axes;_i<_b.length;_i++){var axis=_b[_i];for(var _c=0,_d=axis.plotLinesAndBands;_c<_d.length;_c++){var _e=_d[_c],label=_e.label,options=_e.options;if(label&&!((_a=options===null||options===void 0?void 0:options.label)===null||_a===void 0?void 0:_a.allowOverlap)){labels.push(label)}}}return labels})});return PlotLineOrBandAxis.compose(PlotLineOrBand,AxisClass)};PlotLineOrBand.prototype.render=function(){var _this=this;var _a,_b,_c;fireEvent(this,"render");var _d=this,axis=_d.axis,options=_d.options,horiz=axis.horiz,logarithmic=axis.logarithmic,color=options.color,events=options.events,_e=options.zIndex,zIndex=_e===void 0?0:_e,_f=axis.chart,renderer=_f.renderer,time=_f.time,groupAttribs={},to=time.parse(options.to),from=time.parse(options.from),value=time.parse(options.value),borderWidth=options.borderWidth;var optionsLabel=options.label,_g=this,label=_g.label,svgElem=_g.svgElem,path=[],group;var isBand=defined(from)&&defined(to),isLine=defined(value),isNew=!svgElem,attribs={class:"highcharts-plot-"+(isBand?"band ":"line ")+(options.className||"")};var groupName=isBand?"bands":"lines";if(!axis.chart.styledMode){if(isLine){attribs.stroke=color||"#999999";attribs["stroke-width"]=pick(options.width,1);if(options.dashStyle){attribs.dashstyle=options.dashStyle}}else if(isBand){attribs.fill=color||"#e6e9ff";if(borderWidth){attribs.stroke=options.borderColor;attribs["stroke-width"]=borderWidth}}}groupAttribs.zIndex=zIndex;groupName+="-"+zIndex;group=axis.plotLinesAndBandsGroups[groupName];if(!group){axis.plotLinesAndBandsGroups[groupName]=group=renderer.g("plot-"+groupName).attr(groupAttribs).add()}if(!svgElem){this.svgElem=svgElem=renderer.path().attr(attribs).add(group)}if(defined(value)){path=axis.getPlotLinePath({value:(_a=logarithmic===null||logarithmic===void 0?void 0:logarithmic.log2lin(value))!==null&&_a!==void 0?_a:value,lineWidth:svgElem.strokeWidth(),acrossPanes:options.acrossPanes})}else if(defined(from)&&defined(to)){path=axis.getPlotBandPath((_b=logarithmic===null||logarithmic===void 0?void 0:logarithmic.log2lin(from))!==null&&_b!==void 0?_b:from,(_c=logarithmic===null||logarithmic===void 0?void 0:logarithmic.log2lin(to))!==null&&_c!==void 0?_c:to,options)}else{return}if(!this.eventsAdded&&events){objectEach(events,function(event,eventType){svgElem===null||svgElem===void 0?void 0:svgElem.on(eventType,function(e){events[eventType].apply(_this,[e])})});this.eventsAdded=true}if((isNew||!svgElem.d)&&(path===null||path===void 0?void 0:path.length)){svgElem.attr({d:path})}else if(svgElem){if(path){svgElem.show();svgElem.animate({d:path})}else if(svgElem.d){svgElem.hide();if(label){this.label=label=label.destroy()}}}if(optionsLabel&&(defined(optionsLabel.text)||defined(optionsLabel.formatter))&&(path===null||path===void 0?void 0:path.length)&&axis.width>0&&axis.height>0&&!path.isFlat){optionsLabel=merge(__assign({align:horiz&&isBand?"center":void 0,x:horiz?!isBand&&4:10,verticalAlign:!horiz&&isBand?"middle":void 0,y:horiz?isBand?16:10:isBand?6:-4,rotation:horiz&&!isBand?90:0},isBand?{inside:true}:{}),optionsLabel);this.renderLabel(optionsLabel,path,isBand,zIndex)}else if(label){label.hide()}return this};PlotLineOrBand.prototype.renderLabel=function(optionsLabel,path,isBand,zIndex){var _a;var plotLine=this,axis=plotLine.axis,renderer=axis.chart.renderer,inside=optionsLabel.inside;var label=plotLine.label;if(!label){plotLine.label=label=renderer.text(this.getLabelText(optionsLabel),0,0,optionsLabel.useHTML).attr({align:optionsLabel.textAlign||optionsLabel.align,rotation:optionsLabel.rotation,class:"highcharts-plot-"+(isBand?"band":"line")+"-label "+(optionsLabel.className||""),zIndex:zIndex});if(!axis.chart.styledMode){label.css(merge({fontSize:"0.8em",textOverflow:isBand&&!inside?"":"ellipsis"},optionsLabel.style))}label.add()}var xBounds=path.xBounds||[path[0][1],path[1][1],isBand?path[2][1]:path[0][1]],yBounds=path.yBounds||[path[0][2],path[1][2],isBand?path[2][2]:path[0][2]],x=arrayMin(xBounds),y=arrayMin(yBounds),bBoxWidth=arrayMax(xBounds)-x;label.align(optionsLabel,false,{x:x,y:y,width:bBoxWidth,height:arrayMax(yBounds)-y});if(!label.alignValue||label.alignValue==="left"||defined(inside)){label.css({width:(((_a=optionsLabel.style)===null||_a===void 0?void 0:_a.width)||(!isBand||!inside?label.rotation===90?axis.height-(label.alignAttr.y-axis.top):(optionsLabel.clip?axis.width:axis.chart.chartWidth)-(label.alignAttr.x-axis.left):bBoxWidth))+"px"})}label.show(true)};PlotLineOrBand.prototype.getLabelText=function(optionsLabel){return defined(optionsLabel.formatter)?optionsLabel.formatter.call(this):optionsLabel.text};PlotLineOrBand.prototype.destroy=function(){erase(this.axis.plotLinesAndBands,this);delete this.axis;destroyObjectProperties(this)};return PlotLineOrBand}();export default PlotLineOrBand;"";"";