(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory(root["_Highcharts"],root["_Highcharts"]["SeriesRegistry"],root["_Highcharts"]["Point"],root["_Highcharts"]["Color"],root["_Highcharts"]["SVGElement"]);else if(typeof define==="function"&&define.amd)define("highcharts/modules/sankey",["highcharts/highcharts"],function(amd1){return factory(amd1,amd1["SeriesRegistry"],amd1["Point"],amd1["Color"],amd1["SVGElement"])});else if(typeof exports==="object")exports["highcharts/modules/sankey"]=factory(root["_Highcharts"],root["_Highcharts"]["SeriesRegistry"],root["_Highcharts"]["Point"],root["_Highcharts"]["Color"],root["_Highcharts"]["SVGElement"]);else root["Highcharts"]=factory(root["Highcharts"],root["Highcharts"]["SeriesRegistry"],root["Highcharts"]["Point"],root["Highcharts"]["Color"],root["Highcharts"]["SVGElement"])})(typeof window==="undefined"?this:window,(__WEBPACK_EXTERNAL_MODULE__944__,__WEBPACK_EXTERNAL_MODULE__512__,__WEBPACK_EXTERNAL_MODULE__260__,__WEBPACK_EXTERNAL_MODULE__620__,__WEBPACK_EXTERNAL_MODULE__28__)=>{return(()=>{"use strict";var __webpack_modules__={620:module=>{module.exports=__WEBPACK_EXTERNAL_MODULE__620__},260:module=>{module.exports=__WEBPACK_EXTERNAL_MODULE__260__},28:module=>{module.exports=__WEBPACK_EXTERNAL_MODULE__28__},512:module=>{module.exports=__WEBPACK_EXTERNAL_MODULE__512__},944:module=>{module.exports=__WEBPACK_EXTERNAL_MODULE__944__}};var __webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(cachedModule!==undefined){return cachedModule.exports}var module=__webpack_module_cache__[moduleId]={exports:{}};__webpack_modules__[moduleId](module,module.exports,__webpack_require__);return module.exports}(()=>{__webpack_require__.n=module=>{var getter=module&&module.__esModule?()=>module["default"]:()=>module;__webpack_require__.d(getter,{a:getter});return getter}})();(()=>{__webpack_require__.d=(exports,definition)=>{for(var key in definition){if(__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)){Object.defineProperty(exports,key,{enumerable:true,get:definition[key]})}}}})();(()=>{__webpack_require__.o=(obj,prop)=>Object.prototype.hasOwnProperty.call(obj,prop)})();var __webpack_exports__={};__webpack_require__.d(__webpack_exports__,{default:()=>sankey_src});var highcharts_commonjs_highcharts_commonjs2_highcharts_root_Highcharts_=__webpack_require__(944);var highcharts_commonjs_highcharts_commonjs2_highcharts_root_Highcharts_default=__webpack_require__.n(highcharts_commonjs_highcharts_commonjs2_highcharts_root_Highcharts_);var highcharts_SeriesRegistry_commonjs_highcharts_SeriesRegistry_commonjs2_highcharts_SeriesRegistry_root_Highcharts_SeriesRegistry_=__webpack_require__(512);var highcharts_SeriesRegistry_commonjs_highcharts_SeriesRegistry_commonjs2_highcharts_SeriesRegistry_root_Highcharts_SeriesRegistry_default=__webpack_require__.n(highcharts_SeriesRegistry_commonjs_highcharts_SeriesRegistry_commonjs2_highcharts_SeriesRegistry_root_Highcharts_SeriesRegistry_);const{series:{prototype:seriesProto,prototype:{pointClass:{prototype:pointProto}}}}=highcharts_SeriesRegistry_commonjs_highcharts_SeriesRegistry_commonjs2_highcharts_SeriesRegistry_root_Highcharts_SeriesRegistry_default();const{defined,extend,find,merge,pick}=highcharts_commonjs_highcharts_commonjs2_highcharts_root_Highcharts_default();var NodesComposition;(function(NodesComposition){function compose(PointClass,SeriesClass){const pointProto=PointClass.prototype,seriesProto=SeriesClass.prototype;pointProto.setNodeState=setNodeState;pointProto.setState=setNodeState;pointProto.update=updateNode;seriesProto.destroy=destroy;seriesProto.setData=setData;return SeriesClass}NodesComposition.compose=compose;function createNode(id){const PointClass=this.pointClass,findById=(nodes,id)=>find(nodes,node=>node.id===id);let node=findById(this.nodes,id),options;if(!node){options=this.options.nodes&&findById(this.options.nodes,id);const newNode=new PointClass(this,extend({className:"highcharts-node",isNode:true,id:id,y:1},options));newNode.linksTo=[];newNode.linksFrom=[];newNode.getSum=function(){let sumTo=0,sumFrom=0;newNode.linksTo.forEach(link=>{sumTo+=link.weight||0});newNode.linksFrom.forEach(link=>{sumFrom+=link.weight||0});return Math.max(sumTo,sumFrom)};newNode.offset=function(point,coll){let offset=0;for(let i=0;i<newNode[coll].length;i++){if(newNode[coll][i]===point){return offset}offset+=newNode[coll][i].weight}};newNode.hasShape=function(){let outgoing=0;newNode.linksTo.forEach(link=>{if(link.outgoing){outgoing++}});return!newNode.linksTo.length||outgoing!==newNode.linksTo.length};newNode.index=this.nodes.push(newNode)-1;node=newNode}node.formatPrefix="node";node.name=node.name||node.options.id||"";node.mass=pick(node.options.mass,node.options.marker&&node.options.marker.radius,this.options.marker&&this.options.marker.radius,4);return node}NodesComposition.createNode=createNode;function destroy(){this.data=[].concat(this.points||[],this.nodes);return seriesProto.destroy.apply(this,arguments)}NodesComposition.destroy=destroy;function generatePoints(){const chart=this.chart,nodeLookup={};seriesProto.generatePoints.call(this);if(!this.nodes){this.nodes=[]}this.colorCounter=0;this.nodes.forEach(node=>{node.linksFrom.length=0;node.linksTo.length=0;node.level=node.options.level});this.points.forEach(point=>{if(defined(point.from)){if(!nodeLookup[point.from]){nodeLookup[point.from]=this.createNode(point.from)}nodeLookup[point.from].linksFrom.push(point);point.fromNode=nodeLookup[point.from];if(chart.styledMode){point.colorIndex=pick(point.options.colorIndex,nodeLookup[point.from].colorIndex)}else{point.color=point.options.color||nodeLookup[point.from].color}}if(defined(point.to)){if(!nodeLookup[point.to]){nodeLookup[point.to]=this.createNode(point.to)}nodeLookup[point.to].linksTo.push(point);point.toNode=nodeLookup[point.to]}point.name=point.name||point.id},this);this.nodeLookup=nodeLookup}NodesComposition.generatePoints=generatePoints;function setData(){if(this.nodes){this.nodes.forEach(node=>{node.destroy()});this.nodes.length=0}seriesProto.setData.apply(this,arguments)}function setNodeState(state){const args=arguments,others=this.isNode?this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];if(state!=="select"){others.forEach(linkOrNode=>{if(linkOrNode&&linkOrNode.series){pointProto.setState.apply(linkOrNode,args);if(!linkOrNode.isNode){if(linkOrNode.fromNode.graphic){pointProto.setState.apply(linkOrNode.fromNode,args)}if(linkOrNode.toNode&&linkOrNode.toNode.graphic){pointProto.setState.apply(linkOrNode.toNode,args)}}}})}pointProto.setState.apply(this,args)}NodesComposition.setNodeState=setNodeState;function updateNode(options,redraw,animation,runEvent){const nodes=this.series.options.nodes,data=this.series.options.data,dataLength=data?.length||0,linkConfig=data?.[this.index];pointProto.update.call(this,options,this.isNode?false:redraw,animation,runEvent);if(this.isNode){const nodeIndex=(nodes||[]).reduce((prevIndex,n,index)=>this.id===n.id?index:prevIndex,-1),nodeConfig=merge(nodes&&nodes[nodeIndex]||{},data?.[this.index]||{});if(data){if(linkConfig){data[this.index]=linkConfig}else{data.length=dataLength}}if(nodes){if(nodeIndex>=0){nodes[nodeIndex]=nodeConfig}else{nodes.push(nodeConfig)}}else{this.series.options.nodes=[nodeConfig]}if(pick(redraw,true)){this.series.chart.redraw(animation)}}}NodesComposition.updateNode=updateNode})(NodesComposition||(NodesComposition={}));const Series_NodesComposition=NodesComposition;var highcharts_Point_commonjs_highcharts_Point_commonjs2_highcharts_Point_root_Highcharts_Point_=__webpack_require__(260);var highcharts_Point_commonjs_highcharts_Point_commonjs2_highcharts_Point_root_Highcharts_Point_default=__webpack_require__.n(highcharts_Point_commonjs_highcharts_Point_commonjs2_highcharts_Point_root_Highcharts_Point_);const{column:ColumnSeries}=highcharts_SeriesRegistry_commonjs_highcharts_SeriesRegistry_commonjs2_highcharts_SeriesRegistry_root_Highcharts_SeriesRegistry_default().seriesTypes;const{defined:SankeyPoint_defined}=highcharts_commonjs_highcharts_commonjs2_highcharts_root_Highcharts_default();class SankeyPoint extends ColumnSeries.prototype.pointClass{applyOptions(options,x){highcharts_Point_commonjs_highcharts_Point_commonjs2_highcharts_Point_root_Highcharts_Point_default().prototype.applyOptions.call(this,options,x);if(SankeyPoint_defined(this.options.level)){this.options.column=this.column=this.options.level}return this}getClassName(){return(this.isNode?"highcharts-node ":"highcharts-link ")+highcharts_Point_commonjs_highcharts_Point_commonjs2_highcharts_Point_root_Highcharts_Point_default().prototype.getClassName.call(this)}getFromNode(){const node=this;let fromColumn=-1,fromNode;for(let i=0;i<node.linksTo.length;i++){const point=node.linksTo[i];if(point.fromNode.column>fromColumn&&point.fromNode!==node){fromNode=point.fromNode;fromColumn=fromNode.column}}return{fromNode:fromNode,fromColumn:fromColumn}}setNodeColumn(){const node=this;if(!SankeyPoint_defined(node.options.column)){if(node.linksTo.length===0){node.column=0}else{node.column=node.getFromNode().fromColumn+1}}}isValid(){return this.isNode||typeof this.weight==="number"}}const Sankey_SankeyPoint=SankeyPoint;const SankeySeriesDefaults={borderWidth:0,colorByPoint:true,curveFactor:.33,dataLabels:{enabled:true,backgroundColor:"none",crop:false,nodeFormat:void 0,nodeFormatter:function(){return this.point.name},format:void 0,formatter:function(){return},inside:true},inactiveOtherPoints:true,linkColorMode:"from",linkOpacity:.5,opacity:1,minLinkWidth:0,nodeAlignment:"center",nodeWidth:20,nodePadding:10,nodeDistance:30,showInLegend:false,states:{hover:{linkOpacity:1,opacity:1},inactive:{linkOpacity:.1,opacity:.1,animation:{duration:50}}},tooltip:{followPointer:true,headerFormat:'<span style="font-size: 0.8em">{series.name}</span><br/>',pointFormat:"{point.fromNode.name} → {point.toNode.name}: <b>{point.weight}</b><br/>",nodeFormat:"{point.name}: <b>{point.sum}</b><br/>"}};"";const Sankey_SankeySeriesDefaults=SankeySeriesDefaults;const{defined:SankeyColumnComposition_defined,getAlignFactor,relativeLength}=highcharts_commonjs_highcharts_commonjs2_highcharts_root_Highcharts_default();var SankeyColumnComposition;(function(SankeyColumnComposition){function compose(points,series){const sankeyColumnArray=points;sankeyColumnArray.sankeyColumn=new SankeyColumnAdditions(sankeyColumnArray,series);return sankeyColumnArray}SankeyColumnComposition.compose=compose;class SankeyColumnAdditions{constructor(points,series){this.points=points;this.series=series}getTranslationFactor(series){const column=this.points,nodes=column.slice(),chart=series.chart,minLinkWidth=series.options.minLinkWidth||0;let skipPoint,factor=0,i,remainingHeight=(chart.plotSizeY||0)-(series.options.borderWidth||0)-(column.length-1)*series.nodePadding;while(column.length){factor=remainingHeight/column.sankeyColumn.sum();skipPoint=false;i=column.length;while(i--){if(column[i].getSum()*factor<minLinkWidth){column.splice(i,1);remainingHeight=Math.max(0,remainingHeight-minLinkWidth);skipPoint=true}}if(!skipPoint){break}}column.length=0;for(const node of nodes){column.push(node)}return factor}top(factor){const series=this.series,nodePadding=series.nodePadding,height=this.points.reduce((height,node)=>{if(height>0){height+=nodePadding}const nodeHeight=Math.max(node.getSum()*factor,series.options.minLinkWidth||0);height+=nodeHeight;return height},0);return getAlignFactor(series.options.nodeAlignment||"center")*((series.chart.plotSizeY||0)-height)}left(factor){const series=this.series,chart=series.chart,equalNodes=series.options.equalNodes,maxNodesLength=chart.inverted?chart.plotHeight:chart.plotWidth,nodePadding=series.nodePadding,width=this.points.reduce((width,node)=>{if(width>0){width+=nodePadding}const nodeWidth=equalNodes?maxNodesLength/node.series.nodes.length-nodePadding:Math.max(node.getSum()*factor,series.options.minLinkWidth||0);width+=nodeWidth;return width},0);return((chart.plotSizeX||0)-Math.round(width))/2}sum(){return this.points.reduce((sum,node)=>sum+node.getSum(),0)}offset(node,factor){const column=this.points,series=this.series,nodePadding=series.nodePadding;let offset=0,totalNodeOffset;if(series.is("organization")&&node.hangsFrom){return{absoluteTop:node.hangsFrom.nodeY}}for(let i=0;i<column.length;i++){const sum=column[i].getSum();const height=Math.max(sum*factor,series.options.minLinkWidth||0);const directionOffset=node.options[series.chart.inverted?"offsetHorizontal":"offsetVertical"],optionOffset=node.options.offset||0;if(sum){totalNodeOffset=height+nodePadding}else{totalNodeOffset=0}if(column[i]===node){return{relativeTop:offset+(SankeyColumnComposition_defined(directionOffset)?relativeLength(directionOffset,height):relativeLength(optionOffset,totalNodeOffset))}}offset+=totalNodeOffset}}}SankeyColumnComposition.SankeyColumnAdditions=SankeyColumnAdditions})(SankeyColumnComposition||(SankeyColumnComposition={}));const Sankey_SankeyColumnComposition=SankeyColumnComposition;var highcharts_Color_commonjs_highcharts_Color_commonjs2_highcharts_Color_root_Highcharts_Color_=__webpack_require__(620);var highcharts_Color_commonjs_highcharts_Color_commonjs2_highcharts_Color_root_Highcharts_Color_default=__webpack_require__.n(highcharts_Color_commonjs_highcharts_Color_commonjs2_highcharts_Color_root_Highcharts_Color_);const{extend:TreeUtilities_extend,isArray,isNumber,isObject,merge:TreeUtilities_merge,pick:TreeUtilities_pick,relativeLength:TreeUtilities_relativeLength}=highcharts_commonjs_highcharts_commonjs2_highcharts_root_Highcharts_default();function getColor(node,options){const index=options.index,mapOptionsToLevel=options.mapOptionsToLevel,parentColor=options.parentColor,parentColorIndex=options.parentColorIndex,series=options.series,colors=options.colors,siblings=options.siblings,points=series.points,chartOptionsChart=series.chart.options.chart;let getColorByPoint,point,level,colorByPoint,colorIndexByPoint,color,colorIndex;const variateColor=color=>{const colorVariation=level&&level.colorVariation;if(colorVariation&&colorVariation.key==="brightness"&&index&&siblings){return highcharts_Color_commonjs_highcharts_Color_commonjs2_highcharts_Color_root_Highcharts_Color_default().parse(color).brighten(colorVariation.to*(index/siblings)).get()}return color};if(node){point=points[node.i];level=mapOptionsToLevel[node.level]||{};getColorByPoint=point&&level.colorByPoint;if(getColorByPoint){colorIndexByPoint=point.index%(colors?colors.length:chartOptionsChart.colorCount);colorByPoint=colors&&colors[colorIndexByPoint]}if(!series.chart.styledMode){color=TreeUtilities_pick(point&&point.options.color,level&&level.color,colorByPoint,parentColor&&variateColor(parentColor),series.color)}colorIndex=TreeUtilities_pick(point&&point.options.colorIndex,level&&level.colorIndex,colorIndexByPoint,parentColorIndex,options.colorIndex)}return{color:color,colorIndex:colorIndex}}function getLevelOptions(params){const result={};let defaults,converted,i,from,to,levels;if(isObject(params)){from=isNumber(params.from)?params.from:1;levels=params.levels;converted={};defaults=isObject(params.defaults)?params.defaults:{};if(isArray(levels)){converted=levels.reduce((obj,item)=>{let level,levelIsConstant,options;if(isObject(item)&&isNumber(item.level)){options=TreeUtilities_merge({},item);levelIsConstant=TreeUtilities_pick(options.levelIsConstant,defaults.levelIsConstant);delete options.levelIsConstant;delete options.level;level=item.level+(levelIsConstant?0:from-1);if(isObject(obj[level])){TreeUtilities_merge(true,obj[level],options)}else{obj[level]=options}}return obj},{})}to=isNumber(params.to)?params.to:1;for(i=0;i<=to;i++){result[i]=TreeUtilities_merge({},defaults,isObject(converted[i])?converted[i]:{})}}return result}function setTreeValues(tree,options){const before=options.before,idRoot=options.idRoot,mapIdToNode=options.mapIdToNode,nodeRoot=mapIdToNode[idRoot],levelIsConstant=options.levelIsConstant!==false,points=options.points,point=points[tree.i],optionsPoint=point&&point.options||{},children=[];let childrenTotal=0;tree.levelDynamic=tree.level-(levelIsConstant?0:nodeRoot.level);tree.name=TreeUtilities_pick(point&&point.name,"");tree.visible=idRoot===tree.id||options.visible===true;if(typeof before==="function"){tree=before(tree,options)}tree.children.forEach((child,i)=>{const newOptions=TreeUtilities_extend({},options);TreeUtilities_extend(newOptions,{index:i,siblings:tree.children.length,visible:tree.visible});child=setTreeValues(child,newOptions);children.push(child);if(child.visible){childrenTotal+=child.val}});const value=TreeUtilities_pick(optionsPoint.value,childrenTotal);tree.visible=value>=0&&(childrenTotal>0||tree.visible);tree.children=children;tree.childrenTotal=childrenTotal;tree.isLeaf=tree.visible&&!childrenTotal;tree.val=value;return tree}function updateRootId(series){let rootId,options;if(isObject(series)){options=isObject(series.options)?series.options:{};rootId=TreeUtilities_pick(series.rootNode,options.rootId,"");if(isObject(series.userOptions)){series.userOptions.rootId=rootId}series.rootNode=rootId}return rootId}function getNodeWidth(series,columnCount){const{chart,options}=series,{nodeDistance=0,nodeWidth=0}=options,{plotSizeX=1}=chart;if(nodeWidth==="auto"){if(typeof nodeDistance==="string"&&/%$/.test(nodeDistance)){const fraction=parseFloat(nodeDistance)/100,total=columnCount+fraction*(columnCount-1);return plotSizeX/total}const nDistance=Number(nodeDistance);return(plotSizeX+nDistance)/(columnCount||1)-nDistance}return TreeUtilities_relativeLength(nodeWidth,plotSizeX)}const TreeUtilities={getColor:getColor,getLevelOptions:getLevelOptions,getNodeWidth:getNodeWidth,setTreeValues:setTreeValues,updateRootId:updateRootId};const Series_TreeUtilities=TreeUtilities;var highcharts_SVGElement_commonjs_highcharts_SVGElement_commonjs2_highcharts_SVGElement_root_Highcharts_SVGElement_=__webpack_require__(28);var highcharts_SVGElement_commonjs_highcharts_SVGElement_commonjs2_highcharts_SVGElement_root_Highcharts_SVGElement_default=__webpack_require__.n(highcharts_SVGElement_commonjs_highcharts_SVGElement_commonjs2_highcharts_SVGElement_root_Highcharts_SVGElement_);const{deg2rad}=highcharts_commonjs_highcharts_commonjs2_highcharts_root_Highcharts_default();const{addEvent,merge:TextPath_merge,uniqueKey,defined:TextPath_defined,extend:TextPath_extend}=highcharts_commonjs_highcharts_commonjs2_highcharts_root_Highcharts_default();function setTextPath(path,textPathOptions){textPathOptions=TextPath_merge(true,{enabled:true,attributes:{dy:-5,startOffset:"50%",textAnchor:"middle"}},textPathOptions);const url=this.renderer.url,textWrapper=this.text||this,textPath=textWrapper.textPath,{attributes,enabled}=textPathOptions;path=path||textPath&&textPath.path;if(textPath){textPath.undo()}if(path&&enabled){const undo=addEvent(textWrapper,"afterModifyTree",e=>{if(path&&enabled){let textPathId=path.attr("id");if(!textPathId){path.attr("id",textPathId=uniqueKey())}const textAttribs={x:0,y:0};if(TextPath_defined(attributes.dx)){textAttribs.dx=attributes.dx;delete attributes.dx}if(TextPath_defined(attributes.dy)){textAttribs.dy=attributes.dy;delete attributes.dy}textWrapper.attr(textAttribs);this.attr({transform:""});if(this.box){this.box=this.box.destroy()}const children=e.nodes.slice(0);e.nodes.length=0;e.nodes[0]={tagName:"textPath",attributes:TextPath_extend(attributes,{"text-anchor":attributes.textAnchor,href:`${url}#${textPathId}`}),children:children}}});textWrapper.textPath={path:path,undo:undo}}else{textWrapper.attr({dx:0,dy:0});delete textWrapper.textPath}if(this.added){textWrapper.textCache="";this.renderer.buildText(textWrapper)}return this}function setPolygon(event){const bBox=event.bBox,tp=this.element?.querySelector("textPath");if(tp){const polygon=[],{b,h}=this.renderer.fontMetrics(this.element),descender=h-b,lineCleanerRegex=new RegExp("(<tspan>|"+'<tspan(?!\\sclass="highcharts-br")[^>]*>|'+"<\\/tspan>)","g"),lines=tp.innerHTML.replace(lineCleanerRegex,"").split(/<tspan class="highcharts-br"[^>]*>/),numOfLines=lines.length;const appendTopAndBottom=(charIndex,positionOfChar)=>{const{x,y}=positionOfChar,rotation=(tp.getRotationOfChar(charIndex)-90)*deg2rad,cosRot=Math.cos(rotation),sinRot=Math.sin(rotation);return[[x-descender*cosRot,y-descender*sinRot],[x+b*cosRot,y+b*sinRot]]};for(let i=0,lineIndex=0;lineIndex<numOfLines;lineIndex++){const line=lines[lineIndex],lineLen=line.length;for(let lineCharIndex=0;lineCharIndex<lineLen;lineCharIndex+=5){try{const srcCharIndex=i+lineCharIndex+lineIndex,[lower,upper]=appendTopAndBottom(srcCharIndex,tp.getStartPositionOfChar(srcCharIndex));if(lineCharIndex===0){polygon.push(upper);polygon.push(lower)}else{if(lineIndex===0){polygon.unshift(upper)}if(lineIndex===numOfLines-1){polygon.push(lower)}}}catch(e){break}}i+=lineLen-1;try{const srcCharIndex=i+lineIndex,charPos=tp.getEndPositionOfChar(srcCharIndex),[lower,upper]=appendTopAndBottom(srcCharIndex,charPos);polygon.unshift(upper);polygon.unshift(lower)}catch(e){break}}if(polygon.length){polygon.push(polygon[0].slice())}bBox.polygon=polygon}return bBox}function drawTextPath(event){const labelOptions=event.labelOptions,point=event.point,textPathOptions=labelOptions[point.formatPrefix+"TextPath"]||labelOptions.textPath;if(textPathOptions&&!labelOptions.useHTML){this.setTextPath(point.getDataLabelPath?.(this)||point.graphic,textPathOptions);if(point.dataLabelPath&&!textPathOptions.enabled){point.dataLabelPath=point.dataLabelPath.destroy()}}}function compose(SVGElementClass){addEvent(SVGElementClass,"afterGetBBox",setPolygon);addEvent(SVGElementClass,"beforeAddingDataLabel",drawTextPath);const svgElementProto=SVGElementClass.prototype;if(!svgElementProto.setTextPath){svgElementProto.setTextPath=setTextPath}}const TextPath={compose:compose};const Extensions_TextPath=TextPath;const{column:SankeySeries_ColumnSeries,line:LineSeries}=highcharts_SeriesRegistry_commonjs_highcharts_SeriesRegistry_commonjs2_highcharts_SeriesRegistry_root_Highcharts_SeriesRegistry_default().seriesTypes;const{parse:color}=highcharts_Color_commonjs_highcharts_Color_commonjs2_highcharts_Color_root_Highcharts_Color_default();const{getLevelOptions:SankeySeries_getLevelOptions,getNodeWidth:SankeySeries_getNodeWidth}=Series_TreeUtilities;const{clamp,crisp,extend:SankeySeries_extend,isObject:SankeySeries_isObject,merge:SankeySeries_merge,pick:SankeySeries_pick,relativeLength:SankeySeries_relativeLength,stableSort}=highcharts_commonjs_highcharts_commonjs2_highcharts_root_Highcharts_default();Extensions_TextPath.compose(highcharts_SVGElement_commonjs_highcharts_SVGElement_commonjs2_highcharts_SVGElement_root_Highcharts_SVGElement_default());class SankeySeries extends SankeySeries_ColumnSeries{static getDLOptions(params){const optionsPoint=SankeySeries_isObject(params.optionsPoint)?params.optionsPoint.dataLabels:{},optionsLevel=SankeySeries_isObject(params.level)?params.level.dataLabels:{},options=SankeySeries_merge({style:{}},optionsLevel,optionsPoint);return options}createNodeColumns(){const columns=[];for(const node of this.nodes){node.setNodeColumn();if(!columns[node.column]){columns[node.column]=Sankey_SankeyColumnComposition.compose([],this)}columns[node.column].push(node)}for(let i=0;i<columns.length;i++){if(typeof columns[i]==="undefined"){columns[i]=Sankey_SankeyColumnComposition.compose([],this)}}return columns}order(node,level){const series=this;if(typeof node.level==="undefined"){node.level=level;for(const link of node.linksFrom){if(link.toNode){series.order(link.toNode,level+1)}}}}generatePoints(){Series_NodesComposition.generatePoints.apply(this,arguments);if(this.orderNodes){for(const node of this.nodes){if(node.linksTo.length===0){this.order(node,0)}}stableSort(this.nodes,(a,b)=>a.level-b.level)}}getNodePadding(){let nodePadding=this.options.nodePadding||0;if(this.nodeColumns){const maxLength=this.nodeColumns.reduce((acc,col)=>Math.max(acc,col.length),0);if(maxLength*nodePadding>this.chart.plotSizeY){nodePadding=this.chart.plotSizeY/maxLength}}return nodePadding}hasData(){return!!this.dataTable.rowCount}pointAttribs(point,state){if(!point){return{}}const series=this,level=point.isNode?point.level:point.fromNode.level,levelOptions=series.mapOptionsToLevel[level||0]||{},options=point.options,stateOptions=levelOptions.states&&levelOptions.states[state||""]||{},values=["colorByPoint","borderColor","borderWidth","linkOpacity","opacity"].reduce((obj,key)=>{obj[key]=SankeySeries_pick(stateOptions[key],options[key],levelOptions[key],series.options[key]);return obj},{}),color=SankeySeries_pick(stateOptions.color,options.color,values.colorByPoint?point.color:levelOptions.color);if(point.isNode){return{fill:color,stroke:values.borderColor,"stroke-width":values.borderWidth,opacity:values.opacity}}return{fill:highcharts_Color_commonjs_highcharts_Color_commonjs2_highcharts_Color_root_Highcharts_Color_default().parse(color).setOpacity(values.linkOpacity).get()}}drawTracker(){SankeySeries_ColumnSeries.prototype.drawTracker.call(this,this.points);SankeySeries_ColumnSeries.prototype.drawTracker.call(this,this.nodes)}drawPoints(){SankeySeries_ColumnSeries.prototype.drawPoints.call(this,this.points);SankeySeries_ColumnSeries.prototype.drawPoints.call(this,this.nodes)}drawDataLabels(){SankeySeries_ColumnSeries.prototype.drawDataLabels.call(this,this.points);SankeySeries_ColumnSeries.prototype.drawDataLabels.call(this,this.nodes)}translate(){this.generatePoints();this.nodeColumns=this.createNodeColumns();const series=this,chart=this.chart,options=this.options,nodeColumns=this.nodeColumns,columnCount=nodeColumns.length;this.nodeWidth=SankeySeries_getNodeWidth(this,columnCount);this.nodePadding=this.getNodePadding();this.translationFactor=nodeColumns.reduce((translationFactor,column)=>Math.min(translationFactor,column.sankeyColumn.getTranslationFactor(series)),Infinity);this.colDistance=(chart.plotSizeX-this.nodeWidth-options.borderWidth)/Math.max(1,nodeColumns.length-1);series.mapOptionsToLevel=SankeySeries_getLevelOptions({from:1,levels:options.levels,to:nodeColumns.length-1,defaults:{borderColor:options.borderColor,borderRadius:options.borderRadius,borderWidth:options.borderWidth,color:series.color,colorByPoint:options.colorByPoint,levelIsConstant:true,linkColor:options.linkColor,linkLineWidth:options.linkLineWidth,linkOpacity:options.linkOpacity,states:options.states}});for(const column of nodeColumns){for(const node of column){series.translateNode(node,column)}}for(const node of this.nodes){for(const linkPoint of node.linksFrom){if((linkPoint.weight||linkPoint.isNull)&&linkPoint.to){series.translateLink(linkPoint);linkPoint.allowShadow=false}}}}translateLink(point){const getY=(node,fromOrTo)=>{const linkTop=node.offset(point,fromOrTo)*translationFactor;const y=Math.min(node.nodeY+linkTop,node.nodeY+(node.shapeArgs&&node.shapeArgs.height||0)-linkHeight);return y};const fromNode=point.fromNode,toNode=point.toNode,chart=this.chart,{inverted}=chart,translationFactor=this.translationFactor,options=this.options,linkColorMode=SankeySeries_pick(point.linkColorMode,options.linkColorMode),curvy=(chart.inverted?-this.colDistance:this.colDistance)*options.curveFactor,nodeLeft=fromNode.nodeX,right=toNode.nodeX,outgoing=point.outgoing;let linkHeight=Math.max(point.weight*translationFactor,this.options.minLinkWidth),fromY=getY(fromNode,"linksFrom"),toY=getY(toNode,"linksTo"),nodeW=this.nodeWidth,straight=right>nodeLeft+nodeW;if(chart.inverted){fromY=chart.plotSizeY-fromY;toY=(chart.plotSizeY||0)-toY;nodeW=-nodeW;linkHeight=-linkHeight;straight=nodeLeft>right}point.shapeType="path";point.linkBase=[fromY,fromY+linkHeight,toY,toY+linkHeight];if(straight&&typeof toY==="number"){point.shapeArgs={d:[["M",nodeLeft+nodeW,fromY],["C",nodeLeft+nodeW+curvy,fromY,right-curvy,toY,right,toY],["L",right+(outgoing?nodeW:0),toY+linkHeight/2],["L",right,toY+linkHeight],["C",right-curvy,toY+linkHeight,nodeLeft+nodeW+curvy,fromY+linkHeight,nodeLeft+nodeW,fromY+linkHeight],["Z"]]}}else if(typeof toY==="number"){const bend=20,vDist=chart.plotHeight-fromY-linkHeight,x1=right-bend-linkHeight,x2=right-bend,x3=right,x4=nodeLeft+nodeW,x5=x4+bend,x6=x5+linkHeight,fy1=fromY,fy2=fromY+linkHeight,fy3=fy2+bend,y4=fy3+vDist,y5=y4+bend,y6=y5+linkHeight,ty1=toY,ty2=ty1+linkHeight,ty3=ty2+bend,cfy1=fy2-linkHeight*.7,cy2=y5+linkHeight*.7,cty1=ty2-linkHeight*.7,cx1=x3-linkHeight*.7,cx2=x4+linkHeight*.7;point.shapeArgs={d:[["M",x4,fy1],["C",cx2,fy1,x6,cfy1,x6,fy3],["L",x6,y4],["C",x6,cy2,cx2,y6,x4,y6],["L",x3,y6],["C",cx1,y6,x1,cy2,x1,y4],["L",x1,ty3],["C",x1,cty1,cx1,ty1,x3,ty1],["L",x3,ty2],["C",x2,ty2,x2,ty2,x2,ty3],["L",x2,y4],["C",x2,y5,x2,y5,x3,y5],["L",x4,y5],["C",x5,y5,x5,y5,x5,y4],["L",x5,fy3],["C",x5,fy2,x5,fy2,x4,fy2],["Z"]]}}point.dlBox={x:nodeLeft+(right-nodeLeft+nodeW)/2,y:fromY+(toY-fromY)/2,height:linkHeight,width:0};point.tooltipPos=chart.inverted?[chart.plotSizeY-point.dlBox.y-linkHeight/2,chart.plotSizeX-point.dlBox.x]:[point.dlBox.x,point.dlBox.y+linkHeight/2];point.y=point.plotY=1;point.x=point.plotX=1;if(!point.options.color){if(linkColorMode==="from"){point.color=fromNode.color}else if(linkColorMode==="to"){point.color=toNode.color}else if(linkColorMode==="gradient"){const fromColor=color(fromNode.color).get(),toColor=color(toNode.color).get();point.color={linearGradient:{x1:1,x2:0,y1:0,y2:0},stops:[[0,inverted?fromColor:toColor],[1,inverted?toColor:fromColor]]}}}}translateNode(node,column){const translationFactor=this.translationFactor,chart=this.chart,options=this.options,{borderRadius,borderWidth=0}=options,sum=node.getSum(),nodeHeight=Math.max(Math.round(sum*translationFactor),this.options.minLinkWidth),nodeWidth=Math.round(this.nodeWidth),nodeOffset=column.sankeyColumn.offset(node,translationFactor),fromNodeTop=crisp(SankeySeries_pick(nodeOffset.absoluteTop,column.sankeyColumn.top(translationFactor)+nodeOffset.relativeTop),borderWidth),left=crisp(this.colDistance*node.column+borderWidth/2,borderWidth)+SankeySeries_relativeLength(node.options[chart.inverted?"offsetVertical":"offsetHorizontal"]||0,nodeWidth),nodeLeft=chart.inverted?chart.plotSizeX-left:left;node.sum=sum;if(sum){node.shapeType="roundedRect";node.nodeX=nodeLeft;node.nodeY=fromNodeTop;let x=nodeLeft,y=fromNodeTop,width=node.options.width||options.width||nodeWidth,height=node.options.height||options.height||nodeHeight;const r=clamp(SankeySeries_relativeLength(typeof borderRadius==="object"?borderRadius.radius:borderRadius||0,width),0,nodeHeight/2);if(chart.inverted){x=nodeLeft-nodeWidth;y=chart.plotSizeY-fromNodeTop-nodeHeight;width=node.options.height||options.height||nodeWidth;height=node.options.width||options.width||nodeHeight}node.dlOptions=SankeySeries.getDLOptions({level:this.mapOptionsToLevel[node.level],optionsPoint:node.options});node.plotX=1;node.plotY=1;node.tooltipPos=chart.inverted?[chart.plotSizeY-y-height/2,chart.plotSizeX-x-width/2]:[x+width/2,y+height/2];node.shapeArgs={x:x,y:y,width:width,height:height,r:r,display:node.hasShape()?"":"none"}}else{node.dlOptions={enabled:false}}}}SankeySeries.defaultOptions=SankeySeries_merge(SankeySeries_ColumnSeries.defaultOptions,Sankey_SankeySeriesDefaults);Series_NodesComposition.compose(Sankey_SankeyPoint,SankeySeries);SankeySeries_extend(SankeySeries.prototype,{animate:LineSeries.prototype.animate,createNode:Series_NodesComposition.createNode,forceDL:true,invertible:true,isCartesian:false,orderNodes:true,noSharedTooltip:true,pointArrayMap:["from","to","weight"],pointClass:Sankey_SankeyPoint,searchPoint:highcharts_commonjs_highcharts_commonjs2_highcharts_root_Highcharts_default().noop});highcharts_SeriesRegistry_commonjs_highcharts_SeriesRegistry_commonjs2_highcharts_SeriesRegistry_root_Highcharts_SeriesRegistry_default().registerSeriesType("sankey",SankeySeries);const Sankey_SankeySeries=null&&SankeySeries;"";const sankey_src=highcharts_commonjs_highcharts_commonjs2_highcharts_root_Highcharts_default();__webpack_exports__=__webpack_exports__["default"];return __webpack_exports__})()});