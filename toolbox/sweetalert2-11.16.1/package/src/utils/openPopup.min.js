import globalState from"../globalState.js";import{setAriaHidden}from"./aria.js";import{swalClasses}from"./classes.js";import*as dom from"./dom/index.js";import{iOSfix}from"./iosFix.js";import{replaceScrollbarWithPadding}from"./scrollbar.js";export const SHOW_CLASS_TIMEOUT=10;export const openPopup=params=>{const container=dom.getContainer();const popup=dom.getPopup();if(typeof params.willOpen==="function"){params.willOpen(popup)}globalState.eventEmitter.emit("willOpen",popup);const bodyStyles=window.getComputedStyle(document.body);const initialBodyOverflow=bodyStyles.overflowY;addClasses(container,popup,params);setTimeout(()=>{setScrollingVisibility(container,popup)},SHOW_CLASS_TIMEOUT);if(dom.isModal()){fixScrollContainer(container,params.scrollbarPadding,initialBodyOverflow);setAriaHidden()}if(!dom.isToast()&&!globalState.previousActiveElement){globalState.previousActiveElement=document.activeElement}if(typeof params.didOpen==="function"){setTimeout(()=>params.didOpen(popup))}globalState.eventEmitter.emit("didOpen",popup);dom.removeClass(container,swalClasses["no-transition"])};const swalOpenAnimationFinished=event=>{const popup=dom.getPopup();if(event.target!==popup){return}const container=dom.getContainer();popup.removeEventListener("animationend",swalOpenAnimationFinished);popup.removeEventListener("transitionend",swalOpenAnimationFinished);container.style.overflowY="auto"};const setScrollingVisibility=(container,popup)=>{if(dom.hasCssAnimation(popup)){container.style.overflowY="hidden";popup.addEventListener("animationend",swalOpenAnimationFinished);popup.addEventListener("transitionend",swalOpenAnimationFinished)}else{container.style.overflowY="auto"}};const fixScrollContainer=(container,scrollbarPadding,initialBodyOverflow)=>{iOSfix();if(scrollbarPadding&&initialBodyOverflow!=="hidden"){replaceScrollbarWithPadding(initialBodyOverflow)}setTimeout(()=>{container.scrollTop=0})};const addClasses=(container,popup,params)=>{dom.addClass(container,params.showClass.backdrop);if(params.animation){popup.style.setProperty("opacity","0","important");dom.show(popup,"grid");setTimeout(()=>{dom.addClass(popup,params.showClass.popup);popup.style.removeProperty("opacity")},SHOW_CLASS_TIMEOUT)}else{dom.show(popup,"grid")}dom.addClass([document.documentElement,document.body],swalClasses.shown);if(params.heightAuto&&params.backdrop&&!params.toast){dom.addClass([document.documentElement,document.body],swalClasses["height-auto"])}};